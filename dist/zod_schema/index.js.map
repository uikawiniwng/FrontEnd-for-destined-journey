{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/zod_schema/utils.ts","src://tavern_helper_template/src/zod_schema/schema.ts","src://tavern_helper_template/src/zod_schema/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","/**\n * 布尔值转换\n */\nexport const coercedBoolean = (defaultVal = false) => z\n    .preprocess(val => (typeof val === 'string' ? val === '是' : val), z.boolean())\n    .prefault(defaultVal);\n/**\n * 范围限制数值 schema\n */\nexport const clampedNum = (defaultVal, min, max) => z.coerce\n    .number()\n    .prefault(defaultVal)\n    .transform(val => _.clamp(val, min, max));\n// 基础物品描述 schema\nexport const BaseItemSchema = z.object({\n    品质: z.string().prefault(''),\n    标签: z.string().optional(),\n    效果: z.string().prefault(''),\n    描述: z.string().prefault(''),\n});\n// 技能 schema (扩展基础物品 + 类型/消耗)\nexport const SkillSchema = BaseItemSchema.extend({\n    类型: z.string().prefault(''),\n    消耗: z.string().prefault(''),\n}).transform(data => _.pick(data, ['品质', '类型', '消耗', '标签', '效果', '描述']));\n// 装备 schema (扩展基础物品 + 位置)\nexport const EquipmentSchema = BaseItemSchema.extend({\n    位置: z.string().prefault(''),\n});\n// 命定之人装备 schema (扩展基础物品 + 类型)\nexport const DestinedEquipmentSchema = BaseItemSchema.extend({\n    类型: z.string().prefault(''),\n}).transform(data => _.pick(data, ['品质', '类型', '标签', '效果', '描述']));\n// 背包物品 schema (扩展命定装备 + 数量)\nexport const InventoryItemSchema = BaseItemSchema.extend({\n    数量: z.coerce.number().prefault(1),\n    类型: z.string().prefault(''),\n}).transform(data => _.pick(data, ['品质', '数量', '类型', '标签', '效果', '描述']));\n// 基础属性默认值\nconst DefaultBaseAttributes = {\n    力量: 0,\n    敏捷: 0,\n    体质: 0,\n    智力: 0,\n    精神: 0,\n};\n// 基础属性 schema\nexport const BaseAttributeSchema = z\n    .object(_.mapValues(DefaultBaseAttributes, () => z.coerce.number().prefault(0)))\n    .prefault({});\n// 角色属性 schema (扩展基础属性 + 属性点)\nexport const CharacterAttributeSchema = z\n    .object({\n    ..._.mapValues(DefaultBaseAttributes, () => z.coerce.number().prefault(0)),\n    属性点: z.coerce.number().prefault(0),\n})\n    .prefault({});\n// 神国 schema\nexport const DivineRealmSchema = z\n    .object({\n    名称: z.string().prefault(''),\n    描述: z.string().prefault(''),\n})\n    .prefault({});\n/** 截取 record 的前 n 个条目 */\nconst sliceRecord = (record, limit) => _.fromPairs(_.take(_.toPairs(record), limit));\n// 登神长阶 schema\n// 要素限3个，权能限1个，法则限1个，神位不为空时，法则无上限\nexport const AscensionSchema = z\n    .object({\n    是否开启: coercedBoolean(false),\n    要素: z.record(z.string(), z.string()).prefault({}),\n    权能: z.record(z.string(), z.string()).prefault({}),\n    法则: z.record(z.string(), z.string()).prefault({}),\n    神位: z.string().prefault(''),\n    神国: DivineRealmSchema,\n})\n    .prefault({})\n    .transform(data => ({\n    ...data,\n    要素: sliceRecord(data.要素, 3),\n    权能: sliceRecord(data.权能, 1),\n    法则: data.神位 ? data.法则 : sliceRecord(data.法则, 1),\n}));\n// 任务 schema\nexport const QuestSchema = z.object({\n    简介: z.string().prefault(''),\n    目标: z.string().prefault(''),\n    奖励: z.string().prefault(''),\n});\n","import { AscensionSchema, BaseAttributeSchema, CharacterAttributeSchema, clampedNum, coercedBoolean, DestinedEquipmentSchema, EquipmentSchema, InventoryItemSchema, QuestSchema, SkillSchema, } from './utils.ts';\nexport const Schema = z.object({\n    世界: z\n        .object({\n        时间: z.string().prefault(''),\n        地点: z.string().prefault(''),\n    })\n        .prefault({}),\n    事件链: z.record(z.any(), z.any()).prefault({}),\n    任务列表: z.record(z.string(), QuestSchema).prefault({}),\n    角色: z\n        .object({\n        种族: z.string().prefault(''),\n        身份: z.array(z.string()).prefault([]),\n        职业: z.array(z.string()).prefault([]),\n        生命层级: z.string().prefault('第一层级/普通层级'),\n        等级: clampedNum(1, 1, 25),\n        累计经验值: z.coerce.number().prefault(0),\n        升级所需经验: z.union([z.coerce.number().prefault(120), z.literal('MAX')]),\n        冒险者等级: z.string().prefault('未评级'),\n        生命值上限: z.coerce.number().prefault(0),\n        生命值: z.coerce.number().prefault(0),\n        法力值上限: z.coerce.number().prefault(0),\n        法力值: z.coerce.number().prefault(0),\n        体力值上限: z.coerce.number().prefault(0),\n        体力值: z.coerce.number().prefault(0),\n        属性: CharacterAttributeSchema.prefault({}),\n        技能列表: z.record(z.string(), SkillSchema).prefault({}),\n    })\n        .prefault({})\n        .transform(data => ({\n        ...data,\n        升级所需经验: data.等级 >= 25 ? 'MAX' : data.升级所需经验,\n        生命值: _.clamp(data.生命值, 0, data.生命值上限),\n        法力值: _.clamp(data.法力值, 0, data.法力值上限),\n        体力值: _.clamp(data.体力值, 0, data.体力值上限),\n    })),\n    背包: z\n        .record(z.string(), InventoryItemSchema)\n        .prefault({})\n        .transform(items => _.pickBy(items, item => item.数量 > 0)),\n    货币: z\n        .object({\n        金币: z.coerce\n            .number()\n            .prefault(0)\n            .transform(val => Math.floor(val)),\n        银币: z.coerce\n            .number()\n            .prefault(0)\n            .transform(val => Math.floor(val)),\n        铜币: z.coerce\n            .number()\n            .prefault(0)\n            .transform(val => Math.floor(val)),\n    })\n        .prefault({}),\n    装备: z\n        .object({\n        武器: z.record(z.string(), EquipmentSchema).prefault({}),\n        防具: z.record(z.string(), EquipmentSchema).prefault({}),\n        饰品: z.record(z.string(), EquipmentSchema).prefault({}),\n    })\n        .prefault({}),\n    登神长阶: AscensionSchema,\n    命定系统: z\n        .object({\n        命运点数: z.coerce\n            .number()\n            .prefault(0)\n            .transform(val => Math.floor(Math.max(val, 0))),\n        命定之人: z\n            .record(z.string(), z.object({\n            是否在场: coercedBoolean(true),\n            生命层级: z.string().prefault(''),\n            等级: clampedNum(1, 1, 25),\n            种族: z.string().prefault(''),\n            身份: z.array(z.string()).prefault([]),\n            职业: z.array(z.string()).prefault([]),\n            性格: z.string().prefault(''),\n            喜爱: z.string().prefault(''),\n            外貌特质: z.string().prefault(''),\n            衣物装饰: z.string().prefault(''),\n            装备: z.record(z.string(), DestinedEquipmentSchema).prefault({}),\n            属性: BaseAttributeSchema,\n            登神长阶: AscensionSchema,\n            是否缔结契约: coercedBoolean(false),\n            好感度: clampedNum(0, -100, 100),\n            评价: z.string().prefault(''),\n            背景故事: z.string().prefault(''),\n            技能: z.record(z.string(), SkillSchema).prefault({}),\n        }))\n            .prefault({}),\n    })\n        .prefault({}),\n    新闻: z\n        .object({\n        阿斯塔利亚快讯: z\n            .object({\n            势力要闻: z.string().prefault(''),\n            尊位行迹: z.string().prefault(''),\n            军事行动: z.string().prefault(''),\n            经济动脉: z.string().prefault(''),\n            灾害预警: z.string().prefault(''),\n        })\n            .prefault({}),\n        酒馆留言板: z\n            .object({\n            高额悬赏: z.string().prefault(''),\n            冒险发现: z.string().prefault(''),\n            怪物异动: z.string().prefault(''),\n            通缉要犯: z.string().prefault(''),\n            宝物传闻: z.string().prefault(''),\n        })\n            .prefault({}),\n        午后茶会: z\n            .object({\n            社交逸闻: z.string().prefault(''),\n            千里远望: z.string().prefault(''),\n            命运涟漪: z.string().prefault(''),\n            邂逅预兆: z.string().prefault(''),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n});\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\n\nimport { Schema } from './schema.ts';\n\n$(() => {\n  registerMvuSchema(Schema);\n});\n"],"names":["z","coercedBoolean","defaultVal","preprocess","val","boolean","prefault","clampedNum","min","max","coerce","number","transform","_","clamp","BaseItemSchema","object","string","optional","SkillSchema","extend","data","pick","EquipmentSchema","DestinedEquipmentSchema","InventoryItemSchema","DefaultBaseAttributes","BaseAttributeSchema","mapValues","CharacterAttributeSchema","DivineRealmSchema","sliceRecord","record","limit","fromPairs","take","toPairs","AscensionSchema","QuestSchema","Schema","any","array","union","literal","items","pickBy","item","Math","floor","$"],"ignoreList":[],"sourceRoot":""}