# React 状态栏重构规划 v3（西幻/TRPG 风格）

> 本文档用于重新规划 Status UI 的重构方向与实现路径，基于现有代码结构与 `src/data_schema` 的变量定义，聚焦西幻 RPG / TRPG 视觉与编辑器交互确认。

---

## 一、范围与目标

### 目标

1. **UI 风格化**：视觉方向以西幻 RPG / TRPG 为主（DND、黑暗世界等桌游氛围）。
2. **编辑确认机制**：编辑器组件修改数据前必须由用户确认，成功后弹出 toastr 提示。
3. **保持 MVU 兼容**：所有数据读写继续通过 `stat_data`，并遵循 `src/data_schema` 结构。

### 非目标

- 不改变 MVU 数据来源与层级结构。
- 不新增脚本或运行时依赖（除非明确要求）。

---

## 二、视觉风格方向（西幻/TRPG）

### 2.1 核心基调

- **材质感**：羊皮纸、皮革、铁锈金属、古旧木纹。
- **色彩**：暗酒红、古铜金、深靛蓝、墨黑、羊皮纸米黄。
- **氛围**：厚重、史诗、卷轴式界面，不使用现代管理面板风格。

### 2.2 视觉元素建议

- **边框/角饰**：卡片与分区使用角饰与金属描边，强化“卷轴/仪式感”。
- **标题栏**：加入“徽记”或“封印”风格图标，强化 DND 式 UI。
- **资源条**：HP/MP/SP 使用“刻度+渐变+镶边”表现方式，模拟 RPG 血条。
- **品质标识**：品质颜色用于卡片边框、标题底纹与小徽章。

### 2.3 字体与排版

- 标题与分组标题使用衬线字体（如 Cinzel/IM Fell/Trajan 类），正文保持现有中文字体。
- 标题加入小型分隔线与符号，强调“章节感”。

---

## 三、编辑交互规范（新增强制）

### 3.1 编辑确认

- **规则**：任何编辑器触发数据更新前，必须出现确认步骤（确认/取消）。
- **确认场景**：单行文本、多行文本、数字、布尔、标签、键值对、数组、枚举值全部适用。
- **确认内容**：
  - 字段名
  - 旧值 / 新值
  - 操作提示（如“此操作会修改 MVU 数据”）

### 3.2 成功/失败反馈

- **成功**：调用 `toastr.success('已保存')`（具体文案统一）。
- **失败**：调用 `toastr.error('保存失败')`。
- **删除**：保留原有删除确认流程，成功/失败同样 toastr。

---

## 四、编辑器组件改造规划（基于 Schema 覆盖所有字段）

### 4.1 统一确认流程

- 在 `EditableField` 层实现统一的“确认提交”逻辑：
  - 编辑器内部先输出“临时值”。
  - 用户确认后才调用 `updateField`。
  - 避免在 `TextEditor` / `NumberEditor` 内部直接落盘。

### 4.2 编辑器类型扩展（覆盖 Schema 所有值类型）

| 类型来源 | 示例字段 | 编辑器建议 | 说明 |
|---------|---------|-----------|------|
| string | 种族/生命层级/外貌/描述 | TextEditor / TextareaEditor | 长文本默认 TextareaEditor |
| number | 属性/生命值/好感度 | NumberEditor | 支持 min/max/step |
| boolean | 是否在场/是否缔结契约 | ToggleEditor | 显示为开关或勾选 |
| enum | 状态效果.类型 | SelectEditor | 固定枚举值 |
| string[] | 身份/职业/标签 | TagEditor | 支持添加/删除/粘贴 |
| Record<string, string> | 效果/登神长阶条目详情 | KeyValueEditor | 可增删改 |
| Record<string, object> | 任务列表/装备/技能/状态效果 | RecordListEditor | 以 Collapse 列出子对象 |

### 4.3 交互形态

- **方案 A（推荐）**：在编辑器下方显示确认条：`[确认] [取消]`。
- **方案 B**：弹出小型对话框（轻量确认弹窗）。

---

## 五、Tab 内容调整与补全

### 5.1 Tab 顺序与配置

- `任务 → 状态 → 持有物 → 命定 → 情报`
- 保持与 `src/status/config/tabs.config.ts` 一致，后续仅调整图标与样式。

### 5.2 命定 Tab 补全

- 基础信息补全：身份、职业、外貌、着装、属性、装备、技能、登神长阶、背景故事。
- 对应字段路径严格使用 `src/data_schema` 定义的结构。

### 5.3 状态 Tab 增补

- 状态效果卡片保留，并确保编辑与删除遵循确认+toastr。

---

## 六、物品/装备/技能的分类与排序

### 6.1 分类逻辑

- **三类分类**：全部 / 动态类型(或位置) / 其他。
- 空值归“其他”；只有一种类型时不显示分类切换。

### 6.2 排序优先级

1. 品质权重（唯一 > 神话 > 传说 > 史诗 > 稀有 > 优良 > 普通）
2. 类型/位置
3. 名称

---

## 七、UI 结构与布局调整

### 7.1 卡片结构

- 分组标题统一采用“卷轴标题 + 小型符文装饰”。
- 卡片内部信息尽量密集但避免拥挤，强调桌游信息密度。

### 7.2 Tab 栏与切换

- Tab 采用“图标 + 纹章按钮”设计，激活态带金属描边与光泽。
- 兼容移动端与窄容器展示（避免横向滚动）。

---

## 八、实施里程碑

### 高优先级

- 编辑器统一确认机制 + 成功/失败 toastr。
- 命定 Tab 缺失字段补全。
- 物品/装备/技能分类与排序稳定化。

### 中优先级

- UI 风格化基础落地（色板、边框、标题样式、资源条）。
- Tab 栏“纹章化”样式改造。

### 低优先级

- 动画与装饰纹理。
- 更丰富的图标与微光效。

---

## 九、编辑器组件清单（面向“任何值可编辑”）

### 9.1 通用编辑器组件

| 组件名 | 用途 | 说明 |
|--------|------|------|
| `TextEditor` | 单行文本编辑 | 点击编辑，失焦进入待确认 |
| `TextareaEditor` | 多行文本编辑 | 长文本默认使用 |
| `NumberEditor` | 数字编辑 | 支持 min/max/step |
| `SelectEditor` | 枚举选择 | 固定选项 |
| `ToggleEditor` | 布尔值编辑 | 是否在场/是否缔结契约 |
| `TagEditor` | 字符串数组 | 身份/职业/标签 |
| `KeyValueEditor` | 键值对 | 效果/登神长阶条目 |
| `RecordListEditor` | 记录型对象 | 任务/装备/技能/状态效果 |

### 9.2 字段可编辑性汇总（按 Schema）

- **主角**
  - 基础信息：种族/身份/职业/冒险者等级（等级/生命层级不编辑）
  - 资源：生命值/生命值上限/法力值/法力值上限/体力值/体力值上限
  - 属性：力量/敏捷/体质/智力/精神/属性点
  - 背包/装备/技能：全字段可编辑（名称为 key）
  - 状态效果：类型/效果/层数/剩余时间/来源
  - 登神长阶：神位/神国/要素/权能/法则（`是否开启` 不编辑）

- **命定系统**
  - 命运点数
  - 命定之人：基础信息（等级/生命层级不编辑）、外貌、属性、装备、技能、登神长阶、好感度、心里话、背景故事

- **新闻**
  - 所有条目可编辑

- **任务列表**
  - 简介/目标/奖励，可删除任务条目

---

## 十、验收标准

1. **数据修改必须确认**：任何编辑操作都会出现确认流程。
2. **数据修改有反馈**：更新/删除成功或失败均有 toastr。
3. **风格符合西幻/TRPG**：视觉不再是管理面板，具备“桌游/卷轴/仪式感”。
4. **MVU 数据稳定**：读写路径与 schema 一致，不破坏现有数据。

## 十一、代码整理

留白
