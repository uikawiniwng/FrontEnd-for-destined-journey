{"version":3,"file":"index.js","mappings":"wFAIAA,EAAQ,EAAU,CAACC,EAAKC,KACpB,MAAMC,EAASF,EAAIG,WAAaH,EAChC,IAAK,MAAOI,EAAKC,KAAQJ,EACrBC,EAAOE,GAAOC,EAElB,OAAOH,E,GCRPI,EAA2B,CAAC,ECDhC,MAAM,EAA+BC,ICC9B,SAASC,IACd,MAAMC,EAAWC,OAAOC,KAAKC,aAAaC,sBAAsB,WAEhE,OADiBJ,EAAWA,EAASK,QAAU,IAEjD,CAgBOC,eAAeC,EAAmBC,EAAiBC,GACxD,MAAMC,QAfDJ,eAAmCG,GACxC,IAAKA,EACH,OAEF,MAAMC,QAAkBT,OAAOC,KAAKC,aAAaQ,aAAaF,IAC9D,OAAKC,EAGEA,EAAUE,IAAKC,IAA8C,CAClEC,KAAMD,EAAMC,KACZC,QAASF,EAAME,gBALjB,CAOF,CAG0BC,CAAoBP,GAC5C,OAAKC,GAAkC,IAArBA,EAAUO,OAGrBP,EACJQ,OAAQL,GAA4BL,EAAQW,KAAKN,EAAMC,OACvDF,IAAKC,IAAuC,CAC3CC,KAAMD,EAAMC,KACZC,QAASF,EAAME,WANV,EAQX,CAWOT,eAAec,EACpBC,EACAZ,GAEA,IAAKA,EACH,OAEF,IAAKA,EACH,MAAM,IAAIa,MAAM,2CAGlB,MAAMC,EAAa,IAAIC,IAAIH,EAAQT,IAAIa,GAAK,CAACA,EAAEX,KAAMW,EAAEV,iBAEjDd,OAAOC,KAAKC,aAAauB,oBAAoBjB,EAAUC,GACpDA,EAAUE,IAAIC,IACnB,MAAMc,EAAaJ,EAAWK,IAAIf,EAAMC,MACxC,YAAmBe,IAAfF,EACK,IAAKd,EAAOE,QAASY,GAEvBd,KAGb,CC5DO,MAAMiB,EAAoB,QAGpBC,EAAwB,OAmB/BC,EAAe,SAGfC,EAAiB,eAKVC,EAAmB,CAC9BC,YAAa,GACbC,oBAAqB,IAAIZ,IACzBa,KAAM,GACNC,UAAW,IAWb,IAAIC,EAAgD,KA6C7CjC,eAAekC,IACpB,MAAMC,QAlCRnC,iBACE,GAAuB,OAAnBiC,EACF,OAAOA,EAGT,IACE,MAAMG,QAAiBC,MAAM,wIAC7B,IAAKD,EAASE,GAEZ,OADAC,QAAQC,IAAI,yCACL,CAAC,EAGV,MAAMC,QAAaL,EAASK,OACtBC,EAAO,QAAYD,GAGzB,OAFAF,QAAQC,IAAI,cACZP,EAAiBS,EACVA,CACT,CAAE,MAAOC,GAEP,OADAJ,QAAQC,IAAI,kBAAmBG,GACxB,CAAC,CACV,CACF,CAayBC,GACvB,IAAKT,GAAgC,iBAAbA,EACtB,MAAO,CAACV,EAAuBD,GAIjC,MAAMqB,EAAcC,OAAOC,KAAKZ,GAAUvB,OACxCvB,GAAO8C,EAAS9C,IAAiC,iBAAlB8C,EAAS9C,IAI1C,OAA2B,IAAvBwD,EAAYlC,OACP,CAACc,EAAuBD,GAI1B,CAACC,KAA0BoB,EAAarB,EACjD,CAUO,SAASwB,EACdC,EACAC,EACAC,EACAC,EAAgE,CAAC,GAEjE,MAAMjB,EAxCCF,QAAkBV,EAyCnB8B,EAAwB,GAC9B,IAAIC,EAAO,GACPC,EAAc,GAQlB,GALIL,KAAaE,IACfC,EAAYG,KAAK/B,GACjB8B,EAAcH,EAAsBF,IAAYI,MAAQ,IAGtDnB,GAAgC,iBAAbA,EAErB,IAAK,MAAMsB,KAAWN,EAAS,CAC7B,GAAIM,IAAYjC,GAAqBiC,IAAYhC,EAAuB,SAExE,MAAMiC,EAAUvB,EAASsB,GACrBC,GAA8B,iBAAZA,GAEhBT,KAASS,IACXL,EAAYG,KAAKC,IAEZH,GAAQI,EAAQT,IAAQK,OAC3BA,EAAOI,EAAQT,GAAOK,MAI9B,CAIF,OAA2B,IAAvBD,EAAY1C,OACP,CAAEoB,KAAM,CAACP,GAAoB8B,KAAM,GAAIC,YAAa,IAGtD,CAAExB,KAAMsB,EAAaC,OAAMC,cACpC,CAaO,SAASI,EAAgB7B,GAC9B,IAAK,MAAOtB,EAAMC,KAAYqB,EAC5B,GAAIrB,EAAS,OAAOD,EAEtB,OAAO,IACT,CCrLA,MAAMoD,EAAa,CAAEC,MAAO,aACtBC,EAAa,CAAED,MAAO,2BACtBE,EAAa,CAAEF,MAAO,kBACtBG,EAAa,CAAC,YACdC,EAAa,CAAEJ,MAAO,yBACtBK,EAAa,CAAC,WACdC,EAAa,CAAEN,MAAO,aACtBO,EAAa,CAAEP,MAAO,aACtBQ,EAAa,CAAC,YACdC,EAAc,CAAC,YACfC,EAAc,CAAEV,MAAO,eACvBW,EAAc,CAAEX,MAAO,iBACvBY,EAAc,CAChBpF,IAAK,EACLwE,MAAO,gBAELa,EAAc,CAChBrF,IAAK,EACLwE,MAAO,cAELc,EAAc,CAChBtF,IAAK,EACLwE,MAAO,mBAELe,EAAc,CAAC,WACfC,EAAc,CAChBxF,IAAK,EACLwE,MAAO,eAELiB,EAAc,CAChBzF,IAAK,EACLwE,MAAO,aAELkB,EAAc,CAChB1F,IAAK,EACLwE,MAAO,aAELmB,EAAc,CAAEnB,MAAO,eACvBoB,EAAc,CAAC,YAOrB,GAA6B,qBAAiB,CAC1CC,OAAQ,WACRC,MAAO,CAAC,OAAQ,QAChB,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMC,EAA0B,CAC5B,mBAAoB,CAAElC,KAAM,OAC5B,qBAAsB,CAAEA,KAAM,oBAC9B,kBAAmB,CAAEA,KAAM,SAEzBgC,EAAOC,EACPE,GAAY,IAAAC,MAAI,GAChB3D,GAAO,IAAA2D,KAAI,IAAI9D,EAAiBG,OAChCC,GAAY,IAAA0D,KAAI9D,EAAiBI,WACjCH,GAAc,IAAA6D,KAAI,IAAI9D,EAAiBC,cACvCC,GAAsB,IAAA4D,KAAI,IAAIxE,IAAIU,EAAiBE,sBACnD3B,GAAW,IAAAuF,KAAI,MAEfC,GAAgB,IAAAD,KAAI,GACpBE,GAAe,IAAAC,UAAS,IAAMlC,EAAgB7B,EAAoBgE,QAElEC,GAAwB,IAAAF,UAAS,IAAM7D,EAAU8D,QAAUrE,GAE3DuE,GAAa,IAAAH,UAAS,IAAM9D,EAAK+D,MAAMnF,OAvB9B,GAyBTsF,GAAc,IAAAJ,UAAS,IACpBG,EAAWF,MAGT/D,EAAK+D,MAAMI,MAAMP,EAAcG,MAAOH,EAAcG,MA7BhD,GA2BA/D,EAAK+D,OAKpB,SAASK,IACDR,EAAcG,MAAQ,IACtBH,EAAcG,MAAQM,KAAKC,IAAI,EAAGV,EAAcG,MAlCzC,GAoCf,CAEA,SAASQ,IACDX,EAAcG,MAvCP,EAuCgC/D,EAAK+D,MAAMnF,SAClDgF,EAAcG,MAAQM,KAAKG,IAAIxE,EAAK+D,MAAMnF,OAxCnC,EAwC4DgF,EAAcG,MAxC1E,GA0Cf,CAaA,SAASU,EAAeC,GACpB,ODqEL,SAAwB5E,EAA2B4E,GACxD,OAAO5E,EAAYjB,OAAO8F,GAAQA,EAAK3E,KAAK4E,SAASF,GACvD,CCvEmB,CAAsB5E,EAAYiE,MAAOW,EACpD,CACAzG,eAAe4G,IACXnB,EAAUK,OAAQ,EAClB,IACI,MAAMe,QDkFf7G,eACLoD,EAAgE,CAAC,GASjE,MAAMrB,QAAaG,IACb/B,EAAWV,IAEXoC,SADgB5B,EAAmByB,EAAcvB,IAC3BG,IAAKC,IAE/B,MAAMuG,EAAoBvG,EAAMC,KAAKuG,QAAQrF,EAAc,IAErDsF,EAAcF,EAAkBG,MAAMtF,GACtCuF,EAASF,EAAcA,EAAY,GAAK,GAExC/D,EAAQ6D,EAAkBC,QAAQpF,EAAgB,IAClDwF,EAAUnE,EAAeC,EAAO1C,EAAMC,KAAMuB,EAAMqB,GACxD,MAAO,CACL0C,MAAOvF,EAAMC,KACbyC,QACAiE,SACAzG,QAASF,EAAME,QACfsB,KAAMoF,EAAQpF,KACduB,KAAM6D,EAAQ7D,KACdC,YAAa4D,EAAQ5D,eAKnBzB,EAAsB,IAAIZ,IAAIW,EAAYvB,IAAIoG,GAAQ,CAACA,EAAKZ,MAAOY,EAAKjG,WAGxEuB,EAAYD,EAAK,IAAMN,EAE7B,MAAO,CAAEI,cAAaC,sBAAqBC,OAAMC,YAAW7B,WAC9D,CC1HqC,CAAuBqF,GAC5CzD,EAAK+D,MAAQe,EAAO9E,KACpBF,EAAYiE,MAAQe,EAAOhF,YAC3BC,EAAoBgE,MAAQe,EAAO/E,oBACnCE,EAAU8D,MAAQe,EAAO7E,UACzB7B,EAAS2F,MAAQe,EAAO1G,QAC5B,CACA,MAAOwC,GACHJ,QAAQI,MAAM,YAAaA,GAC3BZ,EAAK+D,MAAQ,GACbjE,EAAYiE,MAAQ,GACpBhE,EAAoBgE,MAAQ,IAAI5E,IAChCf,EAAS2F,MAAQ,IACrB,CACA,QACIL,EAAUK,OAAQ,CACtB,CACJ,CACA9F,eAAeoH,WACLR,GACV,CACA,SAASS,GAAiBnE,GACtBpB,EAAoBgE,MDyGzB,SACLhE,EACAoB,GAGA,GADwBS,EAAgB7B,KAChBoB,EACtB,OAAOpB,EAIT,MAAMwF,EAAgB,IAAIpG,IAC1B,IAAK,MAAOV,KAASsB,EACnBwF,EAAcC,IAAI/G,EAAMA,IAAS0C,GAEnC,OAAOoE,CACT,CCxHwCE,CAAW1F,EAAoBgE,MAAO5C,EACtE,CAIAlD,eAAeyH,KACXhC,EAAUK,OAAQ,EAClB,IACQ3F,EAAS2F,QACTjE,EAAYiE,YDwIzB9F,eACL6B,EACAC,EACA3B,GAEA,IAzBK,SACL0B,EACAC,GAEA,IAAK,MAAM4E,KAAQ7E,EAEjB,IADqBC,EAAoBR,IAAIoF,EAAKZ,SAAU,KACvCY,EAAKjG,QACxB,OAAO,EAGX,OAAO,CACT,CAcOiH,CAAW7F,EAAaC,GAC3B,OAAOD,EAIT,MAAM8F,EAAiBC,MAAMC,KAAK/F,GAAqBxB,IAAI,EAAEE,EAAMC,MAAa,CAC9ED,OACAC,aAMF,aAHMK,EAAgB6G,EAAgBxH,GAG/B0B,EAAYvB,IAAIoG,IAAQ,IAC1BA,EACHjG,QAASqB,EAAoBR,IAAIoF,EAAKZ,SAAU,IAEpD,CC9J8CgC,CAAmBjG,EAAYiE,MAAOhE,EAAoBgE,MAAO3F,EAAS2F,OAE5G,CACA,MAAOnD,GACHJ,QAAQI,MAAM,YAAaA,EAC/B,CACA,QACI8C,EAAUK,OAAQ,CACtB,CACAR,EAAK,OACT,CAKA,OA/DA,IAAAyC,OAAM/F,EAAWgG,IACb,MAAMC,EAAWlG,EAAK+D,MAAMoC,QAAQF,IAClB,IAAdC,GAAmBjC,EAAWF,QAC1BmC,EAAWtC,EAAcG,MACzBH,EAAcG,MAAQmC,EAEjBA,GAAYtC,EAAcG,MAlD5B,IAmDHH,EAAcG,MAAQmC,EAnDnB,EAmD+C,OAqD9D,IAAAE,WAAU,KACNvB,MAEG,CAACwB,EAAMC,MACF,kBAAc,wBAAoB,MAAOzE,EAAY,CACzDyE,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAExE,MAAO,cAAgB,QAAS,KACtF,wBAAoB,MAAOC,EAAY,EACnC,wBAAoB,aACpB,wBAAoB,MAAOC,EAAY,CAClCiC,EAAgB,QACV,kBAAc,wBAAoB,SAAU,CAC3C3G,IAAK,EACLwE,MAAO,eACPyE,SAAkC,IAAxB3C,EAAcG,MACxByC,MAAO,MACPC,QAASrC,GACV,IAAKkC,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,OAAQ,KAAM,KAAM,MACtC,EAAerE,KACvB,wBAAoB,QAAQ,IAClC,wBAAoB,MAAOC,EAAY,GAClC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYgC,EAAYH,MAAQW,KAC5E,kBAAc,wBAAoB,SAAU,CAChDpH,IAAKoH,EACL5C,OAAO,oBAAgB,CAAC,aAAc,CAAE4E,OAAQzG,EAAU8D,QAAUW,KACpE+B,QAAUE,GAAY1G,EAAU8D,MAAQW,GACzC,EACC,wBAAoB,OAAQtC,GAAY,qBAAiBsC,GAAM,IAC/D,wBAAoB,OAAQrC,EAAY,KAAM,qBAAiBoC,EAAeC,GAAK9F,QAAU,IAAK,IACnG,GAAuBuD,KAC1B,QAEP8B,EAAgB,QACV,kBAAc,wBAAoB,SAAU,CAC3C3G,IAAK,EACLwE,MAAO,eACPyE,SAAU3C,EAAcG,MA5IjC,GA4I2D/D,EAAK+D,MAAMnF,OAC7D4H,MAAO,MACPC,QAASlC,GACV,IAAK+B,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,OAAQ,KAAM,KAAM,MACtC,EAAehE,KACvB,wBAAoB,QAAQ,IAClC,wBAAoB,SAAU,CAC1BR,MAAO,iBACPyE,SAAU7C,EAAUK,MACpByC,MAAO,SACPC,QAASpB,IACV,EACC,wBAAoB,OAAQ,CACxBvD,OAAO,oBAAgB,CAAE,cAAe4B,EAAUK,SACnD,IAAK,IACT,EAAexB,MAEtB,wBAAoB,MAAOC,EAAa,EACpC,wBAAoB,MAAOC,EAAa,CACpC6D,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAExE,MAAO,wBAA0B,EACpF,wBAAoB,KAAM,CAAEA,MAAO,uBAAyB,aAC5D,IACH4B,EAAe,QACT,kBAAc,wBAAoB,MAAOhB,EAAa,gBACzB,IAA7B5C,EAAYiE,MAAMnF,SACd,kBAAc,wBAAoB,MAAO+D,EAAa,eACtD,kBAAc,wBAAoB,MAAOC,EAAa,GACpD,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY6B,EAAexE,EAAU8D,OAASY,KAC1F,kBAAc,wBAAoB,MAAO,CAC7CrH,IAAKqH,EAAKZ,MACVjC,MAAO,wBACR,EACC,wBAAoB,SAAU,CAC1BA,OAAO,oBAAgB,CAAC,iBAAkB,CAAE8E,SAAU/C,EAAaE,QAAUY,EAAKZ,SAClF0C,QAAUE,GAAYrB,GAAiBX,EAAKZ,SAC7C,qBAAiBY,EAAKzD,OAAQ,GAA6B2B,GAC7D8B,EAAW,SACL,kBAAc,wBAAoB,MAAO7B,GAAa,qBAAiB6B,EAAKQ,QAAS,KACtF,wBAAoB,QAAQ,GACjCnB,EAAsBD,OAASY,EAAKnD,cAC9B,kBAAc,wBAAoB,MAAOuB,GAAa,qBAAiB4B,EAAKnD,aAAc,KACzFwC,EAAsBD,OAASY,EAAKpD,OACjC,kBAAc,wBAAoB,MAAOyB,GAAa,qBAAiB2B,EAAKpD,MAAO,KACpF,wBAAoB,QAAQ,OAE1C,gBAK5B,wBAAoB,MAAO0B,EAAa,EACpC,wBAAoB,SAAU,CAC1BnB,MAAO,aACP2E,QAASH,EAAO,KAAOA,EAAO,GAAMK,GAAYN,EAAKQ,MAAM,UAC5D,IAAKP,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,OAAQ,KAAM,OAAQ,QAElD,wBAAoB,SAAU,CAC1BxE,MAAO,aACPyE,SAAU7C,EAAUK,MACpB0C,QAASf,IACV,IAAKY,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,OAAQ,KAAM,OAAQ,MACxC,EAAepD,OAIzC,I,MJ1PJ,SAAS4D,EAAoBC,GAE5B,IAAIC,EAAexJ,EAAyBuJ,GAC5C,QAAqBvH,IAAjBwH,EACH,OAAOA,EAAa/J,QAGrB,IAAIgK,EAASzJ,EAAyBuJ,GAAY,CAGjD9J,QAAS,CAAC,GAOX,OAHAiK,EAAoBH,GAAUE,EAAQA,EAAOhK,QAAS6J,GAG/CG,EAAOhK,OACf,C,MKhBA,MAEA,GAFiC,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBCOvE,SAASkK,EAAcC,EAAWC,GAChC,OAAOD,EAAEE,cAAcD,EAAG,QAAS,CAAEE,YAAa,QACpD,CA2CA,MAAMC,EAAoB,UAGpBC,EAAyB,0BAKlBC,EAAwB,CACnCC,iBAAkB,GAClBC,yBAA0B,IAAIzI,KAwB1B0I,EAAgB,UAGhBC,EAAoB,sBAGpBC,EAAsB,sBAGtB,EAAiB,yBAKVC,EAAoB,CAC/BC,aAAc,GACdC,qBAAsB,IAAI/I,KA8BtBgJ,EAAoB,UAGpBC,EAAwB,sBAGxBC,GAA0B,sBAG1BC,GAA8B,iBAG9BC,GAAgC,iBAGhCC,GAAiC,iBAK1BC,GAAwB,CACnCC,iBAAkB,GAClBC,yBAA0B,IAAIxJ,KAsCzBlB,eAAe2K,KAKpB,MAAMxK,EAAWV,IAGXiK,SAFgBzJ,EAAmBsJ,EAAmBpJ,IAE3BG,IAAKC,IACpC,MAAM,MAAE0C,EAAK,OAAEiE,EAAM,KAAE0D,GAvC3B,SAA4BC,GAE1B,MAAMC,EAAiBD,EAAU9D,QAAQwC,EAAmB,IAGtDtC,EAAQ6D,EAAe7D,MAAMuC,GACnC,GAAIvC,EAAO,CACT,MAAM8D,EAAa9D,EAAM,IAAI+D,QAAU,GAEjCC,EAAYF,EAAW7C,QAAQ,KACrC,OAAI+C,EAAY,EACP,CACLhI,MAAOgE,EAAM,GAAG+D,OAChB9D,OAAQ6D,EAAWG,UAAU,EAAGD,GAAWD,OAC3CJ,KAAMG,EAAWG,UAAUD,EAAY,GAAGD,QAGvC,CACL/H,MAAOgE,EAAM,GAAG+D,OAChB9D,OAAQ6D,EACRH,KAAM,GAEV,CAEA,MAAO,CAAE3H,MAAO6H,EAAgB5D,OAAQ,GAAI0D,KAAM,GACpD,CAcoCO,CAAmB5K,EAAMC,MACzD,MAAO,CACLsF,MAAOvF,EAAMC,KACbyC,QACAiE,SACA0D,OACAnK,QAASF,EAAME,WAKb2K,GApM6BC,EAoMiB3B,EAnM7C,IAAI2B,GAASC,KAAK,CAACnC,EAAGC,IAAMF,EAAcC,EAAElG,MAAOmG,EAAEnG,SADvD,IAA8BoI,EAuMnC,MAAM1B,EAA2B,IAAIzI,IACnCkK,EAAuB9K,IAAIiL,GAAQ,CAACA,EAAKzF,MAAOyF,EAAK9K,WAGvD,MAAO,CAAEiJ,iBAAkB0B,EAAwBzB,2BAA0BxJ,WAC/E,CAsCOH,eAAewL,GACpB9B,EACAC,EACAxJ,GAEA,IAzBK,SACLuJ,EACAC,GAEA,IAAK,MAAM4B,KAAQ7B,EAEjB,IADqBC,EAAyBrI,IAAIiK,EAAKzF,SAAU,KAC5CyF,EAAK9K,QACxB,OAAO,EAGX,OAAO,CACT,CAcOgL,CAAoB/B,EAAkBC,GACzC,OAAOD,EAIT,MAAM/B,EAAiBC,MAAMC,KAAK8B,GAA0BrJ,IAAI,EAAEE,EAAMC,MAAa,CACnFD,OACAC,aAMF,aAHMK,EAAgB6G,EAAgBxH,GAG/BuJ,EAAiBpJ,IAAIiL,IAAQ,IAC/BA,EACH9K,QAASkJ,EAAyBrI,IAAIiK,EAAKzF,SAAU,IAEzD,CAWA,SAAS4F,GAAgBb,GACvB,MAAM5D,EAAQ4D,EAAU5D,MAAM4C,GAC9B,OAAO5C,EAAQA,EAAM,GAAK,IAC5B,CAOA,SAAS0E,GAAkBC,GACzB,MAAM3E,EAAQ2E,EAAS3E,MAAM6C,GAC7B,OAAO7C,EAAQA,EAAM,GAAK2E,CAC5B,CAOA,SAASC,GAAuB9K,GAC9B,IAAK,MAAMR,KAASQ,EAAS,CAC3B,MAAMkG,EAAQ1G,EAAMC,KAAKyG,MAAM,GAC/B,GAAIA,EAAO,CACT,MAAM8D,EAAa9D,EAAM,GAAG+D,OACtBC,EAAYF,EAAW7C,QAAQ,KACrC,OAAI+C,EAAY,EACP,CACL/D,OAAQ6D,EAAWG,UAAU,EAAGD,GAAWD,OAC3CJ,KAAMG,EAAWG,UAAUD,EAAY,GAAGD,QAGvC,CAAE9D,OAAQ6D,EAAYH,KAAM,GACrC,CACF,CACA,MAAO,CAAE1D,OAAQ,GAAI0D,KAAM,GAC7B,CAKO5K,eAAe8L,KAKpB,MAAM3L,EAAWV,IACXsB,QAAgBd,EAAmB2J,EAAezJ,GAGlD4L,EAAc,IAAI7K,IAExB,IAAK,MAAMX,KAASQ,EAAiD,CACnE,MAAM6K,EAAWF,GAAgBnL,EAAMC,MAClCoL,IAEAG,EAAYC,IAAIJ,IACnBG,EAAYxE,IAAIqE,EAAU,IAE5BG,EAAYzK,IAAIsK,GAAWpI,KAAK,CAC9BhD,KAAMD,EAAMC,KACZC,QAASF,EAAME,UAEnB,CAGA,MAAMuJ,EAA8B,GACpC,IAAK,MAAO4B,EAAUK,KAAiBF,EAAa,CAElD,MAAMG,EAAaD,EAAaE,MAAMhL,GAAKA,EAAEV,UACvC,OAAEyG,EAAM,KAAE0D,GAASiB,GAAuBI,GAChDjC,EAAaxG,KAAK,CAChBoI,WACA3I,MAAO0I,GAAkBC,GACzB1E,SACA0D,OACA7J,QAASkL,EACTxL,QAASyL,GAEb,CAGA,MAAME,GA5VyBf,EA4VarB,EA3VrC,IAAIqB,GAASC,KAAK,CAACnC,EAAGC,IAAMF,EAAcC,EAAElG,MAAOmG,EAAEnG,SADvD,IAA0BoI,EA+V/B,MAAMpB,EAAuB,IAAI/I,IAC/BkL,EAAmB9L,IAAI+L,GAAS,CAACA,EAAMT,SAAUS,EAAM5L,WAGzD,MAAO,CAAEuJ,aAAcoC,EAAoBnC,uBAAsB9J,WACnE,CAsCOH,eAAesM,GACpBtC,EACAC,EACA9J,GAEA,IAzBK,SACL6J,EACAC,GAEA,IAAK,MAAMoC,KAASrC,EAElB,IADqBC,EAAqB3I,IAAI+K,EAAMT,YAAa,KAC5CS,EAAM5L,QACzB,OAAO,EAGX,OAAO,CACT,CAcO8L,CAAgBvC,EAAcC,GACjC,OAAOD,EAIT,MAAMrC,EAA4D,GAElE,IAAK,MAAM0E,KAASrC,EAAc,CAChC,MAAM3I,EAAa4I,EAAqB3I,IAAI+K,EAAMT,YAAa,EAC/D,IAAK,MAAMrL,KAAS8L,EAAMtL,QACxB4G,EAAenE,KAAK,CAClBhD,KAAMD,EAAMC,KACZC,QAASY,GAGf,CAKA,aAHMP,EAAgB6G,EAAgBxH,GAG/B6J,EAAa1J,IAAI+L,IACtB,MAAMhL,EAAa4I,EAAqB3I,IAAI+K,EAAMT,YAAa,EAC/D,MAAO,IACFS,EACH5L,QAASY,EACTN,QAASsL,EAAMtL,QAAQT,IAAIC,IAAS,IAC/BA,EACHE,QAASY,OAIjB,CAWA,SAASmL,GAAoB3B,GAC3B,MAAM5D,EAAQ4D,EAAU5D,MAAMkD,GAC9B,OAAOlD,EAAQA,EAAM,GAAK,IAC5B,CAOA,SAASwF,GAAsBC,GAC7B,MAAMzF,EAAQyF,EAAazF,MAAMmD,IACjC,OAAOnD,EAAQA,EAAM,GAAKyF,CAC5B,CAOA,SAASC,GAAiC9B,GACxC,MAAM+B,EAAoB,GACpBC,EAAQ,IAAIC,OAAOzC,GAA4B0C,OAAQ,KAC7D,IAAI9F,EACJ,KAA2C,QAAnCA,EAAQ4F,EAAMG,KAAKnC,KACzB+B,EAAQpJ,KAAKyD,EAAM,IAErB,OAAO2F,CACT,CAOA,SAASK,GAAmCpC,GAC1C,MAAM+B,EAAoB,GACpBC,EAAQ,IAAIC,OAAOxC,GAA8ByC,OAAQ,KAC/D,IAAI9F,EACJ,KAA2C,QAAnCA,EAAQ4F,EAAMG,KAAKnC,KACzB+B,EAAQpJ,KAAKyD,EAAM,IAErB,OAAO2F,CACT,CAOA,SAASM,GAAoCrC,GAC3C,MAAM+B,EAAoB,GACpBC,EAAQ,IAAIC,OAAOvC,GAA+BwC,OAAQ,KAChE,IAAI9F,EACJ,KAA2C,QAAnCA,EAAQ4F,EAAMG,KAAKnC,KACzB+B,EAAQpJ,KAAKyD,EAAM,IAErB,OAAO2F,CACT,CAOA,SAASO,GAAiCpM,GACxC,MAAMqM,EAAa,IAAIC,IACvB,IAAK,MAAM9M,KAASQ,EAAS,CACX4L,GAAiCpM,EAAMC,MAC/C8M,QAAQC,GAAKH,EAAWI,IAAID,GACtC,CACA,OAAO3F,MAAMC,KAAKuF,EACpB,CAOA,SAASK,GAAmC1M,GAC1C,MAAMqM,EAAa,IAAIC,IACvB,IAAK,MAAM9M,KAASQ,EAAS,CACXkM,GAAmC1M,EAAMC,MACjD8M,QAAQC,GAAKH,EAAWI,IAAID,GACtC,CACA,OAAO3F,MAAMC,KAAKuF,EACpB,CAOA,SAASM,GAAoC3M,GAC3C,MAAMqM,EAAa,IAAIC,IACvB,IAAK,MAAM9M,KAASQ,EAAS,CACXmM,GAAoC3M,EAAMC,MAClD8M,QAAQC,GAAKH,EAAWI,IAAID,GACtC,CACA,OAAO3F,MAAMC,KAAKuF,EACpB,CAOA,SAASO,GAA2B5M,GAClC,IAAK,MAAMR,KAASQ,EAAS,CAC3B,MAAMkG,EAAQ1G,EAAMC,KAAKyG,MAAM,GAC/B,GAAIA,EAAO,CACT,MAAM8D,EAAa9D,EAAM,GAAG+D,OACtBC,EAAYF,EAAW7C,QAAQ,KACrC,OAAI+C,EAAY,EACP,CACL/D,OAAQ6D,EAAWG,UAAU,EAAGD,GAAWD,OAC3CJ,KAAMG,EAAWG,UAAUD,EAAY,GAAGD,QAGvC,CAAE9D,OAAQ6D,EAAYH,KAAM,GACrC,CACF,CACA,MAAO,CAAE1D,OAAQ,GAAI0D,KAAM,GAC7B,CAKO5K,eAAe4N,KAKpB,MAAMzN,EAAWV,IACXsB,QAAgBd,EAAmBiK,EAAmB/J,GAGtD0N,EAAkB,IAAI3M,IAE5B,IAAK,MAAMX,KAASQ,EAAiD,CACnE,MAAM2L,EAAeF,GAAoBjM,EAAMC,MAC1CkM,IAEAmB,EAAgB7B,IAAIU,IACvBmB,EAAgBtG,IAAImF,EAAc,IAEpCmB,EAAgBvM,IAAIoL,GAAelJ,KAAK,CACtChD,KAAMD,EAAMC,KACZC,QAASF,EAAME,UAEnB,CAGA,MAAMgK,EAAsC,GAC5C,IAAK,MAAOiC,EAAcT,KAAiB4B,EAAiB,CAE1D,MAAM3B,EAAaD,EAAaE,MAAMhL,GAAKA,EAAEV,UACvC,OAAEyG,EAAM,KAAE0D,GAAS+C,GAA2B1B,GACpDxB,EAAiBjH,KAAK,CACpBkJ,eACAzJ,MAAOwJ,GAAsBC,GAC7BxF,SACA0D,OACAkD,iBAAkBX,GAAiClB,GACnD8B,mBAAoBN,GAAmCxB,GACvD+B,oBAAqBN,GAAoCzB,GACzDlL,QAASkL,EACTxL,QAASyL,GAEb,CAGA,MAAM+B,GA5lB6B5C,EA4lBiBZ,EA3lB7C,IAAIY,GAASC,KAAK,CAACnC,EAAGC,IAAMF,EAAcC,EAAElG,MAAOmG,EAAEnG,SADvD,IAA8BoI,EA+lBnC,MAAMX,EAA2B,IAAIxJ,IACnC+M,EAAuB3N,IAAI4N,GAAO,CAACA,EAAIxB,aAAcwB,EAAIzN,WAG3D,MAAO,CAAEgK,iBAAkBwD,EAAwBvD,2BAA0BvK,WAC/E,CAgOOH,eAAemO,GACpB1D,EACAC,EACAvK,GAEA,IAnGK,SACLsK,EACAC,GAEA,IAAK,MAAMwD,KAAOzD,EAEhB,IADqBC,EAAyBpJ,IAAI4M,EAAIxB,gBAAiB,KAClDwB,EAAIzN,QACvB,OAAO,EAGX,OAAO,CACT,CAwFO2N,CAAoB3D,EAAkBC,GACzC,OAAOD,EAIT,MAAM4D,EAA0B,IAAInN,IAClCuJ,EAAiBnK,IAAI4N,GAAO,CAACA,EAAIxB,aAAcwB,EAAIzN,WAI/CkH,EAA4D,GAElE,IAAK,MAAMuG,KAAOzD,EAAkB,CAClC,MAAMpJ,EAAaqJ,EAAyBpJ,IAAI4M,EAAIxB,gBAAiB,EACrE,IAAK,MAAMnM,KAAS2N,EAAInN,QACtB4G,EAAenE,KAAK,CAClBhD,KAAMD,EAAMC,KACZC,QAASY,GAGf,CAGA,MAAMiN,EAvGR,SACE7D,EACAC,GAEA,MAAMoD,EAA6B,GAEnC,IAAK,MAAMI,KAAOzD,EACEC,EAAyBpJ,IAAI4M,EAAIxB,eAClCwB,EAAIJ,iBAAiBnN,OAAS,GAC7CmN,EAAiBtK,QAAQ0K,EAAIJ,kBAKjC,MAAO,IAAI,IAAIT,IAAIS,GACrB,CAwFoCS,CAChC9D,EACAC,GAII8D,EAtFR,SACE/D,EACAC,GAEA,MAAMqD,EAA+B,GAErC,IAAK,MAAMG,KAAOzD,EACEC,EAAyBpJ,IAAI4M,EAAIxB,eAClCwB,EAAIH,mBAAmBpN,OAAS,GAC/CoN,EAAmBvK,QAAQ0K,EAAIH,oBAKnC,MAAO,IAAI,IAAIV,IAAIU,GACrB,CAuEsCU,CAClChE,EACAC,GAIIgE,EApER,SACEjE,EACAC,EACA2D,GAEA,MAAMN,EAA+B,GAErC,IAAK,MAAMG,KAAOzD,EAAkB,CAClC,MAAMkE,EAAYjE,EAAyBpJ,IAAI4M,EAAIxB,gBAAiB,EAC9DkC,EAAaP,EAAwB/M,IAAI4M,EAAIxB,gBAAiB,GAG/DiC,GAAaC,GAAcV,EAAIH,mBAAmBpN,OAAS,GAC9DoN,EAAmBvK,QAAQ0K,EAAIH,mBAEnC,CAGA,MAAO,IAAI,IAAIV,IAAIU,GACrB,CAiDqCc,CACjCpE,EACAC,EACA2D,GAIIS,EAAqCJ,EAA2B9N,OACpEzB,IACGqP,EAA4B7H,SAASxH,KAAYmP,EAA0B3H,SAASxH,IAIzF,GAAImP,EAA0B3N,OAAS,EACrC,IAAK,MAAMxB,KAAUmP,EAA2B,CAC9C,MAAMpO,EAAU,IAAI4M,OAAO,MAAMiC,GAAa5P,SACxC6P,QAAwB/O,EAAmBC,EAASC,GAE1D,IAAK,MAAMI,KAASyO,EAAyD,CAE3E,MAAMC,EAAgBtH,EAAeuH,UAAU/N,GAAKA,EAAEX,OAASD,EAAMC,OAC9C,IAAnByO,EACFtH,EAAenE,KAAK,CAClBhD,KAAMD,EAAMC,KACZC,SAAS,IAIXkH,EAAesH,GAAexO,SAAU,CAE5C,CACF,CAIF,GAAI+N,EAA4B7N,OAAS,EACvC,IAAK,MAAMxB,KAAUqP,EAA6B,CAChD,MAAMtO,EAAU,IAAI4M,OAAO,MAAMiC,GAAa5P,SACxC6P,QAAwB/O,EAAmBC,EAASC,GAE1D,IAAK,MAAMI,KAASyO,EAAyD,CAE3E,MAAMC,EAAgBtH,EAAeuH,UAAU/N,GAAKA,EAAEX,OAASD,EAAMC,OAC9C,IAAnByO,EACFtH,EAAenE,KAAK,CAClBhD,KAAMD,EAAMC,KACZC,SAAS,IAIXkH,EAAesH,GAAexO,SAAU,CAE5C,CACF,CAIF,GAAIqO,EAAmCnO,OAAS,EAC9C,IAAK,MAAMxB,KAAU2P,EAAoC,CACvD,MAAM5O,EAAU,IAAI4M,OAAO,MAAMiC,GAAa5P,SACxC6P,QAAwB/O,EAAmBC,EAASC,GAE1D,IAAK,MAAMI,KAASyO,EAAyD,CAE3E,MAAMC,EAAgBtH,EAAeuH,UAAU/N,GAAKA,EAAEX,OAASD,EAAMC,OAC9C,IAAnByO,EACFtH,EAAenE,KAAK,CAClBhD,KAAMD,EAAMC,KACZC,SAAS,KAEwC,IAA1CkH,EAAesH,GAAexO,UAGvCkH,EAAesH,GAAexO,SAAU,EAE5C,CACF,CAMF,aAHMK,EAAgB6G,EAAgBxH,GAG/BsK,EAAiBnK,IAAI4N,IAC1B,MAAM7M,EAAaqJ,EAAyBpJ,IAAI4M,EAAIxB,gBAAiB,EACrE,MAAO,IACFwB,EACHzN,QAASY,EACTN,QAASmN,EAAInN,QAAQT,IAAIC,IAAS,IAC7BA,EACHE,QAASY,OAIjB,CAKA,SAAS0N,GAAaI,GACpB,OAAOA,EAAOpI,QAAQ,sBAAuB,OAC/C,CCt/BA,MAAM,GAAa,CAAElD,MAAO,iBACtB,GAAa,CAAEA,MAAO,2BACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAC,YACd,GAAa,CAAEA,MAAO,eACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CACfxE,IAAK,EACLwE,MAAO,gBAEL,GAAa,CACfxE,IAAK,EACLwE,MAAO,cAEL,GAAa,CACfxE,IAAK,EACLwE,MAAO,sBAEL,GAAc,CAAEA,MAAO,aACvB,GAAc,CAAC,WACf,GAAc,CAAEA,MAAO,eACvB,GAAc,CAAEA,MAAO,eACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,cACvB,GAAc,CAAEA,MAAO,gBACvB,GAAc,CAAEA,MAAO,kBACvB,GAAc,CAChBxE,IAAK,EACLwE,MAAO,sBAEL,GAAc,CAAEA,MAAO,iBACvB,GAAc,CAChBxE,IAAK,EACLwE,MAAO,gBAELuL,GAAc,CAChB/P,IAAK,EACLwE,MAAO,cAELwL,GAAc,CAChBhQ,IAAK,EACLwE,MAAO,sBAELyL,GAAc,CAAEzL,MAAO,aACvB0L,GAAc,CAAC,WACfC,GAAc,CAAE3L,MAAO,eACvB4L,GAAc,CAAE5L,MAAO,eACvB6L,GAAc,CAAE7L,MAAO,cACvB8L,GAAc,CAAE9L,MAAO,gBACvB+L,GAAc,CAAE/L,MAAO,cACvBgM,GAAc,CAAEhM,MAAO,gBACvBiM,GAAc,CAAEjM,MAAO,cACvBkM,GAAc,CAAElM,MAAO,gBACvBmM,GAAc,CAAEnM,MAAO,kBACvBoM,GAAc,CAChB5Q,IAAK,EACLwE,MAAO,sBAELqM,GAAc,CAAErM,MAAO,iBACvBsM,GAAc,CAChB9Q,IAAK,EACLwE,MAAO,gBAELuM,GAAc,CAChB/Q,IAAK,EACLwE,MAAO,cAELwM,GAAc,CAChBhR,IAAK,EACLwE,MAAO,sBAELyM,GAAc,CAAEzM,MAAO,aACvB0M,GAAc,CAAC,WACfC,GAAc,CAAE3M,MAAO,eACvB4M,GAAc,CAAE5M,MAAO,eACvB6M,GAAc,CAAE7M,MAAO,cACvB8M,GAAc,CAAE9M,MAAO,gBACvB+M,GAAc,CAAE/M,MAAO,cACvBgN,GAAc,CAAEhN,MAAO,gBACvBiN,GAAc,CAChBzR,IAAK,EACLwE,MAAO,cAELkN,GAAc,CAAElN,MAAO,+BACvBmN,GAAc,CAChB3R,IAAK,EACLwE,MAAO,cAELoN,GAAc,CAAEpN,MAAO,iCACvBqN,GAAc,CAChB7R,IAAK,EACLwE,MAAO,cAELsN,GAAc,CAAEtN,MAAO,kCACvBuN,GAAc,CAAEvN,MAAO,cACvBwN,GAAc,CAAExN,MAAO,gBACvByN,GAAc,CAAEzN,MAAO,kBACvB0N,GAAc,CAChBlS,IAAK,EACLwE,MAAO,sBAEL2N,GAAc,CAAE3N,MAAO,eACvB4N,GAAc,CAAC,YAGrB,IAA6B,qBAAiB,CAC1CvM,OAAQ,oBACRC,MAAO,CAAC,QACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMD,EAAOC,EACPE,GAAY,IAAAC,MAAI,GAEhB1D,GAAY,IAAA0D,KAAI,cAEhBgM,GAAoB,IAAAhM,KAAI,MACxBiM,GAAgB,IAAAjM,KAAI,MACpBkM,GAAoB,IAAAlM,KAAI,MAExBgE,GAAmB,IAAAhE,KAAI,IAAI+D,EAAsBC,mBACjDC,GAA2B,IAAAjE,KAAI,IAAIxE,IAAIuI,EAAsBE,2BAE7DK,GAAe,IAAAtE,KAAI,IAAIqE,EAAkBC,eACzCC,GAAuB,IAAAvE,KAAI,IAAIxE,IAAI6I,EAAkBE,uBAErDQ,GAAmB,IAAA/E,KAAI,IAAI8E,GAAsBC,mBACjDC,GAA2B,IAAAhF,KAAI,IAAIxE,IAAIsJ,GAAsBE,2BAC7DvK,GAAW,IAAAuF,KAAI,MAEfmM,GAA2B,IAAAhM,UAAS,IACjC6L,EAAkB5L,OAEhB4D,EAAiB5D,MAAMgM,KAAKC,GAAKA,EAAEjM,QAAU4L,EAAkB5L,QAD3D,MAGTkM,GAAuB,IAAAnM,UAAS,IAC7B8L,EAAc7L,OAEZkE,EAAalE,MAAMgM,KAAK3Q,GAAKA,EAAEyK,WAAa+F,EAAc7L,QADtD,MAGTmM,GAA2B,IAAApM,UAAS,IACjC+L,EAAkB9L,OAEhB2E,EAAiB3E,MAAMgM,KAAK3Q,GAAKA,EAAEuL,eAAiBkF,EAAkB9L,QADlE,MAGf9F,eAAekS,IACXzM,EAAUK,OAAQ,EAClB,IAEI,MAAOqM,EAAYC,EAAaC,SAAmBC,QAAQC,IAAI,CAC3D5H,KACAmB,KACA8B,OAGJlE,EAAiB5D,MAAQqM,EAAWzI,iBACpCC,EAAyB7D,MAAQqM,EAAWxI,yBAC5CxJ,EAAS2F,MAAQqM,EAAWhS,SAE5B6J,EAAalE,MAAQsM,EAAYpI,aACjCC,EAAqBnE,MAAQsM,EAAYnI,qBAEzCQ,EAAiB3E,MAAQuM,EAAU5H,iBACnCC,EAAyB5E,MAAQuM,EAAU3H,wBAC/C,CACA,MAAO/H,GACHJ,QAAQI,MAAM,aAAcA,GAC5B+G,EAAiB5D,MAAQ,GACzB6D,EAAyB7D,MAAQ,IAAI5E,IACrC8I,EAAalE,MAAQ,GACrBmE,EAAqBnE,MAAQ,IAAI5E,IACjCuJ,EAAiB3E,MAAQ,GACzB4E,EAAyB5E,MAAQ,IAAI5E,IACrCf,EAAS2F,MAAQ,IACrB,CACA,QACIL,EAAUK,OAAQ,CACtB,CACJ,CACA9F,eAAeoH,UACL8K,GACV,CACA,SAASM,EAAsBC,GAC3B9I,EAAyB7D,MD+C9B,SACL6D,EACA8I,GAEA,MAAMnL,EAAgB,IAAIpG,IAAIyI,GACxB+I,EAAiBpL,EAAchG,IAAImR,KAAmB,EAE5D,OADAnL,EAAcC,IAAIkL,GAAiBC,GAC5BpL,CACT,CCvD6CqL,CAAgBhJ,EAAyB7D,MAAO2M,EACrF,CACA,SAASG,EAAkBhH,GACvB3B,EAAqBnE,MD6M1B,SACLmE,EACA2B,GAEA,MAAMtE,EAAgB,IAAIpG,IAAI+I,GACxByI,EAAiBpL,EAAchG,IAAIsK,KAAa,EAEtD,OADAtE,EAAcC,IAAIqE,GAAW8G,GACtBpL,CACT,CCrNyCuL,CAAY5I,EAAqBnE,MAAO8F,EACzE,CACA,SAASkH,EAAsBpG,GAC3B,MAAM7F,EDsgBX,SACL6D,EACAD,EACAiC,GAEA,MAAMpF,EAAgB,IAAIpG,IAAIwJ,GAExBrJ,GADiBiG,EAAchG,IAAIoL,GAGnCqG,EAAkBtI,EAAiBqH,KAAK5D,GAAOA,EAAIxB,eAAiBA,GAG1E,GAAIrL,GAAc0R,GAEZA,EAAgB/E,oBAAoBrN,OAAS,EAAG,CAClD,MAAM,UAAEqS,EAAS,qBAAEC,GA9DzB,SACExI,EACAC,EACAsD,GAEA,MAAMiF,EAAiC,GAEvC,IAAK,MAAM9T,KAAU6O,EAAqB,CAExC,MAAMkF,EAAwBzI,EAAiBqH,KAAK5D,GAClDA,EAAIxB,aAAa/F,SAAS,IAAIxH,OAE5B+T,GACgBxI,EAAyBpJ,IAAI4R,EAAsBxG,eAMrEuG,EAAqBzP,KAAKrE,EAE9B,CAEA,MAAO,CACL6T,UAA2C,IAAhCC,EAAqBtS,OAChCsS,uBAEJ,CAmCkDE,CAC1C1I,EACAnD,EACAyL,EAAgB/E,qBAGlB,IAAKgF,EACH,MAAO,CACLI,WAAY1I,EACZ2I,SAAS,EACT1Q,MAAO,WAAWsQ,EAAqBK,KAAK,QAC5CL,uBAGN,CAMF,GAHA3L,EAAcC,IAAImF,EAAcrL,GAG5BA,GAAc0R,EAEhB,IAAK,MAAMQ,KAAmBR,EAAgBjF,iBAE5C,IAAK,MAAMI,KAAOzD,EAGdyD,EAAIxB,eAAiBA,GACpBwB,EAAIjL,QAAUsQ,IAAmBrF,EAAIxB,aAAa/F,SAAS,IAAI4M,OAEhEjM,EAAcC,IAAI2G,EAAIxB,cAAc,GAO5C,IAAKrL,GAAc0R,EAEjB,IAAK,MAAM7E,KAAOzD,EACZyD,EAAIxB,eAAiBA,GACLpF,EAAchG,IAAI4M,EAAIxB,eACvBwB,EAAIF,oBAAoBrH,SAASoM,EAAgB9P,QAEhEqE,EAAcC,IAAI2G,EAAIxB,cAAc,GAM5C,MAAO,CACL0G,WAAY9L,EACZ+L,SAAS,EAEb,CC3kB2BG,CAAgB9I,EAAyB5E,MAAO2E,EAAiB3E,MAAO4G,GACnF7F,EAAOwM,QACP3I,EAAyB5E,MAAQe,EAAOuM,WAIxCK,MAAM5M,EAAOlE,OAAS,OAE9B,CAIA3C,eAAeyH,IACXhC,EAAUK,OAAQ,EAClB,IACI,GAAI3F,EAAS2F,MAAO,CAEhB,MAAO4N,EAAmBC,EAAeC,SAA2BtB,QAAQC,IAAI,CAC5E/G,GAA4B9B,EAAiB5D,MAAO6D,EAAyB7D,MAAO3F,EAAS2F,OAC7FwG,GAAwBtC,EAAalE,MAAOmE,EAAqBnE,MAAO3F,EAAS2F,OACjFqI,GAA4B1D,EAAiB3E,MAAO4E,EAAyB5E,MAAO3F,EAAS2F,SAEjG4D,EAAiB5D,MAAQ4N,EACzB1J,EAAalE,MAAQ6N,EACrBlJ,EAAiB3E,MAAQ8N,CAC7B,CACJ,CACA,MAAOjR,GACHJ,QAAQI,MAAM,aAAcA,EAChC,CACA,QACI8C,EAAUK,OAAQ,CACtB,CACAR,EAAK,OACT,CAKA,OAHA,IAAA6C,WAAU,KACN+J,MAEG,CAAC9J,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,CACzDA,EAAO,MAAQA,EAAO,KAAM,wBAAoB,KAAM,CAAExE,MAAO,cAAgB,UAAW,KAC1F,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,aACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,SAAU,CAC1BA,OAAO,oBAAgB,CAAC,aAAc,CAAE4E,OAA4B,eAApBzG,EAAU8D,SAC1D0C,QAASH,EAAO,KAAOA,EAAO,GAAMK,IAChC1G,EAAU8D,MAAQ,aAClB4L,EAAkB5L,MAAQ,QAE/B,IAAKuC,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,OAAQ,CAAExE,MAAO,aAAe,MAAO,MACzD,IACV,wBAAoB,SAAU,CAC1BA,OAAO,oBAAgB,CAAC,aAAc,CAAE4E,OAA4B,WAApBzG,EAAU8D,SAC1D0C,QAASH,EAAO,KAAOA,EAAO,GAAMK,IAChC1G,EAAU8D,MAAQ,SAClB6L,EAAc7L,MAAQ,QAE3B,IAAKuC,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,OAAQ,CAAExE,MAAO,aAAe,MAAO,MACzD,IACV,wBAAoB,SAAU,CAC1BA,OAAO,oBAAgB,CAAC,aAAc,CAAE4E,OAA4B,eAApBzG,EAAU8D,SAC1D0C,QAASH,EAAO,KAAOA,EAAO,GAAMK,IAChC1G,EAAU8D,MAAQ,aAClB8L,EAAkB9L,MAAQ,QAE/B,IAAKuC,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,OAAQ,CAAExE,MAAO,aAAe,MAAO,MACzD,IACV,wBAAoB,SAAU,CAC1BA,MAAO,iBACPyE,SAAU7C,EAAUK,MACpByC,MAAO,OACPC,QAASpB,GACV,EACC,wBAAoB,OAAQ,CACxBvD,OAAO,oBAAgB,CAAE,cAAe4B,EAAUK,SACnD,IAAK,IACT,EAAe,OAEtB,wBAAoB,eACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,8BACpB,qBAAgB,wBAAoB,MAAO,GAAY,CAClDL,EAAe,QACT,kBAAc,wBAAoB,MAAO,GAAY,gBACnB,IAAlCiE,EAAiB5D,MAAMnF,SACnB,kBAAc,wBAAoB,MAAO,GAAY,eACrD,kBAAc,wBAAoB,MAAO,GAAY,EACpD,wBAAoB,MAAO,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY+I,EAAiB5D,MAAQyF,KACjF,kBAAc,wBAAoB,SAAU,CAChDlM,IAAKkM,EAAKzF,MACVjC,OAAO,oBAAgB,CAAC,YAAa,CAC7B,aAAc8F,EAAyB7D,MAAMxE,IAAIiK,EAAKzF,OACtD6C,SAAU+I,EAAkB5L,QAAUyF,EAAKzF,SAEnD0C,QAAUE,GAAYgJ,EAAkB5L,MAAQyF,EAAKzF,QACtD,qBAAiByF,EAAKtI,OAAQ,GAA6B,MAC9D,SAER,wBAAoB,MAAO,GAAa,CACnCyO,EAAkB5L,OAAS+L,EAAyB/L,QAC9C,kBAAc,wBAAoB,WAAW,CAAEzG,IAAK,GAAK,EACxD,wBAAoB,KAAM,IAAa,qBAAiBwS,EAAyB/L,MAAM7C,OAAQ,IAC/F,wBAAoB,MAAO,GAAa,CACpCoF,EAAO,KAAOA,EAAO,IAAK,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KACzF,wBAAoB,OAAQ,IAAa,qBAAiBgO,EAAyB/L,MAAMoB,QAAU,MAAO,MAE9G,wBAAoB,MAAO,GAAa,CACpCmB,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQ,IAAa,qBAAiBgO,EAAyB/L,MAAM8E,MAAQ,KAAM,MAE3G,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,SAAU,CAC1B/G,OAAO,oBAAgB,CAAC,aAAc,CAAE,aAAc8F,EAAyB7D,MAAMxE,IAAIoQ,EAAkB5L,UAC3G0C,QAASH,EAAO,KAAOA,EAAO,GAAMK,GAAY8J,EAAsBd,EAAkB5L,UACzF,qBAAiB6D,EAAyB7D,MAAMxE,IAAIoQ,EAAkB5L,OAAS,MAAQ,OAAQ,MAEvG,OACA,kBAAc,wBAAoB,MAAO,GAAa,sBAG9E,KAAuB,CACtB,CAAC,QAA4B,eAApB9D,EAAU8D,UAEvB,wBAAoB,0BACpB,qBAAgB,wBAAoB,MAAO,GAAa,CACnDL,EAAe,QACT,kBAAc,wBAAoB,MAAO,GAAa,gBACxB,IAA9BuE,EAAalE,MAAMnF,SACf,kBAAc,wBAAoB,MAAOyO,GAAa,eACtD,kBAAc,wBAAoB,MAAOC,GAAa,EACrD,wBAAoB,MAAOC,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAYtF,EAAalE,MAAQuG,KAC7E,kBAAc,wBAAoB,SAAU,CAChDhN,IAAKgN,EAAMT,SACX/H,OAAO,oBAAgB,CAAC,YAAa,CAC7B,aAAcoG,EAAqBnE,MAAMxE,IAAI+K,EAAMT,UACnDjD,SAAUgJ,EAAc7L,QAAUuG,EAAMT,YAEhDpD,QAAUE,GAAYiJ,EAAc7L,MAAQuG,EAAMT,WACnD,qBAAiBS,EAAMpJ,OAAQ,GAA6BsM,MAC/D,SAER,wBAAoB,MAAOC,GAAa,CACnCmC,EAAc7L,OAASkM,EAAqBlM,QACtC,kBAAc,wBAAoB,WAAW,CAAEzG,IAAK,GAAK,EACxD,wBAAoB,KAAMoQ,IAAa,qBAAiBuC,EAAqBlM,MAAM7C,OAAQ,IAC3F,wBAAoB,MAAOyM,GAAa,CACpCrH,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQ8L,IAAa,qBAAiBqC,EAAqBlM,MAAMoB,QAAU,MAAO,MAE1G,wBAAoB,MAAO0I,GAAa,CACpCvH,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQgM,IAAa,qBAAiBmC,EAAqBlM,MAAM/E,QAAQJ,QAAU,OAAQ,MAEnH,wBAAoB,MAAOmP,GAAa,CACpCzH,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQkM,IAAa,qBAAiBiC,EAAqBlM,MAAM8E,MAAQ,KAAM,MAEvG,wBAAoB,MAAOoF,GAAa,EACpC,wBAAoB,SAAU,CAC1BnM,OAAO,oBAAgB,CAAC,aAAc,CAAE,aAAcoG,EAAqBnE,MAAMxE,IAAIqQ,EAAc7L,UACnG0C,QAASH,EAAO,KAAOA,EAAO,GAAMK,GAAYkK,EAAkBjB,EAAc7L,UACjF,qBAAiBmE,EAAqBnE,MAAMxE,IAAIqQ,EAAc7L,OAAS,MAAQ,OAAQ,MAE/F,OACA,kBAAc,wBAAoB,MAAOmK,GAAa,sBAG9E,KAAuB,CACtB,CAAC,QAA4B,WAApBjO,EAAU8D,UAEvB,wBAAoB,6BACpB,qBAAgB,wBAAoB,MAAOoK,GAAa,CACnDzK,EAAe,QACT,kBAAc,wBAAoB,MAAO0K,GAAa,gBACpB,IAAlC1F,EAAiB3E,MAAMnF,SACnB,kBAAc,wBAAoB,MAAOyP,GAAa,eACtD,kBAAc,wBAAoB,MAAOC,GAAa,EACrD,wBAAoB,MAAOC,GAAa,GACnC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,gBAAY7F,EAAiB3E,MAAQoI,KACjF,kBAAc,wBAAoB,SAAU,CAChD7O,IAAK6O,EAAIxB,aACT7I,OAAO,oBAAgB,CAAC,YAAa,CAC7B,aAAc6G,EAAyB5E,MAAMxE,IAAI4M,EAAIxB,cACrD/D,SAAUiJ,EAAkB9L,QAAUoI,EAAIxB,gBAElDlE,QAAUE,GAAYkJ,EAAkB9L,MAAQoI,EAAIxB,eACrD,qBAAiBwB,EAAIjL,OAAQ,GAA6BsN,MAC7D,SAER,wBAAoB,MAAOC,GAAa,CACnCoB,EAAkB9L,OAASmM,EAAyBnM,QAC9C,kBAAc,wBAAoB,WAAW,CAAEzG,IAAK,GAAK,EACxD,wBAAoB,KAAMoR,IAAa,qBAAiBwB,EAAyBnM,MAAM7C,OAAQ,IAC/F,wBAAoB,MAAOyN,GAAa,CACpCrI,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQ8M,IAAa,qBAAiBsB,EAAyBnM,MAAMoB,QAAU,MAAO,MAE9G,wBAAoB,MAAO0J,GAAa,CACpCvI,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQgN,IAAa,qBAAiBoB,EAAyBnM,MAAM/E,QAAQJ,QAAU,OAAQ,KAEtHsR,EAAyBnM,MAAMgI,iBAAiBnN,OAAS,IACnD,kBAAc,wBAAoB,MAAOmQ,GAAa,CACrDzI,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQkN,IAAa,qBAAiBkB,EAAyBnM,MAAMgI,iBAAiBwF,KAAK,OAAQ,OAEzH,wBAAoB,QAAQ,GACjCrB,EAAyBnM,MAAMiI,mBAAmBpN,OAAS,IACrD,kBAAc,wBAAoB,MAAOqQ,GAAa,CACrD3I,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQoN,IAAa,qBAAiBgB,EAAyBnM,MAAMiI,mBAAmBuF,KAAK,OAAQ,OAE3H,wBAAoB,QAAQ,GACjCrB,EAAyBnM,MAAMkI,oBAAoBrN,OAAS,IACtD,kBAAc,wBAAoB,MAAOuQ,GAAa,CACrD7I,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQsN,IAAa,qBAAiBc,EAAyBnM,MAAMkI,oBAAoBsF,KAAK,OAAQ,OAE5H,wBAAoB,QAAQ,IAClC,wBAAoB,MAAOlC,GAAa,CACpC/I,EAAO,MAAQA,EAAO,KAAM,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,OAAQ,KAC3F,wBAAoB,OAAQwN,IAAa,qBAAiBY,EAAyBnM,MAAM8E,MAAQ,KAAM,MAE3G,wBAAoB,MAAO0G,GAAa,EACpC,wBAAoB,SAAU,CAC1BzN,OAAO,oBAAgB,CAAC,aAAc,CAAE,aAAc6G,EAAyB5E,MAAMxE,IAAIsQ,EAAkB9L,UAC3G0C,QAASH,EAAO,KAAOA,EAAO,GAAMK,GAAYoK,EAAsBlB,EAAkB9L,UACzF,qBAAiB4E,EAAyB5E,MAAMxE,IAAIsQ,EAAkB9L,OAAS,MAAQ,OAAQ,MAEvG,OACA,kBAAc,wBAAoB,MAAOyL,GAAa,sBAG9E,KAAuB,CACtB,CAAC,QAA4B,eAApBvP,EAAU8D,cAI/B,wBAAoB,MAAO0L,GAAa,CACpCnJ,EAAO,MAAQA,EAAO,KAAM,wBAAoB,MAAO,KAAM,MAAO,KACpE,wBAAoB,SAAU,CAC1BxE,MAAO,aACPyE,SAAU7C,EAAUK,MACpB0C,QAASf,GACV,IAAKY,EAAO,MAAQA,EAAO,IAAM,EAC5B,wBAAoB,OAAQ,KAAM,OAAQ,MACxC,EAAeoJ,QAIzC,ICvbJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCH1DoC,GAAmB,CAC9BC,aAAc,CACZC,QAAS,KACTC,OAAQ,UACRC,WAAY,UAEdC,YAAa,CACXF,OAAQ,UACRC,WAAY,SACZE,cAAe,UACfC,YAAa,UAEfC,IAAK,CACHL,OAAQ,UACRC,WAAY,UAEdK,OAAO,GAuBF,SAASC,KACd,MAAMR,EAAUS,yBAEhB,IAAKT,EACH,MAAO,CACLA,QAAS,KACTC,OAAQ,QACRC,WAAY,OAIhB,MAAMQ,EA3BD,SAAwBC,EAAmBC,GAChD,IAAKD,IAAOC,EAAI,OAAQ,EACxB,MAAMC,EAAKC,OAAOH,GACZI,EAAKD,OAAOF,GACZI,EAAOH,EAAGI,MAAM,KAAK1U,IAAI2U,QACzBC,EAAOJ,EAAGE,MAAM,KAAK1U,IAAI2U,QACzBE,EAAM/O,KAAKC,IAAI0O,EAAKpU,OAAQuU,EAAKvU,QACvC,IAAK,IAAIyU,EAAI,EAAGA,EAAID,EAAKC,IAAK,CAC5B,MAAMC,EAAON,EAAKK,IAAM,EAClBE,EAAOJ,EAAKE,IAAM,EACxB,GAAIC,EAAOC,EAAM,OAAO,EACxB,GAAID,EAAOC,EAAM,OAAQ,CAC3B,CACA,OAAO,CACT,CAasBC,CAAexB,EAAS,WAAa,EAEzD,MAAO,CACLA,UACAC,OAAQS,EAAc,KAAO,OAC7BR,WAAYQ,EAAc,KAAO,OAErC,CAyDOzU,eAAewV,KACpB,MAAM1B,EAAeS,KACfL,EAzDD,WACL,IACE,MAAMuB,EAAU9V,OAAOC,KAAK8V,YAAYC,aAClCC,EAAsBH,EAAQI,kBAAkBC,YAEtD,OAAKF,EAUE,CACL5B,OAAQ,KACRC,WAAY,KACZxT,QAASmV,EAAoBnV,QAC7B0T,cAAeyB,EAAoBnV,QAAU,KAAO,OACpD2T,YAAawB,EAAoBnV,QAAU,MAAQ,OAd5C,CACLuT,OAAQ,QACRC,WAAY,OACZxT,SAAS,EACT0T,cAAe,UACfC,YAAa,MAWnB,CAAE,MAAOjT,GACP,MAAO,CACL6S,OAAQ,QACRC,WAAY,OACZxT,SAAS,EACT0T,cAAe,UACfC,YAAa,MAEjB,CACF,CA0BsB2B,GACd1B,QAzBDrU,iBAEL,IAAIgW,EAEJ,IACE,MAAMC,EAAiB,IAAI3D,QAAQ,CAAC4D,EAAGC,KACrCH,EAAYI,WAAW,KACrBD,EAAO,IAAInV,MAAM,eANC,OActB,aAJMsR,QAAQ+D,KAAK,CAACC,sBAAsB,OAAQL,IAElDM,aAAaP,GAEN,CAAEhC,OAAQ,KAAMC,WAAY,KACrC,CAAE,MAAOtR,GAEP,OADIqT,GAAWO,aAAaP,GACrB,CAAEhC,OAAQ,QAASC,WAAY,QACxC,CACF,CAKoBuC,GAQlB,MAAO,CACL1C,eACAI,cACAG,MACAC,MATwB,OAAxBR,EAAaE,QACU,OAAvBE,EAAYF,QACkB,OAA9BE,EAAYC,eACG,OAAfE,EAAIL,OAQR,CCpIA,MAAM,GAAa,CAAEnQ,MAAO,kBACtB,GAAa,CAAEA,MAAO,uBACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAEA,MAAO,qBACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAEA,MAAO,qBACtB,GAAa,CAAEA,MAAO,kBACtB,GAAa,CAAEA,MAAO,qBACtB,GAAa,CAAEA,MAAO,qBACtB,GAAc,CAAC,YACf,GAAc,CAChBxE,IAAK,EACLwE,MAAO,mBAIX,IAA6B,qBAAiB,CAC1CqB,OAAQ,eACRC,MAAO,CAAC,OAAQ,oBAChB,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MAAMD,EAAOC,EACPkR,GAAa,IAAA/Q,MAAI,GACjBgR,GAAY,IAAAhR,KAAI,IAAKmO,KAC3B7T,eAAe2W,IACXF,EAAW3Q,OAAQ,EACnB,IACI,MAAMe,QAAe2O,KACrBkB,EAAU5Q,MAAQe,EAClBvB,EAAK,mBAAoBuB,EAC7B,CACA,MAAOlE,GACHJ,QAAQI,MAAM,UAAWA,EAC7B,CACA,QACI8T,EAAW3Q,OAAQ,CACvB,CACJ,CAUA,OARA,IAAAiC,OAAM,IAAM2O,EAAU5Q,MAAMwO,MAAOA,IAC3BA,IAAUmC,EAAW3Q,OACrBR,EAAK,WAGb,IAAA6C,WAAU,KACNwO,MAEG,CAACvO,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,CACzDA,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAExE,MAAO,cAAgB,QAAS,KACtF,wBAAoB,aACpB,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,WACpB,wBAAoB,MAAO,GAAY,CACnCwE,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAExE,MAAO,mBAAqB,EAC/E,wBAAoB,OAAQ,CAAEA,MAAO,QAAU,OAC/C,wBAAoB,OAAQ,KAAM,UAClC,KACJ,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,OAAQ,KAAM,CAC9BwE,EAAO,KAAOA,EAAO,IAAK,qBAAiB,QAAS,KACpD,wBAAoB,SAAU,CAC1BxE,OAAO,oBAAgB,WAAa6S,EAAU5Q,MAAMgO,aAAaC,QAAU,KAAO,cACnF,qBAAiB2C,EAAU5Q,MAAMgO,aAAaC,SAAW,MAAO,MAEvE,wBAAoB,OAAQ,KAAM,CAC9B1L,EAAO,KAAOA,EAAO,IAAK,qBAAiB,QAAS,KACpD,wBAAoB,SAAU,CAC1BxE,OAAO,oBAAgB,UAAY6S,EAAU5Q,MAAMgO,aAAaE,UACjE,qBAAiB0C,EAAU5Q,MAAMgO,aAAaG,YAAa,UAI1E,wBAAoB,kBACpB,wBAAoB,MAAO,GAAY,CACnC5L,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAExE,MAAO,mBAAqB,EAC/E,wBAAoB,OAAQ,CAAEA,MAAO,QAAU,OAC/C,wBAAoB,OAAQ,KAAM,iBAClC,KACJ,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,OAAQ,KAAM,CAC9BwE,EAAO,KAAOA,EAAO,IAAK,qBAAiB,QAAS,KACpD,wBAAoB,SAAU,CAC1BxE,OAAO,oBAAgB,UAAY6S,EAAU5Q,MAAMoO,YAAYF,UAChE,qBAAiB0C,EAAU5Q,MAAMoO,YAAYD,YAAa,MAEjE,wBAAoB,OAAQ,KAAM,CAC9B5L,EAAO,KAAOA,EAAO,IAAK,qBAAiB,SAAU,KACrD,wBAAoB,SAAU,CAC1BxE,OAAO,oBAAgB,UAAY6S,EAAU5Q,MAAMoO,YAAYC,iBAChE,qBAAiBuC,EAAU5Q,MAAMoO,YAAYE,aAAc,UAI1E,wBAAoB,aACpB,wBAAoB,MAAO,GAAY,CACnC/L,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAExE,MAAO,mBAAqB,EAC/E,wBAAoB,OAAQ,CAAEA,MAAO,QAAU,OAC/C,wBAAoB,OAAQ,KAAM,YAClC,KACJ,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,OAAQ,KAAM,CAC9BwE,EAAO,KAAOA,EAAO,IAAK,qBAAiB,QAAS,KACpD,wBAAoB,SAAU,CAC1BxE,OAAO,oBAAgB,UAAY6S,EAAU5Q,MAAMuO,IAAIL,UACxD,qBAAiB0C,EAAU5Q,MAAMuO,IAAIJ,YAAa,UAIjE,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,SAAU,CAC1BpQ,MAAO,iBACPyE,SAAUmO,EAAW3Q,MACrB0C,QAASmO,IACV,qBAAiBF,EAAW3Q,MAAQ,SAAW,QAAS,EAAqB,SAGxF,wBAAoB,aACpB,iBAAa,aAAa,CAAEtF,KAAM,QAAU,CACxCoW,SAAS,aAAS,IAAM,CACnBF,EAAU5Q,MAAMwO,QAAUmC,EAAW3Q,QAC/B,kBAAc,wBAAoB,MAAO,GAAa,IAAKuC,EAAO,KAAOA,EAAO,GAAK,EAChF,wBAAoB,OAAQ,CAAExE,MAAO,gBAAkB,KAAM,IAC7D,wBAAoB,OAAQ,KAAM,kBAAmB,SAE3D,wBAAoB,QAAQ,KAEtCqS,EAAG,MAInB,IC5HJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAErS,MAAO,oBACtB,GAAa,CAAEA,MAAO,qBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAEA,MAAO,mBAG5B,IACEqB,OAAQ,kBACR,KAAAE,CAAMC,GAER,MAAMwR,EAAc,CAClB,iBACA,WACA,MACA,iBACA,SACA,QACA,OACA,OACA,QACA,QACA,MACA,QACA,QACA,SAGIC,EAAa,CAAC,aAAc,UAE5BC,EAAgB,CAAC,WAAY,cAAe,WAAY,QAAS,OAEvE,MAAO,CAAC3O,EAAMC,MACJ,kBAAc,wBAAoB,MAAO,GAAY,EAC3D,wBAAoB,SACpBA,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAExE,MAAO,oBAAsB,aAAc,IACjGwE,EAAO,KAAOA,EAAO,IAAK,wBAAoB,IAAK,CAAExE,MAAO,yBAA2B,mCAAoC,IAC3HwE,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAExE,MAAO,sBAAwB,MAAO,KAC5F,wBAAoB,cACpB,wBAAoB,MAAO,GAAY,CACrCwE,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAExE,MAAO,iBAAmB,YAAa,KAC9F,wBAAoB,MAAO,GAAY,GACpC,kBAAc,wBAAoB,WAAW,MAAM,gBAAYgT,EAAc3P,IACrE,wBAAoB,OAAQ,CACjC7H,IAAK6H,EACLrD,MAAO,iBACN,qBAAiBqD,GAAS,IAC3B,OAENmB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAExE,MAAO,iBAAmB,WAAY,KAC7F,wBAAoB,MAAO,GAAY,GACpC,kBAAc,wBAAoB,WAAW,MAAM,gBAAYiT,EAAa5P,IACpE,wBAAoB,OAAQ,CACjC7H,IAAK6H,EACLrD,MAAO,iBACN,qBAAiBqD,GAAS,IAC3B,QAEN,wBAAoB,MAAO,GAAY,CACrCmB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,SAAU,KAAM,SAAU,KACxE,sBAAiB,qBAAiB0O,EAAczD,KAAK,MAAO,QAGhE,wBAAoB,cACpBjL,EAAO,KAAOA,EAAO,IAAK,uBAAmB,02CAAq4C,MAGt7C,GC7DA,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCG1D2O,GAAiB,CAC5B,CACElR,MAAO,OACP7C,MAAO,OACPgU,KAAM,eACNpM,UAT0B,+BAW5B,CACE/E,MAAO,QACP7C,MAAO,QACPgU,KAAM,gBACNpM,UAd2B,4CCHxB,MAAMqM,GAAY,CACvB,CAAEC,MAAO,EAAGlU,MAAO,oBACnB,CAAEkU,MAAO,EAAGlU,MAAO,gBACnB,CAAEkU,MAAO,EAAGlU,MAAO,gBACnB,CAAEkU,MAAO,EAAGlU,MAAO,cACnB,CAAEkU,MAAO,EAAGlU,MAAO,oBCNrB,MAAM,GAAa,CAAEY,MAAO,cACtB,GAAa,CAAEA,MAAO,2BACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAC,WACd,GAAa,CAAEA,MAAO,6BACtB,GAAa,CAAEA,MAAO,iBACtB,GAAa,CAAEA,MAAO,mBACtB,GAAa,CAAC,WACd,GAAa,CAAEA,MAAO,eACtB,GAAc,CAAEA,MAAO,eACvB,GAAc,CAAC,YAIrB,IAA6B,qBAAiB,CAC1CqB,OAAQ,YACRC,MAAO,CAAC,QACR,KAAAC,CAAMC,GAAWC,KAAMC,IACnB,MACM6R,GAAgB,IAAA1R,KAAI,MACpB2R,GAAiB,IAAA3R,KAAI,IACrBD,GAAY,IAAAC,MAAI,GAEhB4R,EAAgBN,GAEhBO,GAAa,IAAA1R,UAAS,IACO,OAAxBuR,EAActR,OAA2C,KAAzBuR,EAAevR,OAW1D9F,eAAeyH,IACX,GAAK8P,EAAWzR,MAAhB,CAEAL,EAAUK,OAAQ,EAClB,UFfL9F,eAAmCwX,GACxC,MAAMrX,EAAWV,IACjB,IAAKU,EAEH,YADAoC,QAAQI,MAAM,UAKhB,MAAMgF,EAAiBqP,GAAe1W,IAAImX,IAAO,CAC/CjX,KAAMiX,EAAI5M,UACVpK,QAASgX,EAAI3R,QAAU0R,WAGnB1W,EAAgB6G,EAAgBxH,EACxC,CEGsBuX,CAAoBL,EAAevR,aD/BlD9F,eAA2B2X,GAChC,GAA2B,oBAAhBjC,cAAgCA,YAAYkC,MAAoC,IAA5BlC,YAAYkC,KAAKjX,OAE9E,OADA4B,QAAQsV,KAAK,uEACN,EAGT,MAAMC,EAAaH,EAEnB,YAC0C,IAAjCjC,YAAYkC,KAAK,GAAGG,UAC3BrC,YAAYkC,KAAK,GAAGG,WAAaD,EAE7BpC,YAAYkC,KAAK,GAAGI,QAAUtC,YAAYkC,KAAK,GAAGI,OAAOrX,OAASmX,GACpEpC,YAAYkC,KAAK,GAAGG,SAAWD,EAC/BpC,YAAYkC,KAAK,GAAGK,IAAMvC,YAAYkC,KAAK,GAAGI,OAAOF,SAC/CpC,YAAYwC,iBACZxC,YAAYyC,oBAClB5V,QAAQC,IAAI,gDAAgDsV,QACrD,IAEPvV,QAAQI,MAAM,eAAemV,mDACtB,IAGTvV,QAAQC,IAAI,YAAYsV,wDACjB,EAEX,CCMsBM,CAAYhB,EAActR,MACpC,CACA,MAAOnD,GACHJ,QAAQI,MAAM,UAAWA,EAC7B,CACA,QACI8C,EAAUK,OAAQ,CACtB,CAbU,CAcd,CACA,MAAO,CAACsC,EAAMC,MACF,kBAAc,wBAAoB,MAAO,GAAY,CACzDA,EAAO,KAAOA,EAAO,IAAK,wBAAoB,KAAM,CAAExE,MAAO,cAAgB,aAAc,KAC3F,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,KAAM,GAAY,GACjC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOqT,IAAamB,KAC5E,kBAAc,wBAAoB,KAAM,CAC5ChZ,IAAKgZ,EAASlB,OACf,EACC,wBAAoB,SAAU,CAC1BtT,OAAO,oBAAgB,CAAC,kBAAmB,CAAE8E,SAAUyO,EAActR,QAAUuS,EAASlB,SACxF3O,QAAUE,IAAW,OArCnByO,EAqCyCkB,EAASlB,WApC5EC,EAActR,MAAQqR,GAD1B,IAA8BA,KAsCH,qBAAiBkB,EAASpV,OAAQ,GAA6B,QAEtE,WAGZ,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,GAAY,EACnC,wBAAoB,MAAO,GAAY,GAClC,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAOqU,GAAiBgB,KAChF,kBAAc,wBAAoB,MAAO,CAC7CjZ,IAAKiZ,EAAOxS,MACZjC,MAAO,wBACR,EACC,wBAAoB,SAAU,CAC1BA,OAAO,oBAAgB,CAAC,iBAAkB,CAAE8E,SAAU0O,EAAevR,QAAUwS,EAAOxS,SACtF0C,QAAUE,IAAW,OAlD/B5C,EAkD6CwS,EAAOxS,WAjDtEuR,EAAevR,MAAQA,GAD3B,IAAsBA,KAmDS,qBAAiBwS,EAAOrV,OAAQ,GAA6B,KAChE,wBAAoB,OAAQ,IAAY,qBAAiBqV,EAAOrB,MAAO,OAE3E,aAIhB,wBAAoB,MAAO,GAAa,EACpC,wBAAoB,SAAU,CAC1BpT,MAAO,aACP2E,QAASH,EAAO,KAAOA,EAAO,GAAMK,GAAYN,EAAKQ,MAAM,UAC5D,IAAKP,EAAO,KAAOA,EAAO,GAAK,EAC1B,wBAAoB,OAAQ,KAAM,OAAQ,QAElD,wBAAoB,SAAU,CAC1BxE,MAAO,aACPyE,UAAWiP,EAAWzR,OAASL,EAAUK,MACzC0C,QAASf,GACV,EACC,wBAAoB,OAAQ,MAAM,qBAAiBhC,EAAUK,MAAQ,SAAW,QAAS,IAC1F,EAAe,QAIlC,ICpGJ,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,qBCJjE,GAAa,CAAEjC,MAAO,mBACtB,GAAa,CAAEA,MAAO,gBAU5B,IACEqB,OAAQ,MACR,KAAAE,CAAMC,GAER,MAAMkT,GAAc,IAAA7S,KAAI,GAElB8S,EAAQ,CAACC,GAAcC,GAAmBC,EAAUC,IAGpDC,GAAiB,IAAAnT,KAAI,MAK3B,SAASoT,IACHP,EAAYzS,MAAQ0S,EAAM7X,OAAS,GACrC4X,EAAYzS,OAEhB,CAEA,SAASiT,IACHR,EAAYzS,MAAQ,GACtByS,EAAYzS,OAEhB,CAEA,SAASkT,EAAuBnS,GAC9BgS,EAAe/S,MAAQe,CACzB,CAEA,OAlBA,IAAAoS,SAAQ,kBAAkB,IAAAC,UAASL,IAkB5B,CAACzQ,EAAMC,MACJ,kBAAc,wBAAoB,MAAO,GAAY,EAC3D,iBAAa8Q,KACb,wBAAoB,MAAO,GAAY,EACrC,iBAAa,aAAa,CACxB3Y,KAAM,OACN4Y,KAAM,UACL,CACDxC,SAAS,aAAS,IAAM,GACrB,kBAAc,kBAAa,6BAAyB4B,EAAMD,EAAYzS,QAAS,CAC9EuT,OAAQP,EACRQ,OAAQP,EACRQ,mBAAoBP,GACnB,KAAM,OAEX9C,EAAG,QAKX,GCvDA,IAFiC,OAAgB,GAAQ,CAAC,CAAC,YAAY,sBCFvE,IAAAsD,WAAUC,IAAKC,MAAM","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_950b954033f7ef31b6c40554a1f5a482/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/home/services/worldbookload&update.ts","src://tavern_helper_template/src/home/services/CorePage.ts","webpack://tavern_helper_template/./src/home/components/CorePage.vue?06ef","webpack://tavern_helper_template/src/home/components/CorePage.vue?bbff","src://tavern_helper_template/src/home/services/DLCManagement.ts","webpack://tavern_helper_template/./src/home/components/DLCManagementPage.vue?3058","webpack://tavern_helper_template/src/home/components/DLCManagementPage.vue?fc11","src://tavern_helper_template/src/home/services/envCheck.ts","webpack://tavern_helper_template/./src/home/components/EnvCheckPage.vue?28d2","webpack://tavern_helper_template/src/home/components/EnvCheckPage.vue?bcf0","webpack://tavern_helper_template/./src/home/components/ShowcaseSection.vue?8e3c","webpack://tavern_helper_template/src/home/components/ShowcaseSection.vue?f94d","src://tavern_helper_template/src/home/services/outputMethod.ts","src://tavern_helper_template/src/home/services/StartPage.ts","webpack://tavern_helper_template/./src/home/components/StartPage.vue?a88c","webpack://tavern_helper_template/src/home/components/StartPage.vue?35b8","webpack://tavern_helper_template/./src/home/App.vue?ded1","webpack://tavern_helper_template/src/home/App.vue?60ac","src://tavern_helper_template/src/home/index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","//获取世界书名字\nexport function getWorldBookName() {\n  const bookInfo = window.top?.TavernHelper.getCharWorldbookNames('current');\n  const BookName = bookInfo ? bookInfo.primary : null;\n  return BookName;\n}\n//获取条目\nexport async function getWorldbookEntries(bookName: string | null) {\n  if (!bookName) {\n    return;\n  }\n  const worldbook = await window.top?.TavernHelper.getWorldbook(bookName);\n  if (!worldbook) {\n    return;\n  }\n  return worldbook.map((entry: { name: string; enabled: boolean }) => ({\n    name: entry.name,\n    enabled: entry.enabled,\n  }));\n}\n//使用正则筛选条目\nexport async function getFilteredEntries(pattern: RegExp, bookName: string | null) {\n  const worldbook = await getWorldbookEntries(bookName);\n  if (!worldbook || worldbook.length === 0) {\n    return [];\n  }\n  return worldbook\n    .filter((entry: { name: string }) => pattern.test(entry.name))\n    .map((entry: { name: any; enabled: any }) => ({\n      name: entry.name,\n      enabled: entry.enabled,\n    }));\n}\n/**\n * 更新世界书条目的启用状态\n *\n * @param entries 修改后的条目列表，包含 name 和 enabled 属性\n * @throws 如果没有绑定世界书或世界书不存在，将会抛出错误\n *\n * @example\n * // 更新世界书\n * await updateWorldBook(entries);\n */\nexport async function updateWorldBook(\n  entries: Array<{ name: string; enabled: boolean }>,\n  bookName: string,\n): Promise<void> {\n  if (!bookName) {\n    return;\n  }\n  if (!bookName) {\n    throw new Error('No worldbook bound to current character');\n  }\n\n  const enabledMap = new Map(entries.map(e => [e.name, e.enabled]));\n\n  await window.top?.TavernHelper.updateWorldbookWith(bookName, worldbook => {\n    return worldbook.map(entry => {\n      const newEnabled = enabledMap.get(entry.name);\n      if (newEnabled !== undefined) {\n        return { ...entry, enabled: newEnabled };\n      }\n      return entry;\n    });\n  });\n}\n","import JSON5 from 'json5';\n\nimport { getFilteredEntries, getWorldBookName, updateWorldBook } from './worldbookload&update';\n\n// 未分类的默认tab名称\nexport const UNCATEGORIZED_TAB = '这是什么杯';\n\n// 固定的特别推荐tab名称\nexport const SPECIAL_RECOMMEND_TAB = '特别推荐';\n\n// 特别推荐核心配置类型\nexport interface SpecialRecommendConfig {\n  note: string;\n}\n\n// 核心选项类型\nexport interface CoreOption {\n  value: string;\n  label: string;\n  author: string; // 作者信息，从括号内提取\n  enabled: boolean;\n  tabs: string[]; // 改为数组，支持一个核心属于多个分组\n  note: string; // 从排行榜获取的note\n  specialNote: string; // 特别推荐的硬编码note\n}\n\n// 核心条目匹配模式 - 匹配以\"命定系统-\"开头的条目\nconst CORE_PATTERN = /^命定系统-/;\n\n// 提取作者信息的正则 - 匹配末尾括号内容\nconst AUTHOR_PATTERN = /\\(([^)]*)\\)$/;\n\n/**\n * 核心状态初始值\n */\nexport const initialCoreState = {\n  coreOptions: [] as CoreOption[],\n  localCoreSelections: new Map<string, boolean>(),\n  tabs: [] as string[],\n  activeTab: '',\n};\n\n/**\n * 核心分类数据类型\n */\ntype CoreClassificationData = Record<string, Record<string, { note?: string }>>;\n\n/**\n * 缓存的排行榜数据\n */\nlet cachedRankings: CoreClassificationData | null = null;\n\n/**\n * 数据基础路径 - CDN 部署环境\n * 使用版本号替代 @latest 以确保缓存正确更新\n */\nconst DATA_BASE_PATH = `https://testingcf.jsdelivr.net/gh/The-poem-of-destiny/FrontEnd-for-destined-journey@${__APP_VERSION__}/public/assets/data`;\n\n/**\n * 从远程加载核心分类数据\n * 使用 JSON5 解析，支持注释和更灵活的格式\n */\nasync function loadCoreClassification(): Promise<CoreClassificationData> {\n  if (cachedRankings !== null) {\n    return cachedRankings;\n  }\n\n  try {\n    const response = await fetch(`${DATA_BASE_PATH}/coreClassification.json`);\n    if (!response.ok) {\n      console.log('未找到核心分类数据文件 (coreClassification.json)');\n      return {};\n    }\n\n    const text = await response.text();\n    const data = JSON5.parse(text) as CoreClassificationData;\n    console.log('成功加载核心分类数据');\n    cachedRankings = data;\n    return data;\n  } catch (error) {\n    console.log('未找到核心分类数据或格式错误:', error);\n    return {};\n  }\n}\n\n/**\n * 获取排行榜数据（同步版本，使用缓存）\n */\nfunction getRankings(): CoreClassificationData | undefined {\n  return cachedRankings ?? undefined;\n}\n\n/**\n * 从排行榜数据中动态获取所有tab名称\n */\nexport async function getTabsFromRankings(): Promise<string[]> {\n  const Rankings = await loadCoreClassification();\n  if (!Rankings || typeof Rankings !== 'object') {\n    return [SPECIAL_RECOMMEND_TAB, UNCATEGORIZED_TAB];\n  }\n\n  // 获取排行榜中的所有键作为tab\n  const dynamicTabs = Object.keys(Rankings).filter(\n    key => Rankings[key] && typeof Rankings[key] === 'object',\n  );\n\n  // 如果没有动态tab，返回默认的tabs\n  if (dynamicTabs.length === 0) {\n    return [SPECIAL_RECOMMEND_TAB, UNCATEGORIZED_TAB];\n  }\n\n  // \"特别推荐\"固定在第一位，\"这是什么杯\"作为未分类的tab放在最后\n  return [SPECIAL_RECOMMEND_TAB, ...dynamicTabs, UNCATEGORIZED_TAB];\n}\n\n/**\n * 根据核心label查找其所属的所有tab分类和note\n * 一个核心可以同时属于多个分组\n * @param label 核心标签（不含前缀和作者）\n * @param coreValue 核心完整值（用于检查特别推荐）\n * @param allTabs 所有tab列表\n * @param specialRecommendCores 特别推荐核心列表（从外部传入）\n */\nexport function getCoreRanking(\n  label: string,\n  coreValue: string,\n  allTabs: string[],\n  specialRecommendCores: Record<string, SpecialRecommendConfig> = {},\n): { tabs: string[]; note: string; specialNote: string } {\n  const Rankings = getRankings();\n  const matchedTabs: string[] = [];\n  let note = '';\n  let specialNote = '';\n\n  // 首先检查是否在特别推荐列表中\n  if (coreValue in specialRecommendCores) {\n    matchedTabs.push(SPECIAL_RECOMMEND_TAB);\n    specialNote = specialRecommendCores[coreValue]?.note || '';\n  }\n\n  if (Rankings && typeof Rankings === 'object') {\n    // 遍历所有tab查找核心（排除\"这是什么杯\"和\"特别推荐\"）\n    for (const tabName of allTabs) {\n      if (tabName === UNCATEGORIZED_TAB || tabName === SPECIAL_RECOMMEND_TAB) continue;\n\n      const tabData = Rankings[tabName];\n      if (tabData && typeof tabData === 'object') {\n        // 检查核心名称是否在此tab中\n        if (label in tabData) {\n          matchedTabs.push(tabName);\n          // 使用第一个匹配的note\n          if (!note && tabData[label]?.note) {\n            note = tabData[label].note;\n          }\n        }\n      }\n    }\n  }\n\n  // 未找到任何分组则归入\"这是什么杯\"\n  if (matchedTabs.length === 0) {\n    return { tabs: [UNCATEGORIZED_TAB], note: '', specialNote: '' };\n  }\n\n  return { tabs: matchedTabs, note, specialNote };\n}\n\n/**\n * 获取指定tab下的核心列表\n * 核心可以同时属于多个tab\n */\nexport function getCoresForTab(coreOptions: CoreOption[], tab: string): CoreOption[] {\n  return coreOptions.filter(core => core.tabs.includes(tab));\n}\n\n/**\n * 获取当前选中的核心\n */\nexport function getSelectedCore(localCoreSelections: Map<string, boolean>): string | null {\n  for (const [name, enabled] of localCoreSelections) {\n    if (enabled) return name;\n  }\n  return null;\n}\n\n/**\n * 加载核心列表\n * @param specialRecommendCores 特别推荐核心列表（从外部传入）\n */\nexport async function loadCoreOptions(\n  specialRecommendCores: Record<string, SpecialRecommendConfig> = {},\n): Promise<{\n  coreOptions: CoreOption[];\n  localCoreSelections: Map<string, boolean>;\n  tabs: string[];\n  activeTab: string;\n  bookName: string | null;\n}> {\n  // 动态获取tabs（需要先加载核心分类数据）\n  const tabs = await getTabsFromRankings();\n  const bookName = getWorldBookName();\n  const entries = await getFilteredEntries(CORE_PATTERN, bookName);\n  const coreOptions = entries.map((entry: { name: string; enabled: boolean }) => {\n    // 去掉\"命定系统-\"前缀\n    const nameWithoutPrefix = entry.name.replace(CORE_PATTERN, '');\n    // 提取作者信息（括号内容）\n    const authorMatch = nameWithoutPrefix.match(AUTHOR_PATTERN);\n    const author = authorMatch ? authorMatch[1] : '';\n    // 去掉末尾括号内容作为显示标签\n    const label = nameWithoutPrefix.replace(AUTHOR_PATTERN, '');\n    const ranking = getCoreRanking(label, entry.name, tabs, specialRecommendCores);\n    return {\n      value: entry.name,\n      label,\n      author,\n      enabled: entry.enabled,\n      tabs: ranking.tabs, // 使用tabs数组\n      note: ranking.note,\n      specialNote: ranking.specialNote,\n    };\n  });\n\n  // 初始化本地选择列表（从世界书的原始状态复制）\n  const localCoreSelections = new Map(coreOptions.map(core => [core.value, core.enabled]));\n\n  // 固定显示第一个tab（特别推荐），取消自动切换到已启用核心的tab\n  const activeTab = tabs[0] || SPECIAL_RECOMMEND_TAB;\n\n  return { coreOptions, localCoreSelections, tabs, activeTab, bookName };\n}\n\n/**\n * 选择核心（仅更新本地状态，返回新的选择Map）\n */\nexport function selectCore(\n  localCoreSelections: Map<string, boolean>,\n  coreValue: string,\n): Map<string, boolean> {\n  const currentSelected = getSelectedCore(localCoreSelections);\n  if (currentSelected === coreValue) {\n    return localCoreSelections; // 已选中，无需操作\n  }\n\n  // 创建新的Map，禁用其他核心，启用选中的核心\n  const newSelections = new Map<string, boolean>();\n  for (const [name] of localCoreSelections) {\n    newSelections.set(name, name === coreValue);\n  }\n  return newSelections;\n}\n\n/**\n * 检查本地选择是否与原始状态有变化\n */\nexport function hasChanges(\n  coreOptions: CoreOption[],\n  localCoreSelections: Map<string, boolean>,\n): boolean {\n  for (const core of coreOptions) {\n    const localEnabled = localCoreSelections.get(core.value) ?? false;\n    if (localEnabled !== core.enabled) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * 保存核心选择到世界书\n * @param coreOptions 核心选项列表\n * @param localCoreSelections 本地选择状态\n * @param bookName 世界书名称\n * @returns 更新后的核心选项列表\n */\nexport async function saveChanges(\n  coreOptions: CoreOption[],\n  localCoreSelections: Map<string, boolean>,\n  bookName: string,\n): Promise<CoreOption[]> {\n  if (!hasChanges(coreOptions, localCoreSelections)) {\n    return coreOptions;\n  }\n\n  // 构建更新列表\n  const updatedEntries = Array.from(localCoreSelections).map(([name, enabled]) => ({\n    name,\n    enabled,\n  }));\n\n  await updateWorldBook(updatedEntries, bookName);\n\n  // 返回更新后的核心选项列表\n  return coreOptions.map(core => ({\n    ...core,\n    enabled: localCoreSelections.get(core.value) ?? false,\n  }));\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = { class: \"core-page\" };\nconst _hoisted_2 = { class: \"control-panel-container\" };\nconst _hoisted_3 = { class: \"tab-navigation\" };\nconst _hoisted_4 = [\"disabled\"];\nconst _hoisted_5 = { class: \"tab-buttons-container\" };\nconst _hoisted_6 = [\"onClick\"];\nconst _hoisted_7 = { class: \"tab-label\" };\nconst _hoisted_8 = { class: \"tab-count\" };\nconst _hoisted_9 = [\"disabled\"];\nconst _hoisted_10 = [\"disabled\"];\nconst _hoisted_11 = { class: \"tab-content\" };\nconst _hoisted_12 = { class: \"control-group\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"loading-text\"\n};\nconst _hoisted_14 = {\n    key: 1,\n    class: \"empty-text\"\n};\nconst _hoisted_15 = {\n    key: 2,\n    class: \"control-buttons\"\n};\nconst _hoisted_16 = [\"onClick\"];\nconst _hoisted_17 = {\n    key: 0,\n    class: \"core-author\"\n};\nconst _hoisted_18 = {\n    key: 1,\n    class: \"core-note\"\n};\nconst _hoisted_19 = {\n    key: 2,\n    class: \"core-note\"\n};\nconst _hoisted_20 = { class: \"step-footer\" };\nconst _hoisted_21 = [\"disabled\"];\nimport { computed, onMounted, ref, watch } from 'vue';\nimport { getCoresForTab as getCoresForTabService, getSelectedCore, initialCoreState, loadCoreOptions as loadCoreOptionsService, saveChanges as saveChangesService, selectCore, SPECIAL_RECOMMEND_TAB, } from '../services/CorePage';\n// 硬编码的特别推荐核心列表\n// 只有在核心列表中存在的核心才会显示\n// key为核心完整值，value为note信息\nconst maxVisibleTabs = 4;\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'CorePage',\n    emits: [\"prev\", \"next\"],\n    setup(__props, { emit: __emit }) {\n        const SPECIAL_RECOMMEND_CORES = {\n            '命定系统-null核心(H一串)': { note: '纯私货' },\n            '命定系统-读者核心(Angtuck)': { note: '故事的读者，不明存在-九十九夜梦' },\n            '命定系统-奶龙核心(K1nn)': { note: '奶龙好玩' },\n        };\n        const emit = __emit;\n        const isLoading = ref(false);\n        const tabs = ref([...initialCoreState.tabs]);\n        const activeTab = ref(initialCoreState.activeTab);\n        const coreOptions = ref([...initialCoreState.coreOptions]);\n        const localCoreSelections = ref(new Map(initialCoreState.localCoreSelections));\n        const bookName = ref(null);\n        // Tab 分页相关\n        const tabStartIndex = ref(0);\n        const selectedCore = computed(() => getSelectedCore(localCoreSelections.value));\n        // 当前是否在特别推荐tab\n        const isSpecialRecommendTab = computed(() => activeTab.value === SPECIAL_RECOMMEND_TAB);\n        // 是否显示箭头\n        const showArrows = computed(() => tabs.value.length > maxVisibleTabs);\n        // 当前可见的 tabs\n        const visibleTabs = computed(() => {\n            if (!showArrows.value) {\n                return tabs.value;\n            }\n            return tabs.value.slice(tabStartIndex.value, tabStartIndex.value + maxVisibleTabs);\n        });\n        // 切换到上一批 tabs\n        function handlePrevTabs() {\n            if (tabStartIndex.value > 0) {\n                tabStartIndex.value = Math.max(0, tabStartIndex.value - maxVisibleTabs);\n            }\n        }\n        // 切换到下一批 tabs\n        function handleNextTabs() {\n            if (tabStartIndex.value + maxVisibleTabs < tabs.value.length) {\n                tabStartIndex.value = Math.min(tabs.value.length - maxVisibleTabs, tabStartIndex.value + maxVisibleTabs);\n            }\n        }\n        // 当 activeTab 改变时，确保它在可见范围内\n        watch(activeTab, newTab => {\n            const tabIndex = tabs.value.indexOf(newTab);\n            if (tabIndex !== -1 && showArrows.value) {\n                if (tabIndex < tabStartIndex.value) {\n                    tabStartIndex.value = tabIndex;\n                }\n                else if (tabIndex >= tabStartIndex.value + maxVisibleTabs) {\n                    tabStartIndex.value = tabIndex - maxVisibleTabs + 1;\n                }\n            }\n        });\n        function getCoresForTab(tab) {\n            return getCoresForTabService(coreOptions.value, tab);\n        }\n        async function loadCoreOptions() {\n            isLoading.value = true;\n            try {\n                const result = await loadCoreOptionsService(SPECIAL_RECOMMEND_CORES);\n                tabs.value = result.tabs;\n                coreOptions.value = result.coreOptions;\n                localCoreSelections.value = result.localCoreSelections;\n                activeTab.value = result.activeTab;\n                bookName.value = result.bookName;\n            }\n            catch (error) {\n                console.error('加载核心列表失败:', error);\n                tabs.value = [];\n                coreOptions.value = [];\n                localCoreSelections.value = new Map();\n                bookName.value = null;\n            }\n            finally {\n                isLoading.value = false;\n            }\n        }\n        async function handleRefresh() {\n            await loadCoreOptions();\n        }\n        function handleSelectCore(coreValue) {\n            localCoreSelections.value = selectCore(localCoreSelections.value, coreValue);\n        }\n        /**\n         * 点击下一步：根据本地列表更新世界书后跳转\n         */\n        async function handleNext() {\n            isLoading.value = true;\n            try {\n                if (bookName.value) {\n                    coreOptions.value = await saveChangesService(coreOptions.value, localCoreSelections.value, bookName.value);\n                }\n            }\n            catch (error) {\n                console.error('保存核心选择失败:', error);\n            }\n            finally {\n                isLoading.value = false;\n            }\n            emit('next');\n        }\n        // 组件挂载时加载核心列表\n        onMounted(() => {\n            loadCoreOptions();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _cache[6] || (_cache[6] = _createElementVNode(\"h2\", { class: \"main-title\" }, \"核心选择\", -1 /* CACHED */)),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createCommentVNode(\" Tab 导航 \"),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        (showArrows.value)\n                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                key: 0,\n                                class: \"arrow-button\",\n                                disabled: tabStartIndex.value === 0,\n                                title: \"上一页\",\n                                onClick: handlePrevTabs\n                            }, [...(_cache[1] || (_cache[1] = [\n                                    _createElementVNode(\"span\", null, \"‹\", -1 /* CACHED */)\n                                ]))], 8 /* PROPS */, _hoisted_4))\n                            : _createCommentVNode(\"v-if\", true),\n                        _createElementVNode(\"div\", _hoisted_5, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(visibleTabs.value, (tab) => {\n                                return (_openBlock(), _createElementBlock(\"button\", {\n                                    key: tab,\n                                    class: _normalizeClass([\"tab-button\", { active: activeTab.value === tab }]),\n                                    onClick: ($event) => (activeTab.value = tab)\n                                }, [\n                                    _createElementVNode(\"span\", _hoisted_7, _toDisplayString(tab), 1 /* TEXT */),\n                                    _createElementVNode(\"span\", _hoisted_8, \"(\" + _toDisplayString(getCoresForTab(tab).length) + \")\", 1 /* TEXT */)\n                                ], 10 /* CLASS, PROPS */, _hoisted_6));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ]),\n                        (showArrows.value)\n                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                key: 1,\n                                class: \"arrow-button\",\n                                disabled: tabStartIndex.value + maxVisibleTabs >= tabs.value.length,\n                                title: \"下一页\",\n                                onClick: handleNextTabs\n                            }, [...(_cache[2] || (_cache[2] = [\n                                    _createElementVNode(\"span\", null, \"›\", -1 /* CACHED */)\n                                ]))], 8 /* PROPS */, _hoisted_9))\n                            : _createCommentVNode(\"v-if\", true),\n                        _createElementVNode(\"button\", {\n                            class: \"refresh-button\",\n                            disabled: isLoading.value,\n                            title: \"刷新核心列表\",\n                            onClick: handleRefresh\n                        }, [\n                            _createElementVNode(\"span\", {\n                                class: _normalizeClass({ 'is-spinning': isLoading.value })\n                            }, \"⟳\", 2 /* CLASS */)\n                        ], 8 /* PROPS */, _hoisted_10)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_11, [\n                        _createElementVNode(\"div\", _hoisted_12, [\n                            _cache[3] || (_cache[3] = _createElementVNode(\"div\", { class: \"control-group-header\" }, [\n                                _createElementVNode(\"h3\", { class: \"control-group-title\" }, \"命定系统核心:\")\n                            ], -1 /* CACHED */)),\n                            (isLoading.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, \"正在加载核心列表...\"))\n                                : (coreOptions.value.length === 0)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, \"未找到可用的核心\"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_15, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(getCoresForTab(activeTab.value), (core) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: core.value,\n                                                class: \"control-item-wrapper\"\n                                            }, [\n                                                _createElementVNode(\"button\", {\n                                                    class: _normalizeClass([\"control-button\", { selected: selectedCore.value === core.value }]),\n                                                    onClick: ($event) => (handleSelectCore(core.value))\n                                                }, _toDisplayString(core.label), 11 /* TEXT, CLASS, PROPS */, _hoisted_16),\n                                                (core.author)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, _toDisplayString(core.author), 1 /* TEXT */))\n                                                    : _createCommentVNode(\"v-if\", true),\n                                                (isSpecialRecommendTab.value && core.specialNote)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_18, _toDisplayString(core.specialNote), 1 /* TEXT */))\n                                                    : (!isSpecialRecommendTab.value && core.note)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, _toDisplayString(core.note), 1 /* TEXT */))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                        ])\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_20, [\n                    _createElementVNode(\"button\", {\n                        class: \"nav-button\",\n                        onClick: _cache[0] || (_cache[0] = ($event) => (_ctx.$emit('prev')))\n                    }, [...(_cache[4] || (_cache[4] = [\n                            _createElementVNode(\"span\", null, \"上一步\", -1 /* CACHED */)\n                        ]))]),\n                    _createElementVNode(\"button\", {\n                        class: \"nav-button\",\n                        disabled: isLoading.value,\n                        onClick: handleNext\n                    }, [...(_cache[5] || (_cache[5] = [\n                            _createElementVNode(\"span\", null, \"下一步\", -1 /* CACHED */)\n                        ]))], 8 /* PROPS */, _hoisted_21)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./CorePage.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./CorePage.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./CorePage.vue?vue&type=style&index=0&id=c4748d48&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_950b954033f7ef31b6c40554a1f5a482/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-c4748d48\"]])\n\nexport default __exports__","import { getFilteredEntries, getWorldBookName, updateWorldBook } from './worldbookload&update';\n\n// ========================\n// 排序相关函数\n// ========================\n\n/**\n * 按拼音首字母排序比较函数\n * 中文按照拼音首字母排序，英文按照 a-z 排序\n * @param a 第一个字符串\n * @param b 第二个字符串\n * @returns 比较结果\n */\nfunction pinyinCompare(a: string, b: string): number {\n  return a.localeCompare(b, 'zh-CN', { sensitivity: 'base' });\n}\n\n/**\n * 对角色选项进行排序（按 label 的拼音首字母排序）\n * @param options 角色选项数组\n * @returns 排序后的角色选项数组\n */\nexport function sortCharacterOptions(options: CharacterOption[]): CharacterOption[] {\n  return [...options].sort((a, b) => pinyinCompare(a.label, b.label));\n}\n\n/**\n * 对事件选项进行排序（按 label 的拼音首字母排序）\n * @param options 事件选项数组\n * @returns 排序后的事件选项数组\n */\nexport function sortEventOptions(options: EventOption[]): EventOption[] {\n  return [...options].sort((a, b) => pinyinCompare(a.label, b.label));\n}\n\n/**\n * 对扩展选项进行排序（按 label 的拼音首字母排序）\n * @param options 扩展选项数组\n * @returns 排序后的扩展选项数组\n */\nexport function sortExtensionOptions(options: ExtensionOption[]): ExtensionOption[] {\n  return [...options].sort((a, b) => pinyinCompare(a.label, b.label));\n}\n\n// ========================\n// 角色相关类型和常量\n// ========================\n\n// 角色选项类型\nexport interface CharacterOption {\n  value: string; // 完整条目名称，如 \"[角色]name(A-原创角色)\"\n  label: string; // 显示名称，如 \"name\"\n  author: string; // 作者，如 \"A\"\n  info: string; // 其他信息，如 \"原创角色\"\n  enabled: boolean;\n}\n\n// 角色条目匹配模式 - 匹配以\"[角色]\"开头的条目\nconst CHARACTER_PATTERN = /^\\[角色\\]/;\n\n// 解析角色名和作者的正则 - 匹配 \"角色名(作者)\" 格式\nconst CHARACTER_NAME_PATTERN = /^(.+?)(?:\\(([^)]+)\\))?$/;\n\n/**\n * 角色状态初始值\n */\nexport const initialCharacterState = {\n  characterOptions: [] as CharacterOption[],\n  localCharacterSelections: new Map<string, boolean>(),\n};\n\n// ========================\n// 事件相关类型和常量\n// ========================\n\n// 事件条目类型（单个世界书条目）\nexport interface EventEntry {\n  name: string; // 完整条目名称，如 \"[事件][双子]双子星的咏叹调-本体\"\n  enabled: boolean;\n}\n\n// 事件选项类型（分组后的事件）\nexport interface EventOption {\n  eventKey: string; // 事件唯一标识，如 \"[事件][双子]\"\n  label: string; // 显示名称，如 \"双子\"\n  author: string; // 作者（从条目中提取）\n  info: string; // 其他信息（从条目中提取）\n  entries: EventEntry[]; // 该事件下的所有条目\n  enabled: boolean; // 事件是否启用（所有条目启用时为true）\n}\n\n// 事件条目匹配模式 - 匹配以\"[事件]\"开头的条目\nconst EVENT_PATTERN = /^\\[事件\\]/;\n\n// 提取事件名的正则 - 匹配 \"[事件][事件名]\" 格式\nconst EVENT_KEY_PATTERN = /^(\\[事件\\]\\[[^\\]]+\\])/;\n\n// 提取事件显示名称的正则 - 匹配 \"[事件名]\" 中的事件名\nconst EVENT_LABEL_PATTERN = /^\\[事件\\]\\[([^\\]]+)\\]/;\n\n// 提取作者的正则 - 匹配最后一个 \"(作者)\" 格式（事件和扩展通用）\nconst AUTHOR_PATTERN = /\\(([^)]+)\\)(?=[^()]*$)/;\n\n/**\n * 事件状态初始值\n */\nexport const initialEventState = {\n  eventOptions: [] as EventOption[],\n  localEventSelections: new Map<string, boolean>(),\n};\n\n// ========================\n// 扩展相关类型和常量\n// ========================\n\n// 扩展条目类型（单个世界书条目）\nexport interface ExtensionEntry {\n  name: string; // 完整条目名称，如 \"[扩展][无尽深渊地城扩展][!原版无尽深渊地城]无尽深渊地城-控制(Hilo)\"\n  enabled: boolean;\n}\n\n// 扩展选项类型（分组后的扩展）\nexport interface ExtensionOption {\n  extensionKey: string; // 扩展唯一标识，如 \"[扩展][无尽深渊地城扩展]\"\n  label: string; // 显示名称，如 \"无尽深渊地城扩展\"\n  author: string; // 作者，如 \"Hilo\"\n  info: string; // 其他信息\n  // 互斥目标数组 - [!xxx] 格式，开启时关闭包含 [xxx] 的扩展\n  exclusionTargets: string[];\n  // 替换目标数组 - [>xxx] 格式，开启时关闭包含 [xxx] 的条目，关闭时恢复\n  replacementTargets: string[];\n  // 前置需求数组 - [<xxx] 格式，需要 [xxx] 扩展处于开启状态\n  prerequisiteTargets: string[];\n  entries: ExtensionEntry[]; // 该扩展下的所有条目\n  enabled: boolean; // 扩展是否启用（所有条目启用时为true）\n}\n\n// 扩展条目匹配模式 - 匹配以\"[扩展]\"开头的条目\nconst EXTENSION_PATTERN = /^\\[扩展\\]/;\n\n// 提取扩展Key的正则 - 只匹配 \"[扩展][扩展名]\" 格式（不包含关系标记，以便同一扩展只需标记一次）\nconst EXTENSION_KEY_PATTERN = /^(\\[扩展\\]\\[[^\\]]+\\])/;\n\n// 提取扩展显示名称的正则 - 匹配 \"[扩展][扩展名]\" 中的扩展名\nconst EXTENSION_LABEL_PATTERN = /^\\[扩展\\]\\[([^\\]]+)\\]/;\n\n// 提取互斥目标的正则 - 匹配所有 \"[!互斥条目]\" 中的互斥条目名（全局匹配）\nconst EXTENSION_EXCLUSION_PATTERN = /\\[!([^\\]]+)\\]/g;\n\n// 提取替换目标的正则 - 匹配所有 \"[>替换条目]\" 中的替换条目名（全局匹配）\nconst EXTENSION_REPLACEMENT_PATTERN = /\\[>([^\\]]+)\\]/g;\n\n// 提取前置需求的正则 - 匹配所有 \"[<前置扩展]\" 中的前置扩展名（全局匹配）\nconst EXTENSION_PREREQUISITE_PATTERN = /\\[<([^\\]]+)\\]/g;\n\n/**\n * 扩展状态初始值\n */\nexport const initialExtensionState = {\n  extensionOptions: [] as ExtensionOption[],\n  localExtensionSelections: new Map<string, boolean>(),\n};\n\n/**\n * 解析角色条目名称，提取角色名、作者和其他信息\n * @param entryName 完整条目名称，如 \"[角色]薇薇拉(K1nn-原创角色)\"\n * @returns { label: string, author: string, info: string }\n */\nfunction parseCharacterName(entryName: string): { label: string; author: string; info: string } {\n  // 去掉\"[角色]\"前缀\n  const nameWithAuthor = entryName.replace(CHARACTER_PATTERN, '');\n\n  // 解析角色名和作者-信息\n  const match = nameWithAuthor.match(CHARACTER_NAME_PATTERN);\n  if (match) {\n    const authorInfo = match[2]?.trim() || '';\n    // 检查是否包含 \"-\" 分隔符\n    const dashIndex = authorInfo.indexOf('-');\n    if (dashIndex > 0) {\n      return {\n        label: match[1].trim(),\n        author: authorInfo.substring(0, dashIndex).trim(),\n        info: authorInfo.substring(dashIndex + 1).trim(),\n      };\n    }\n    return {\n      label: match[1].trim(),\n      author: authorInfo,\n      info: '',\n    };\n  }\n\n  return { label: nameWithAuthor, author: '', info: '' };\n}\n\n/**\n * 加载角色列表\n */\nexport async function loadCharacterOptions(): Promise<{\n  characterOptions: CharacterOption[];\n  localCharacterSelections: Map<string, boolean>;\n  bookName: string | null;\n}> {\n  const bookName = getWorldBookName();\n  const entries = await getFilteredEntries(CHARACTER_PATTERN, bookName);\n\n  const characterOptions = entries.map((entry: { name: string; enabled: boolean }) => {\n    const { label, author, info } = parseCharacterName(entry.name);\n    return {\n      value: entry.name,\n      label,\n      author,\n      info,\n      enabled: entry.enabled,\n    };\n  });\n\n  // 对角色选项进行排序（按拼音首字母）\n  const sortedCharacterOptions = sortCharacterOptions(characterOptions);\n\n  // 初始化本地选择列表（从世界书的原始状态复制）\n  const localCharacterSelections = new Map(\n    sortedCharacterOptions.map(char => [char.value, char.enabled]),\n  );\n\n  return { characterOptions: sortedCharacterOptions, localCharacterSelections, bookName };\n}\n\n/**\n * 切换角色启用状态（更新本地状态，返回新的选择Map）\n */\nexport function toggleCharacter(\n  localCharacterSelections: Map<string, boolean>,\n  characterValue: string,\n): Map<string, boolean> {\n  const newSelections = new Map(localCharacterSelections);\n  const currentEnabled = newSelections.get(characterValue) ?? false;\n  newSelections.set(characterValue, !currentEnabled);\n  return newSelections;\n}\n\n/**\n * 检查本地选择是否与原始状态有变化\n */\nexport function hasCharacterChanges(\n  characterOptions: CharacterOption[],\n  localCharacterSelections: Map<string, boolean>,\n): boolean {\n  for (const char of characterOptions) {\n    const localEnabled = localCharacterSelections.get(char.value) ?? false;\n    if (localEnabled !== char.enabled) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * 保存角色选择到世界书\n * @param characterOptions 角色选项列表\n * @param localCharacterSelections 本地选择状态\n * @param bookName 世界书名称\n * @returns 更新后的角色选项列表\n */\nexport async function saveCharacterChanges(\n  characterOptions: CharacterOption[],\n  localCharacterSelections: Map<string, boolean>,\n  bookName: string,\n): Promise<CharacterOption[]> {\n  if (!hasCharacterChanges(characterOptions, localCharacterSelections)) {\n    return characterOptions;\n  }\n\n  // 构建更新列表\n  const updatedEntries = Array.from(localCharacterSelections).map(([name, enabled]) => ({\n    name,\n    enabled,\n  }));\n\n  await updateWorldBook(updatedEntries, bookName);\n\n  // 返回更新后的角色选项列表\n  return characterOptions.map(char => ({\n    ...char,\n    enabled: localCharacterSelections.get(char.value) ?? false,\n  }));\n}\n\n// ========================\n// 事件相关函数\n// ========================\n\n/**\n * 从条目名称中提取事件Key\n * @param entryName 完整条目名称，如 \"[事件][双子]双子星的咏叹调-本体\"\n * @returns 事件Key，如 \"[事件][双子]\"，如果不匹配则返回null\n */\nfunction extractEventKey(entryName: string): string | null {\n  const match = entryName.match(EVENT_KEY_PATTERN);\n  return match ? match[1] : null;\n}\n\n/**\n * 从事件Key中提取显示名称\n * @param eventKey 事件Key，如 \"[事件][双子]\"\n * @returns 显示名称，如 \"双子\"\n */\nfunction extractEventLabel(eventKey: string): string {\n  const match = eventKey.match(EVENT_LABEL_PATTERN);\n  return match ? match[1] : eventKey;\n}\n\n/**\n * 从事件条目中提取作者和信息\n * @param entries 事件下的所有条目\n * @returns { author: string, info: string }\n */\nfunction extractEventAuthorInfo(entries: EventEntry[]): { author: string; info: string } {\n  for (const entry of entries) {\n    const match = entry.name.match(AUTHOR_PATTERN);\n    if (match) {\n      const authorInfo = match[1].trim();\n      const dashIndex = authorInfo.indexOf('-');\n      if (dashIndex > 0) {\n        return {\n          author: authorInfo.substring(0, dashIndex).trim(),\n          info: authorInfo.substring(dashIndex + 1).trim(),\n        };\n      }\n      return { author: authorInfo, info: '' };\n    }\n  }\n  return { author: '', info: '' };\n}\n\n/**\n * 加载事件列表\n */\nexport async function loadEventOptions(): Promise<{\n  eventOptions: EventOption[];\n  localEventSelections: Map<string, boolean>;\n  bookName: string | null;\n}> {\n  const bookName = getWorldBookName();\n  const entries = await getFilteredEntries(EVENT_PATTERN, bookName);\n\n  // 按事件Key分组条目\n  const eventGroups = new Map<string, EventEntry[]>();\n\n  for (const entry of entries as { name: string; enabled: boolean }[]) {\n    const eventKey = extractEventKey(entry.name);\n    if (!eventKey) continue;\n\n    if (!eventGroups.has(eventKey)) {\n      eventGroups.set(eventKey, []);\n    }\n    eventGroups.get(eventKey)!.push({\n      name: entry.name,\n      enabled: entry.enabled,\n    });\n  }\n\n  // 构建事件选项列表\n  const eventOptions: EventOption[] = [];\n  for (const [eventKey, groupEntries] of eventGroups) {\n    // 事件启用状态：所有条目都启用时为true\n    const allEnabled = groupEntries.every(e => e.enabled);\n    const { author, info } = extractEventAuthorInfo(groupEntries);\n    eventOptions.push({\n      eventKey,\n      label: extractEventLabel(eventKey),\n      author,\n      info,\n      entries: groupEntries,\n      enabled: allEnabled,\n    });\n  }\n\n  // 对事件选项进行排序（按拼音首字母）\n  const sortedEventOptions = sortEventOptions(eventOptions);\n\n  // 初始化本地选择列表（从分组状态复制）\n  const localEventSelections = new Map(\n    sortedEventOptions.map(event => [event.eventKey, event.enabled]),\n  );\n\n  return { eventOptions: sortedEventOptions, localEventSelections, bookName };\n}\n\n/**\n * 切换事件启用状态（更新本地状态，返回新的选择Map）\n */\nexport function toggleEvent(\n  localEventSelections: Map<string, boolean>,\n  eventKey: string,\n): Map<string, boolean> {\n  const newSelections = new Map(localEventSelections);\n  const currentEnabled = newSelections.get(eventKey) ?? false;\n  newSelections.set(eventKey, !currentEnabled);\n  return newSelections;\n}\n\n/**\n * 检查本地事件选择是否与原始状态有变化\n */\nexport function hasEventChanges(\n  eventOptions: EventOption[],\n  localEventSelections: Map<string, boolean>,\n): boolean {\n  for (const event of eventOptions) {\n    const localEnabled = localEventSelections.get(event.eventKey) ?? false;\n    if (localEnabled !== event.enabled) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * 保存事件选择到世界书\n * @param eventOptions 事件选项列表\n * @param localEventSelections 本地选择状态\n * @param bookName 世界书名称\n * @returns 更新后的事件选项列表\n */\nexport async function saveEventChanges(\n  eventOptions: EventOption[],\n  localEventSelections: Map<string, boolean>,\n  bookName: string,\n): Promise<EventOption[]> {\n  if (!hasEventChanges(eventOptions, localEventSelections)) {\n    return eventOptions;\n  }\n\n  // 构建更新列表：将每个事件的所有条目设置为相同的启用状态\n  const updatedEntries: Array<{ name: string; enabled: boolean }> = [];\n\n  for (const event of eventOptions) {\n    const newEnabled = localEventSelections.get(event.eventKey) ?? false;\n    for (const entry of event.entries) {\n      updatedEntries.push({\n        name: entry.name,\n        enabled: newEnabled,\n      });\n    }\n  }\n\n  await updateWorldBook(updatedEntries, bookName);\n\n  // 返回更新后的事件选项列表\n  return eventOptions.map(event => {\n    const newEnabled = localEventSelections.get(event.eventKey) ?? false;\n    return {\n      ...event,\n      enabled: newEnabled,\n      entries: event.entries.map(entry => ({\n        ...entry,\n        enabled: newEnabled,\n      })),\n    };\n  });\n}\n\n// ========================\n// 扩展相关函数\n// ========================\n\n/**\n * 从条目名称中提取扩展Key\n * @param entryName 完整条目名称，如 \"[扩展][无尽深渊地城扩展][!原版无尽深渊地城]无尽深渊地城-控制(Hilo)\"\n * @returns 扩展Key，如 \"[扩展][无尽深渊地城扩展][!原版无尽深渊地城]\"，如果不匹配则返回null\n */\nfunction extractExtensionKey(entryName: string): string | null {\n  const match = entryName.match(EXTENSION_KEY_PATTERN);\n  return match ? match[1] : null;\n}\n\n/**\n * 从扩展Key中提取显示名称\n * @param extensionKey 扩展Key，如 \"[扩展][无尽深渊地城扩展][!原版无尽深渊地城]\"\n * @returns 显示名称，如 \"无尽深渊地城扩展\"\n */\nfunction extractExtensionLabel(extensionKey: string): string {\n  const match = extensionKey.match(EXTENSION_LABEL_PATTERN);\n  return match ? match[1] : extensionKey;\n}\n\n/**\n * 从条目名称中提取所有互斥目标\n * @param entryName 条目名称，如 \"[扩展][无尽深渊地城扩展][!原版无尽深渊地城][!另一个目标]...\"\n * @returns 互斥目标数组\n */\nfunction extractExclusionTargetsFromEntry(entryName: string): string[] {\n  const targets: string[] = [];\n  const regex = new RegExp(EXTENSION_EXCLUSION_PATTERN.source, 'g');\n  let match;\n  while ((match = regex.exec(entryName)) !== null) {\n    targets.push(match[1]);\n  }\n  return targets;\n}\n\n/**\n * 从条目名称中提取所有替换目标\n * @param entryName 条目名称，如 \"[扩展][xxx][>被替换条目]...\"\n * @returns 替换目标数组\n */\nfunction extractReplacementTargetsFromEntry(entryName: string): string[] {\n  const targets: string[] = [];\n  const regex = new RegExp(EXTENSION_REPLACEMENT_PATTERN.source, 'g');\n  let match;\n  while ((match = regex.exec(entryName)) !== null) {\n    targets.push(match[1]);\n  }\n  return targets;\n}\n\n/**\n * 从条目名称中提取所有前置需求\n * @param entryName 条目名称，如 \"[扩展][xxx][<前置扩展]...\"\n * @returns 前置需求数组\n */\nfunction extractPrerequisiteTargetsFromEntry(entryName: string): string[] {\n  const targets: string[] = [];\n  const regex = new RegExp(EXTENSION_PREREQUISITE_PATTERN.source, 'g');\n  let match;\n  while ((match = regex.exec(entryName)) !== null) {\n    targets.push(match[1]);\n  }\n  return targets;\n}\n\n/**\n * 从扩展条目数组中提取所有互斥目标（合并所有条目的标记并去重）\n * @param entries 扩展下的所有条目\n * @returns 互斥目标数组\n */\nfunction extractExtensionExclusionTargets(entries: ExtensionEntry[]): string[] {\n  const allTargets = new Set<string>();\n  for (const entry of entries) {\n    const targets = extractExclusionTargetsFromEntry(entry.name);\n    targets.forEach(t => allTargets.add(t));\n  }\n  return Array.from(allTargets);\n}\n\n/**\n * 从扩展条目数组中提取所有替换目标（合并所有条目的标记并去重）\n * @param entries 扩展下的所有条目\n * @returns 替换目标数组\n */\nfunction extractExtensionReplacementTargets(entries: ExtensionEntry[]): string[] {\n  const allTargets = new Set<string>();\n  for (const entry of entries) {\n    const targets = extractReplacementTargetsFromEntry(entry.name);\n    targets.forEach(t => allTargets.add(t));\n  }\n  return Array.from(allTargets);\n}\n\n/**\n * 从扩展条目数组中提取所有前置需求（合并所有条目的标记并去重）\n * @param entries 扩展下的所有条目\n * @returns 前置需求数组\n */\nfunction extractExtensionPrerequisiteTargets(entries: ExtensionEntry[]): string[] {\n  const allTargets = new Set<string>();\n  for (const entry of entries) {\n    const targets = extractPrerequisiteTargetsFromEntry(entry.name);\n    targets.forEach(t => allTargets.add(t));\n  }\n  return Array.from(allTargets);\n}\n\n/**\n * 从扩展条目中提取作者和信息\n * @param entries 扩展下的所有条目\n * @returns { author: string, info: string }\n */\nfunction extractExtensionAuthorInfo(entries: ExtensionEntry[]): { author: string; info: string } {\n  for (const entry of entries) {\n    const match = entry.name.match(AUTHOR_PATTERN);\n    if (match) {\n      const authorInfo = match[1].trim();\n      const dashIndex = authorInfo.indexOf('-');\n      if (dashIndex > 0) {\n        return {\n          author: authorInfo.substring(0, dashIndex).trim(),\n          info: authorInfo.substring(dashIndex + 1).trim(),\n        };\n      }\n      return { author: authorInfo, info: '' };\n    }\n  }\n  return { author: '', info: '' };\n}\n\n/**\n * 加载扩展列表\n */\nexport async function loadExtensionOptions(): Promise<{\n  extensionOptions: ExtensionOption[];\n  localExtensionSelections: Map<string, boolean>;\n  bookName: string | null;\n}> {\n  const bookName = getWorldBookName();\n  const entries = await getFilteredEntries(EXTENSION_PATTERN, bookName);\n\n  // 按扩展Key分组条目\n  const extensionGroups = new Map<string, ExtensionEntry[]>();\n\n  for (const entry of entries as { name: string; enabled: boolean }[]) {\n    const extensionKey = extractExtensionKey(entry.name);\n    if (!extensionKey) continue;\n\n    if (!extensionGroups.has(extensionKey)) {\n      extensionGroups.set(extensionKey, []);\n    }\n    extensionGroups.get(extensionKey)!.push({\n      name: entry.name,\n      enabled: entry.enabled,\n    });\n  }\n\n  // 构建扩展选项列表\n  const extensionOptions: ExtensionOption[] = [];\n  for (const [extensionKey, groupEntries] of extensionGroups) {\n    // 扩展启用状态：所有条目都启用时为true\n    const allEnabled = groupEntries.every(e => e.enabled);\n    const { author, info } = extractExtensionAuthorInfo(groupEntries);\n    extensionOptions.push({\n      extensionKey,\n      label: extractExtensionLabel(extensionKey),\n      author,\n      info,\n      exclusionTargets: extractExtensionExclusionTargets(groupEntries),\n      replacementTargets: extractExtensionReplacementTargets(groupEntries),\n      prerequisiteTargets: extractExtensionPrerequisiteTargets(groupEntries),\n      entries: groupEntries,\n      enabled: allEnabled,\n    });\n  }\n\n  // 对扩展选项进行排序（按拼音首字母）\n  const sortedExtensionOptions = sortExtensionOptions(extensionOptions);\n\n  // 初始化本地选择列表（从分组状态复制）\n  const localExtensionSelections = new Map(\n    sortedExtensionOptions.map(ext => [ext.extensionKey, ext.enabled]),\n  );\n\n  return { extensionOptions: sortedExtensionOptions, localExtensionSelections, bookName };\n}\n\n/**\n * 检查前置需求是否满足\n * @param extensionOptions 扩展选项列表\n * @param localExtensionSelections 本地选择状态\n * @param prerequisiteTargets 前置需求目标数组\n * @returns { satisfied: boolean, missingPrerequisites: string[] }\n */\nfunction checkPrerequisites(\n  extensionOptions: ExtensionOption[],\n  localExtensionSelections: Map<string, boolean>,\n  prerequisiteTargets: string[],\n): { satisfied: boolean; missingPrerequisites: string[] } {\n  const missingPrerequisites: string[] = [];\n\n  for (const target of prerequisiteTargets) {\n    // 查找包含 [target] 的扩展\n    const prerequisiteExtension = extensionOptions.find(ext =>\n      ext.extensionKey.includes(`[${target}]`),\n    );\n    if (prerequisiteExtension) {\n      const isEnabled = localExtensionSelections.get(prerequisiteExtension.extensionKey) ?? false;\n      if (!isEnabled) {\n        missingPrerequisites.push(target);\n      }\n    } else {\n      // 如果找不到对应的扩展，记录为缺失\n      missingPrerequisites.push(target);\n    }\n  }\n\n  return {\n    satisfied: missingPrerequisites.length === 0,\n    missingPrerequisites,\n  };\n}\n\n/**\n * 切换扩展启用状态的结果\n */\nexport interface ToggleExtensionResult {\n  selections: Map<string, boolean>;\n  success: boolean;\n  error?: string;\n  missingPrerequisites?: string[];\n}\n\n/**\n * 切换扩展启用状态（更新本地状态，返回新的选择Map和结果状态）\n *\n * 处理三种关系：\n * 1. 互斥 [!xxx]：开启时关闭包含 [xxx] 的扩展（扩展之间互斥）\n * 2. 替换 [>xxx]：开启时关闭包含 [xxx] 的条目，关闭时无特殊处理（保存时处理恢复）\n * 3. 前置需求 [<xxx]：开启时检查 [xxx] 扩展是否已开启\n */\nexport function toggleExtension(\n  localExtensionSelections: Map<string, boolean>,\n  extensionOptions: ExtensionOption[],\n  extensionKey: string,\n): ToggleExtensionResult {\n  const newSelections = new Map(localExtensionSelections);\n  const currentEnabled = newSelections.get(extensionKey) ?? false;\n  const newEnabled = !currentEnabled;\n\n  const targetExtension = extensionOptions.find(ext => ext.extensionKey === extensionKey);\n\n  // 如果正在启用扩展，需要检查前置需求\n  if (newEnabled && targetExtension) {\n    // 检查前置需求\n    if (targetExtension.prerequisiteTargets.length > 0) {\n      const { satisfied, missingPrerequisites } = checkPrerequisites(\n        extensionOptions,\n        newSelections,\n        targetExtension.prerequisiteTargets,\n      );\n\n      if (!satisfied) {\n        return {\n          selections: localExtensionSelections, // 返回原始选择，不做改变\n          success: false,\n          error: `缺少前置需求: ${missingPrerequisites.join(', ')}`,\n          missingPrerequisites,\n        };\n      }\n    }\n  }\n\n  newSelections.set(extensionKey, newEnabled);\n\n  // 如果正在启用扩展，处理互斥逻辑\n  if (newEnabled && targetExtension) {\n    // 处理互斥目标\n    for (const exclusionTarget of targetExtension.exclusionTargets) {\n      // 查找所有包含 [互斥目标] 的扩展并禁用\n      for (const ext of extensionOptions) {\n        // 检查扩展label是否匹配互斥目标，或扩展Key是否包含 [互斥目标]\n        if (\n          ext.extensionKey !== extensionKey &&\n          (ext.label === exclusionTarget || ext.extensionKey.includes(`[${exclusionTarget}]`))\n        ) {\n          newSelections.set(ext.extensionKey, false);\n        }\n      }\n    }\n  }\n\n  // 如果正在禁用扩展，检查是否有其他扩展依赖此扩展作为前置需求\n  if (!newEnabled && targetExtension) {\n    // 查找所有依赖当前扩展的扩展并禁用它们\n    for (const ext of extensionOptions) {\n      if (ext.extensionKey !== extensionKey) {\n        const isEnabled = newSelections.get(ext.extensionKey) ?? false;\n        if (isEnabled && ext.prerequisiteTargets.includes(targetExtension.label)) {\n          // 递归禁用依赖此扩展的扩展\n          newSelections.set(ext.extensionKey, false);\n        }\n      }\n    }\n  }\n\n  return {\n    selections: newSelections,\n    success: true,\n  };\n}\n\n/**\n * 检查本地扩展选择是否与原始状态有变化\n */\nexport function hasExtensionChanges(\n  extensionOptions: ExtensionOption[],\n  localExtensionSelections: Map<string, boolean>,\n): boolean {\n  for (const ext of extensionOptions) {\n    const localEnabled = localExtensionSelections.get(ext.extensionKey) ?? false;\n    if (localEnabled !== ext.enabled) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * 收集所有被启用扩展的互斥目标（需要禁用的目标）\n * @param extensionOptions 扩展选项列表\n * @param localExtensionSelections 本地选择状态\n * @returns 互斥目标数组\n */\nfunction collectExclusionTargetsToDisable(\n  extensionOptions: ExtensionOption[],\n  localExtensionSelections: Map<string, boolean>,\n): string[] {\n  const exclusionTargets: string[] = [];\n\n  for (const ext of extensionOptions) {\n    const isEnabled = localExtensionSelections.get(ext.extensionKey) ?? false;\n    if (isEnabled && ext.exclusionTargets.length > 0) {\n      exclusionTargets.push(...ext.exclusionTargets);\n    }\n  }\n\n  // 去重\n  return [...new Set(exclusionTargets)];\n}\n\n/**\n * 收集所有被启用扩展的替换目标（需要禁用的条目）\n * @param extensionOptions 扩展选项列表\n * @param localExtensionSelections 本地选择状态\n * @returns 替换目标数组\n */\nfunction collectReplacementTargetsToDisable(\n  extensionOptions: ExtensionOption[],\n  localExtensionSelections: Map<string, boolean>,\n): string[] {\n  const replacementTargets: string[] = [];\n\n  for (const ext of extensionOptions) {\n    const isEnabled = localExtensionSelections.get(ext.extensionKey) ?? false;\n    if (isEnabled && ext.replacementTargets.length > 0) {\n      replacementTargets.push(...ext.replacementTargets);\n    }\n  }\n\n  // 去重\n  return [...new Set(replacementTargets)];\n}\n\n/**\n * 收集所有被禁用扩展的替换目标（需要恢复启用的条目）\n * @param extensionOptions 扩展选项列表\n * @param localExtensionSelections 本地选择状态\n * @param originalExtensionStates 原始扩展状态（用于判断扩展是否从启用变为禁用）\n * @returns 替换目标数组\n */\nfunction collectReplacementTargetsToEnable(\n  extensionOptions: ExtensionOption[],\n  localExtensionSelections: Map<string, boolean>,\n  originalExtensionStates: Map<string, boolean>,\n): string[] {\n  const replacementTargets: string[] = [];\n\n  for (const ext of extensionOptions) {\n    const isEnabled = localExtensionSelections.get(ext.extensionKey) ?? false;\n    const wasEnabled = originalExtensionStates.get(ext.extensionKey) ?? false;\n\n    // 只有当扩展从启用变为禁用时，才恢复替换目标\n    if (!isEnabled && wasEnabled && ext.replacementTargets.length > 0) {\n      replacementTargets.push(...ext.replacementTargets);\n    }\n  }\n\n  // 去重\n  return [...new Set(replacementTargets)];\n}\n\n/**\n * 保存扩展选择到世界书\n * @param extensionOptions 扩展选项列表\n * @param localExtensionSelections 本地选择状态\n * @param bookName 世界书名称\n * @returns 更新后的扩展选项列表\n */\nexport async function saveExtensionChanges(\n  extensionOptions: ExtensionOption[],\n  localExtensionSelections: Map<string, boolean>,\n  bookName: string,\n): Promise<ExtensionOption[]> {\n  if (!hasExtensionChanges(extensionOptions, localExtensionSelections)) {\n    return extensionOptions;\n  }\n\n  // 构建原始扩展状态映射\n  const originalExtensionStates = new Map(\n    extensionOptions.map(ext => [ext.extensionKey, ext.enabled]),\n  );\n\n  // 构建更新列表：将每个扩展的所有条目设置为相同的启用状态\n  const updatedEntries: Array<{ name: string; enabled: boolean }> = [];\n\n  for (const ext of extensionOptions) {\n    const newEnabled = localExtensionSelections.get(ext.extensionKey) ?? false;\n    for (const entry of ext.entries) {\n      updatedEntries.push({\n        name: entry.name,\n        enabled: newEnabled,\n      });\n    }\n  }\n\n  // 收集所有被启用扩展的互斥目标（需要禁用）\n  const exclusionTargetsToDisable = collectExclusionTargetsToDisable(\n    extensionOptions,\n    localExtensionSelections,\n  );\n\n  // 收集所有被启用扩展的替换目标（需要禁用）\n  const replacementTargetsToDisable = collectReplacementTargetsToDisable(\n    extensionOptions,\n    localExtensionSelections,\n  );\n\n  // 收集所有被禁用扩展的替换目标（需要恢复启用）\n  const replacementTargetsToEnable = collectReplacementTargetsToEnable(\n    extensionOptions,\n    localExtensionSelections,\n    originalExtensionStates,\n  );\n\n  // 从需要启用的替换目标中排除需要禁用的目标（禁用优先级更高）\n  const filteredReplacementTargetsToEnable = replacementTargetsToEnable.filter(\n    target =>\n      !replacementTargetsToDisable.includes(target) && !exclusionTargetsToDisable.includes(target),\n  );\n\n  // 处理互斥逻辑：禁用包含 [互斥目标] 的扩展条目\n  if (exclusionTargetsToDisable.length > 0) {\n    for (const target of exclusionTargetsToDisable) {\n      const pattern = new RegExp(`\\\\[${escapeRegExp(target)}\\\\]`);\n      const matchingEntries = await getFilteredEntries(pattern, bookName);\n\n      for (const entry of matchingEntries as { name: string; enabled: boolean }[]) {\n        // 检查是否已经在更新列表中\n        const existingIndex = updatedEntries.findIndex(e => e.name === entry.name);\n        if (existingIndex === -1) {\n          updatedEntries.push({\n            name: entry.name,\n            enabled: false,\n          });\n        } else {\n          // 如果已存在，确保设置为禁用\n          updatedEntries[existingIndex].enabled = false;\n        }\n      }\n    }\n  }\n\n  // 处理替换逻辑（禁用）：禁用包含 [替换目标] 的条目\n  if (replacementTargetsToDisable.length > 0) {\n    for (const target of replacementTargetsToDisable) {\n      const pattern = new RegExp(`\\\\[${escapeRegExp(target)}\\\\]`);\n      const matchingEntries = await getFilteredEntries(pattern, bookName);\n\n      for (const entry of matchingEntries as { name: string; enabled: boolean }[]) {\n        // 检查是否已经在更新列表中\n        const existingIndex = updatedEntries.findIndex(e => e.name === entry.name);\n        if (existingIndex === -1) {\n          updatedEntries.push({\n            name: entry.name,\n            enabled: false,\n          });\n        } else {\n          // 如果已存在，确保设置为禁用（替换目标禁用优先级高）\n          updatedEntries[existingIndex].enabled = false;\n        }\n      }\n    }\n  }\n\n  // 处理替换逻辑（恢复启用）：启用包含 [替换目标] 的条目（当扩展关闭时）\n  if (filteredReplacementTargetsToEnable.length > 0) {\n    for (const target of filteredReplacementTargetsToEnable) {\n      const pattern = new RegExp(`\\\\[${escapeRegExp(target)}\\\\]`);\n      const matchingEntries = await getFilteredEntries(pattern, bookName);\n\n      for (const entry of matchingEntries as { name: string; enabled: boolean }[]) {\n        // 检查是否已经在更新列表中\n        const existingIndex = updatedEntries.findIndex(e => e.name === entry.name);\n        if (existingIndex === -1) {\n          updatedEntries.push({\n            name: entry.name,\n            enabled: true,\n          });\n        } else if (updatedEntries[existingIndex].enabled !== false) {\n          // 如果已存在且不是被禁用的目标，则启用\n          // 注意：禁用的优先级更高，所以这里不覆盖已禁用的条目\n          updatedEntries[existingIndex].enabled = true;\n        }\n      }\n    }\n  }\n\n  await updateWorldBook(updatedEntries, bookName);\n\n  // 返回更新后的扩展选项列表\n  return extensionOptions.map(ext => {\n    const newEnabled = localExtensionSelections.get(ext.extensionKey) ?? false;\n    return {\n      ...ext,\n      enabled: newEnabled,\n      entries: ext.entries.map(entry => ({\n        ...entry,\n        enabled: newEnabled,\n      })),\n    };\n  });\n}\n\n/**\n * 辅助函数：转义正则表达式特殊字符\n */\nfunction escapeRegExp(string: string): string {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, vShow as _vShow, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = { class: \"settings-page\" };\nconst _hoisted_2 = { class: \"control-panel-container\" };\nconst _hoisted_3 = { class: \"tab-navigation\" };\nconst _hoisted_4 = [\"disabled\"];\nconst _hoisted_5 = { class: \"tab-content\" };\nconst _hoisted_6 = { class: \"control-group\" };\nconst _hoisted_7 = {\n    key: 0,\n    class: \"loading-text\"\n};\nconst _hoisted_8 = {\n    key: 1,\n    class: \"empty-text\"\n};\nconst _hoisted_9 = {\n    key: 2,\n    class: \"list-detail-layout\"\n};\nconst _hoisted_10 = { class: \"item-list\" };\nconst _hoisted_11 = [\"onClick\"];\nconst _hoisted_12 = { class: \"item-detail\" };\nconst _hoisted_13 = { class: \"detail-name\" };\nconst _hoisted_14 = { class: \"detail-row\" };\nconst _hoisted_15 = { class: \"detail-value\" };\nconst _hoisted_16 = { class: \"detail-row\" };\nconst _hoisted_17 = { class: \"detail-value\" };\nconst _hoisted_18 = { class: \"detail-actions\" };\nconst _hoisted_19 = {\n    key: 1,\n    class: \"detail-placeholder\"\n};\nconst _hoisted_20 = { class: \"control-group\" };\nconst _hoisted_21 = {\n    key: 0,\n    class: \"loading-text\"\n};\nconst _hoisted_22 = {\n    key: 1,\n    class: \"empty-text\"\n};\nconst _hoisted_23 = {\n    key: 2,\n    class: \"list-detail-layout\"\n};\nconst _hoisted_24 = { class: \"item-list\" };\nconst _hoisted_25 = [\"onClick\"];\nconst _hoisted_26 = { class: \"item-detail\" };\nconst _hoisted_27 = { class: \"detail-name\" };\nconst _hoisted_28 = { class: \"detail-row\" };\nconst _hoisted_29 = { class: \"detail-value\" };\nconst _hoisted_30 = { class: \"detail-row\" };\nconst _hoisted_31 = { class: \"detail-value\" };\nconst _hoisted_32 = { class: \"detail-row\" };\nconst _hoisted_33 = { class: \"detail-value\" };\nconst _hoisted_34 = { class: \"detail-actions\" };\nconst _hoisted_35 = {\n    key: 1,\n    class: \"detail-placeholder\"\n};\nconst _hoisted_36 = { class: \"control-group\" };\nconst _hoisted_37 = {\n    key: 0,\n    class: \"loading-text\"\n};\nconst _hoisted_38 = {\n    key: 1,\n    class: \"empty-text\"\n};\nconst _hoisted_39 = {\n    key: 2,\n    class: \"list-detail-layout\"\n};\nconst _hoisted_40 = { class: \"item-list\" };\nconst _hoisted_41 = [\"onClick\"];\nconst _hoisted_42 = { class: \"item-detail\" };\nconst _hoisted_43 = { class: \"detail-name\" };\nconst _hoisted_44 = { class: \"detail-row\" };\nconst _hoisted_45 = { class: \"detail-value\" };\nconst _hoisted_46 = { class: \"detail-row\" };\nconst _hoisted_47 = { class: \"detail-value\" };\nconst _hoisted_48 = {\n    key: 0,\n    class: \"detail-row\"\n};\nconst _hoisted_49 = { class: \"detail-value exclusion-hint\" };\nconst _hoisted_50 = {\n    key: 1,\n    class: \"detail-row\"\n};\nconst _hoisted_51 = { class: \"detail-value replacement-hint\" };\nconst _hoisted_52 = {\n    key: 2,\n    class: \"detail-row\"\n};\nconst _hoisted_53 = { class: \"detail-value prerequisite-hint\" };\nconst _hoisted_54 = { class: \"detail-row\" };\nconst _hoisted_55 = { class: \"detail-value\" };\nconst _hoisted_56 = { class: \"detail-actions\" };\nconst _hoisted_57 = {\n    key: 1,\n    class: \"detail-placeholder\"\n};\nconst _hoisted_58 = { class: \"step-footer\" };\nconst _hoisted_59 = [\"disabled\"];\nimport { computed, onMounted, ref } from 'vue';\nimport { initialCharacterState, initialEventState, initialExtensionState, loadCharacterOptions as loadCharacterOptionsService, loadEventOptions as loadEventOptionsService, loadExtensionOptions as loadExtensionOptionsService, saveCharacterChanges as saveCharacterChangesService, saveEventChanges as saveEventChangesService, saveExtensionChanges as saveExtensionChangesService, toggleCharacter, toggleEvent, toggleExtension, } from '../services/DLCManagement';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'DLCManagementPage',\n    emits: [\"next\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        const isLoading = ref(false);\n        // Tab 状态\n        const activeTab = ref('characters');\n        // 选中项状态\n        const selectedCharacter = ref(null);\n        const selectedEvent = ref(null);\n        const selectedExtension = ref(null);\n        // 角色相关状态\n        const characterOptions = ref([...initialCharacterState.characterOptions]);\n        const localCharacterSelections = ref(new Map(initialCharacterState.localCharacterSelections));\n        // 事件相关状态\n        const eventOptions = ref([...initialEventState.eventOptions]);\n        const localEventSelections = ref(new Map(initialEventState.localEventSelections));\n        // 扩展相关状态\n        const extensionOptions = ref([...initialExtensionState.extensionOptions]);\n        const localExtensionSelections = ref(new Map(initialExtensionState.localExtensionSelections));\n        const bookName = ref(null);\n        // 计算属性：获取选中项的详细信息\n        const getSelectedCharacterInfo = computed(() => {\n            if (!selectedCharacter.value)\n                return null;\n            return characterOptions.value.find(c => c.value === selectedCharacter.value) || null;\n        });\n        const getSelectedEventInfo = computed(() => {\n            if (!selectedEvent.value)\n                return null;\n            return eventOptions.value.find(e => e.eventKey === selectedEvent.value) || null;\n        });\n        const getSelectedExtensionInfo = computed(() => {\n            if (!selectedExtension.value)\n                return null;\n            return extensionOptions.value.find(e => e.extensionKey === selectedExtension.value) || null;\n        });\n        async function loadAllOptions() {\n            isLoading.value = true;\n            try {\n                // 并行加载角色、事件和扩展列表\n                const [charResult, eventResult, extResult] = await Promise.all([\n                    loadCharacterOptionsService(),\n                    loadEventOptionsService(),\n                    loadExtensionOptionsService(),\n                ]);\n                // 角色数据\n                characterOptions.value = charResult.characterOptions;\n                localCharacterSelections.value = charResult.localCharacterSelections;\n                bookName.value = charResult.bookName;\n                // 事件数据\n                eventOptions.value = eventResult.eventOptions;\n                localEventSelections.value = eventResult.localEventSelections;\n                // 扩展数据\n                extensionOptions.value = extResult.extensionOptions;\n                localExtensionSelections.value = extResult.localExtensionSelections;\n            }\n            catch (error) {\n                console.error('加载DLC数据失败:', error);\n                characterOptions.value = [];\n                localCharacterSelections.value = new Map();\n                eventOptions.value = [];\n                localEventSelections.value = new Map();\n                extensionOptions.value = [];\n                localExtensionSelections.value = new Map();\n                bookName.value = null;\n            }\n            finally {\n                isLoading.value = false;\n            }\n        }\n        async function handleRefresh() {\n            await loadAllOptions();\n        }\n        function handleToggleCharacter(characterValue) {\n            localCharacterSelections.value = toggleCharacter(localCharacterSelections.value, characterValue);\n        }\n        function handleToggleEvent(eventKey) {\n            localEventSelections.value = toggleEvent(localEventSelections.value, eventKey);\n        }\n        function handleToggleExtension(extensionKey) {\n            const result = toggleExtension(localExtensionSelections.value, extensionOptions.value, extensionKey);\n            if (result.success) {\n                localExtensionSelections.value = result.selections;\n            }\n            else {\n                // 前置需求不满足时显示错误提示\n                alert(result.error || '操作失败');\n            }\n        }\n        /**\n         * 点击下一步：根据本地列表更新世界书后跳转\n         */\n        async function handleNext() {\n            isLoading.value = true;\n            try {\n                if (bookName.value) {\n                    // 并行保存角色、事件和扩展选择\n                    const [updatedCharacters, updatedEvents, updatedExtensions] = await Promise.all([\n                        saveCharacterChangesService(characterOptions.value, localCharacterSelections.value, bookName.value),\n                        saveEventChangesService(eventOptions.value, localEventSelections.value, bookName.value),\n                        saveExtensionChangesService(extensionOptions.value, localExtensionSelections.value, bookName.value),\n                    ]);\n                    characterOptions.value = updatedCharacters;\n                    eventOptions.value = updatedEvents;\n                    extensionOptions.value = updatedExtensions;\n                }\n            }\n            catch (error) {\n                console.error('保存DLC选择失败:', error);\n            }\n            finally {\n                isLoading.value = false;\n            }\n            emit('next');\n        }\n        // 组件挂载时加载所有选项\n        onMounted(() => {\n            loadAllOptions();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _cache[22] || (_cache[22] = _createElementVNode(\"h2\", { class: \"main-title\" }, \"DLC 管理\", -1 /* CACHED */)),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createCommentVNode(\" Tab 导航 \"),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"tab-button\", { active: activeTab.value === 'characters' }]),\n                            onClick: _cache[0] || (_cache[0] = ($event) => {\n                                activeTab.value = 'characters';\n                                selectedCharacter.value = null;\n                            })\n                        }, [...(_cache[6] || (_cache[6] = [\n                                _createElementVNode(\"span\", { class: \"tab-label\" }, \"角色\", -1 /* CACHED */)\n                            ]))], 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"tab-button\", { active: activeTab.value === 'events' }]),\n                            onClick: _cache[1] || (_cache[1] = ($event) => {\n                                activeTab.value = 'events';\n                                selectedEvent.value = null;\n                            })\n                        }, [...(_cache[7] || (_cache[7] = [\n                                _createElementVNode(\"span\", { class: \"tab-label\" }, \"事件\", -1 /* CACHED */)\n                            ]))], 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"tab-button\", { active: activeTab.value === 'extensions' }]),\n                            onClick: _cache[2] || (_cache[2] = ($event) => {\n                                activeTab.value = 'extensions';\n                                selectedExtension.value = null;\n                            })\n                        }, [...(_cache[8] || (_cache[8] = [\n                                _createElementVNode(\"span\", { class: \"tab-label\" }, \"扩展\", -1 /* CACHED */)\n                            ]))], 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: \"refresh-button\",\n                            disabled: isLoading.value,\n                            title: \"刷新列表\",\n                            onClick: handleRefresh\n                        }, [\n                            _createElementVNode(\"span\", {\n                                class: _normalizeClass({ 'is-spinning': isLoading.value })\n                            }, \"⟳\", 2 /* CLASS */)\n                        ], 8 /* PROPS */, _hoisted_4)\n                    ]),\n                    _createCommentVNode(\" Tab 内容区域 \"),\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        _createCommentVNode(\" 角色列表 (DLC - Characters) \"),\n                        _withDirectives(_createElementVNode(\"div\", _hoisted_6, [\n                            (isLoading.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, \"正在加载角色列表...\"))\n                                : (characterOptions.value.length === 0)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, \"未找到可用的角色\"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [\n                                        _createElementVNode(\"div\", _hoisted_10, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(characterOptions.value, (char) => {\n                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                    key: char.value,\n                                                    class: _normalizeClass([\"list-item\", {\n                                                            'toggled-on': localCharacterSelections.value.get(char.value),\n                                                            selected: selectedCharacter.value === char.value,\n                                                        }]),\n                                                    onClick: ($event) => (selectedCharacter.value = char.value)\n                                                }, _toDisplayString(char.label), 11 /* TEXT, CLASS, PROPS */, _hoisted_11));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_12, [\n                                            (selectedCharacter.value && getSelectedCharacterInfo.value)\n                                                ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                                    _createElementVNode(\"h3\", _hoisted_13, _toDisplayString(getSelectedCharacterInfo.value.label), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_14, [\n                                                        _cache[9] || (_cache[9] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"作者:\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"span\", _hoisted_15, _toDisplayString(getSelectedCharacterInfo.value.author || '未知'), 1 /* TEXT */)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_16, [\n                                                        _cache[10] || (_cache[10] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"信息:\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"span\", _hoisted_17, _toDisplayString(getSelectedCharacterInfo.value.info || '无'), 1 /* TEXT */)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_18, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"toggle-btn\", { 'toggled-on': localCharacterSelections.value.get(selectedCharacter.value) }]),\n                                                            onClick: _cache[3] || (_cache[3] = ($event) => (handleToggleCharacter(selectedCharacter.value)))\n                                                        }, _toDisplayString(localCharacterSelections.value.get(selectedCharacter.value) ? '已启用' : '已禁用'), 3 /* TEXT, CLASS */)\n                                                    ])\n                                                ], 64 /* STABLE_FRAGMENT */))\n                                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_19, \"请选择一个角色查看详情\"))\n                                        ])\n                                    ]))\n                        ], 512 /* NEED_PATCH */), [\n                            [_vShow, activeTab.value === 'characters']\n                        ]),\n                        _createCommentVNode(\" 事件开关 (DLC - Events) \"),\n                        _withDirectives(_createElementVNode(\"div\", _hoisted_20, [\n                            (isLoading.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_21, \"正在加载事件列表...\"))\n                                : (eventOptions.value.length === 0)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_22, \"未找到可用的事件\"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_23, [\n                                        _createElementVNode(\"div\", _hoisted_24, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(eventOptions.value, (event) => {\n                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                    key: event.eventKey,\n                                                    class: _normalizeClass([\"list-item\", {\n                                                            'toggled-on': localEventSelections.value.get(event.eventKey),\n                                                            selected: selectedEvent.value === event.eventKey,\n                                                        }]),\n                                                    onClick: ($event) => (selectedEvent.value = event.eventKey)\n                                                }, _toDisplayString(event.label), 11 /* TEXT, CLASS, PROPS */, _hoisted_25));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_26, [\n                                            (selectedEvent.value && getSelectedEventInfo.value)\n                                                ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                                    _createElementVNode(\"h3\", _hoisted_27, _toDisplayString(getSelectedEventInfo.value.label), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_28, [\n                                                        _cache[11] || (_cache[11] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"作者:\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"span\", _hoisted_29, _toDisplayString(getSelectedEventInfo.value.author || '未知'), 1 /* TEXT */)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_30, [\n                                                        _cache[12] || (_cache[12] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"大小:\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"span\", _hoisted_31, _toDisplayString(getSelectedEventInfo.value.entries.length) + \" 个条目\", 1 /* TEXT */)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_32, [\n                                                        _cache[13] || (_cache[13] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"信息:\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"span\", _hoisted_33, _toDisplayString(getSelectedEventInfo.value.info || '无'), 1 /* TEXT */)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_34, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"toggle-btn\", { 'toggled-on': localEventSelections.value.get(selectedEvent.value) }]),\n                                                            onClick: _cache[4] || (_cache[4] = ($event) => (handleToggleEvent(selectedEvent.value)))\n                                                        }, _toDisplayString(localEventSelections.value.get(selectedEvent.value) ? '已启用' : '已禁用'), 3 /* TEXT, CLASS */)\n                                                    ])\n                                                ], 64 /* STABLE_FRAGMENT */))\n                                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_35, \"请选择一个事件查看详情\"))\n                                        ])\n                                    ]))\n                        ], 512 /* NEED_PATCH */), [\n                            [_vShow, activeTab.value === 'events']\n                        ]),\n                        _createCommentVNode(\" 扩展开关 (DLC - Extension) \"),\n                        _withDirectives(_createElementVNode(\"div\", _hoisted_36, [\n                            (isLoading.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_37, \"正在加载扩展列表...\"))\n                                : (extensionOptions.value.length === 0)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_38, \"未找到可用的扩展\"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_39, [\n                                        _createElementVNode(\"div\", _hoisted_40, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(extensionOptions.value, (ext) => {\n                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                    key: ext.extensionKey,\n                                                    class: _normalizeClass([\"list-item\", {\n                                                            'toggled-on': localExtensionSelections.value.get(ext.extensionKey),\n                                                            selected: selectedExtension.value === ext.extensionKey,\n                                                        }]),\n                                                    onClick: ($event) => (selectedExtension.value = ext.extensionKey)\n                                                }, _toDisplayString(ext.label), 11 /* TEXT, CLASS, PROPS */, _hoisted_41));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_42, [\n                                            (selectedExtension.value && getSelectedExtensionInfo.value)\n                                                ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                                    _createElementVNode(\"h3\", _hoisted_43, _toDisplayString(getSelectedExtensionInfo.value.label), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_44, [\n                                                        _cache[14] || (_cache[14] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"作者:\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"span\", _hoisted_45, _toDisplayString(getSelectedExtensionInfo.value.author || '未知'), 1 /* TEXT */)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_46, [\n                                                        _cache[15] || (_cache[15] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"大小:\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"span\", _hoisted_47, _toDisplayString(getSelectedExtensionInfo.value.entries.length) + \" 个条目\", 1 /* TEXT */)\n                                                    ]),\n                                                    (getSelectedExtensionInfo.value.exclusionTargets.length > 0)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_48, [\n                                                            _cache[16] || (_cache[16] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"互斥:\", -1 /* CACHED */)),\n                                                            _createElementVNode(\"span\", _hoisted_49, _toDisplayString(getSelectedExtensionInfo.value.exclusionTargets.join(', ')), 1 /* TEXT */)\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (getSelectedExtensionInfo.value.replacementTargets.length > 0)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_50, [\n                                                            _cache[17] || (_cache[17] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"替换:\", -1 /* CACHED */)),\n                                                            _createElementVNode(\"span\", _hoisted_51, _toDisplayString(getSelectedExtensionInfo.value.replacementTargets.join(', ')), 1 /* TEXT */)\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (getSelectedExtensionInfo.value.prerequisiteTargets.length > 0)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_52, [\n                                                            _cache[18] || (_cache[18] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"前置:\", -1 /* CACHED */)),\n                                                            _createElementVNode(\"span\", _hoisted_53, _toDisplayString(getSelectedExtensionInfo.value.prerequisiteTargets.join(', ')), 1 /* TEXT */)\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    _createElementVNode(\"div\", _hoisted_54, [\n                                                        _cache[19] || (_cache[19] = _createElementVNode(\"span\", { class: \"detail-label\" }, \"信息:\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"span\", _hoisted_55, _toDisplayString(getSelectedExtensionInfo.value.info || '无'), 1 /* TEXT */)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_56, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"toggle-btn\", { 'toggled-on': localExtensionSelections.value.get(selectedExtension.value) }]),\n                                                            onClick: _cache[5] || (_cache[5] = ($event) => (handleToggleExtension(selectedExtension.value)))\n                                                        }, _toDisplayString(localExtensionSelections.value.get(selectedExtension.value) ? '已启用' : '已禁用'), 3 /* TEXT, CLASS */)\n                                                    ])\n                                                ], 64 /* STABLE_FRAGMENT */))\n                                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_57, \"请选择一个扩展查看详情\"))\n                                        ])\n                                    ]))\n                        ], 512 /* NEED_PATCH */), [\n                            [_vShow, activeTab.value === 'extensions']\n                        ])\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_58, [\n                    _cache[21] || (_cache[21] = _createElementVNode(\"div\", null, null, -1 /* CACHED */)),\n                    _createElementVNode(\"button\", {\n                        class: \"nav-button\",\n                        disabled: isLoading.value,\n                        onClick: handleNext\n                    }, [...(_cache[20] || (_cache[20] = [\n                            _createElementVNode(\"span\", null, \"下一步\", -1 /* CACHED */)\n                        ]))], 8 /* PROPS */, _hoisted_59)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./DLCManagementPage.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./DLCManagementPage.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./DLCManagementPage.vue?vue&type=style&index=0&id=3caca745&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_950b954033f7ef31b6c40554a1f5a482/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3caca745\"]])\n\nexport default __exports__","/**\n * 环境状态初始值\n */\nexport const initialEnvStatus = {\n  tavernHelper: {\n    version: null as string | null,\n    status: 'unknown',\n    statusText: '加载中...',\n  },\n  ejsTemplate: {\n    status: 'unknown',\n    statusText: '加载中...',\n    enabledStatus: 'unknown',\n    enabledText: '加载中...',\n  },\n  mvu: {\n    status: 'unknown',\n    statusText: '加载中...',\n  },\n  allOk: false,\n};\n\n/**\n * 版本比较工具\n * @returns 1 if v1 > v2, -1 if v1 < v2, 0 if equal\n */\nexport function compareVersion(v1: string | null, v2: string): number {\n  if (!v1 || !v2) return -1;\n  const s1 = String(v1);\n  const s2 = String(v2);\n  const arr1 = s1.split('.').map(Number);\n  const arr2 = s2.split('.').map(Number);\n  const len = Math.max(arr1.length, arr2.length);\n  for (let i = 0; i < len; i++) {\n    const num1 = arr1[i] || 0;\n    const num2 = arr2[i] || 0;\n    if (num1 > num2) return 1;\n    if (num1 < num2) return -1;\n  }\n  return 0;\n}\n//检查酒馆助手\nexport function checkTavernHelper() {\n  const version = getTavernHelperVersion();\n\n  if (!version) {\n    return {\n      version: null,\n      status: 'error',\n      statusText: '未找到',\n    };\n  }\n\n  const isVersionOk = compareVersion(version, '4.3.17') >= 0;\n\n  return {\n    version,\n    status: isVersionOk ? 'ok' : 'warn',\n    statusText: isVersionOk ? '正常' : '版本过低',\n  };\n}\n//检查ejs\nexport function checkEjsTemplate() {\n  try {\n    const context = window.top?.SillyTavern.getContext();\n    const ejsTemplateSettings = context.extensionSettings.EjsTemplate;\n\n    if (!ejsTemplateSettings) {\n      return {\n        status: 'error',\n        statusText: '未检测到',\n        enabled: false,\n        enabledStatus: 'unknown',\n        enabledText: '---',\n      };\n    }\n\n    return {\n      status: 'ok',\n      statusText: '存在',\n      enabled: ejsTemplateSettings.enabled,\n      enabledStatus: ejsTemplateSettings.enabled ? 'ok' : 'warn',\n      enabledText: ejsTemplateSettings.enabled ? '已启用' : '未启用',\n    };\n  } catch (e) {\n    return {\n      status: 'error',\n      statusText: '无法访问',\n      enabled: false,\n      enabledStatus: 'unknown',\n      enabledText: '---',\n    };\n  }\n}\n//检查mvu\nexport async function checkMvu() {\n  const timeoutDuration = 3000;\n  let timeoutId;\n\n  try {\n    const timeoutPromise = new Promise((_, reject) => {\n      timeoutId = setTimeout(() => {\n        reject(new Error('timed out'));\n      }, timeoutDuration);\n    });\n\n    await Promise.race([waitGlobalInitialized('Mvu'), timeoutPromise]);\n\n    clearTimeout(timeoutId);\n\n    return { status: 'ok', statusText: '正常' };\n  } catch (error) {\n    if (timeoutId) clearTimeout(timeoutId);\n    return { status: 'error', statusText: '异常/超时' };\n  }\n}\n//执行完整环境检查\nexport async function performFullEnvCheck() {\n  const tavernHelper = checkTavernHelper();\n  const ejsTemplate = checkEjsTemplate();\n  const mvu = await checkMvu();\n\n  const allOk =\n    tavernHelper.status === 'ok' &&\n    ejsTemplate.status === 'ok' &&\n    ejsTemplate.enabledStatus === 'ok' &&\n    mvu.status === 'ok';\n\n  return {\n    tavernHelper,\n    ejsTemplate,\n    mvu,\n    allOk,\n  };\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, Transition as _Transition, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = { class: \"env-check-page\" };\nconst _hoisted_2 = { class: \"env-check-container\" };\nconst _hoisted_3 = { class: \"env-check-item\" };\nconst _hoisted_4 = { class: \"env-check-details\" };\nconst _hoisted_5 = { class: \"env-check-item\" };\nconst _hoisted_6 = { class: \"env-check-details\" };\nconst _hoisted_7 = { class: \"env-check-item\" };\nconst _hoisted_8 = { class: \"env-check-details\" };\nconst _hoisted_9 = { class: \"recheck-container\" };\nconst _hoisted_10 = [\"disabled\"];\nconst _hoisted_11 = {\n    key: 0,\n    class: \"success-message\"\n};\nimport { onMounted, ref, watch } from 'vue';\nimport { initialEnvStatus, performFullEnvCheck } from '../services/envCheck';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'EnvCheckPage',\n    emits: ['next', 'envCheckComplete'],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        const isChecking = ref(false);\n        const envStatus = ref({ ...initialEnvStatus });\n        async function performCheck() {\n            isChecking.value = true;\n            try {\n                const result = await performFullEnvCheck();\n                envStatus.value = result;\n                emit('envCheckComplete', result);\n            }\n            catch (error) {\n                console.error('环境检查失败:', error);\n            }\n            finally {\n                isChecking.value = false;\n            }\n        }\n        // 监听环境检查状态，检查通过后自动跳转到下一页\n        watch(() => envStatus.value.allOk, allOk => {\n            if (allOk && !isChecking.value) {\n                emit('next');\n            }\n        });\n        onMounted(() => {\n            performCheck();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _cache[9] || (_cache[9] = _createElementVNode(\"h2\", { class: \"main-title\" }, \"环境检查\", -1 /* CACHED */)),\n                _createCommentVNode(\" 环境检查部分 \"),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createCommentVNode(\" 酒馆助手 \"),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _cache[2] || (_cache[2] = _createElementVNode(\"div\", { class: \"env-check-label\" }, [\n                            _createElementVNode(\"span\", { class: \"icon\" }, \"⚙️\"),\n                            _createElementVNode(\"span\", null, \"酒馆助手\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _createElementVNode(\"span\", null, [\n                                _cache[0] || (_cache[0] = _createTextVNode(\"版本: \", -1 /* CACHED */)),\n                                _createElementVNode(\"strong\", {\n                                    class: _normalizeClass('status-' + (envStatus.value.tavernHelper.version ? 'ok' : 'unknown'))\n                                }, _toDisplayString(envStatus.value.tavernHelper.version || '未知'), 3 /* TEXT, CLASS */)\n                            ]),\n                            _createElementVNode(\"span\", null, [\n                                _cache[1] || (_cache[1] = _createTextVNode(\"状态: \", -1 /* CACHED */)),\n                                _createElementVNode(\"strong\", {\n                                    class: _normalizeClass('status-' + envStatus.value.tavernHelper.status)\n                                }, _toDisplayString(envStatus.value.tavernHelper.statusText), 3 /* TEXT, CLASS */)\n                            ])\n                        ])\n                    ]),\n                    _createCommentVNode(\" 提示词模板 (EJS) \"),\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        _cache[5] || (_cache[5] = _createElementVNode(\"div\", { class: \"env-check-label\" }, [\n                            _createElementVNode(\"span\", { class: \"icon\" }, \"📄\"),\n                            _createElementVNode(\"span\", null, \"提示词模板 (EJS)\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", _hoisted_6, [\n                            _createElementVNode(\"span\", null, [\n                                _cache[3] || (_cache[3] = _createTextVNode(\"状态: \", -1 /* CACHED */)),\n                                _createElementVNode(\"strong\", {\n                                    class: _normalizeClass('status-' + envStatus.value.ejsTemplate.status)\n                                }, _toDisplayString(envStatus.value.ejsTemplate.statusText), 3 /* TEXT, CLASS */)\n                            ]),\n                            _createElementVNode(\"span\", null, [\n                                _cache[4] || (_cache[4] = _createTextVNode(\"启用?: \", -1 /* CACHED */)),\n                                _createElementVNode(\"strong\", {\n                                    class: _normalizeClass('status-' + envStatus.value.ejsTemplate.enabledStatus)\n                                }, _toDisplayString(envStatus.value.ejsTemplate.enabledText), 3 /* TEXT, CLASS */)\n                            ])\n                        ])\n                    ]),\n                    _createCommentVNode(\" MVU 框架 \"),\n                    _createElementVNode(\"div\", _hoisted_7, [\n                        _cache[7] || (_cache[7] = _createElementVNode(\"div\", { class: \"env-check-label\" }, [\n                            _createElementVNode(\"span\", { class: \"icon\" }, \"🧩\"),\n                            _createElementVNode(\"span\", null, \"MVU 框架\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", _hoisted_8, [\n                            _createElementVNode(\"span\", null, [\n                                _cache[6] || (_cache[6] = _createTextVNode(\"状态: \", -1 /* CACHED */)),\n                                _createElementVNode(\"strong\", {\n                                    class: _normalizeClass('status-' + envStatus.value.mvu.status)\n                                }, _toDisplayString(envStatus.value.mvu.statusText), 3 /* TEXT, CLASS */)\n                            ])\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_9, [\n                        _createElementVNode(\"button\", {\n                            class: \"recheck-button\",\n                            disabled: isChecking.value,\n                            onClick: performCheck\n                        }, _toDisplayString(isChecking.value ? '检查中...' : '重新检查'), 9 /* TEXT, PROPS */, _hoisted_10)\n                    ])\n                ]),\n                _createCommentVNode(\" 检查通过提示 \"),\n                _createVNode(_Transition, { name: \"fade\" }, {\n                    default: _withCtx(() => [\n                        (envStatus.value.allOk && !isChecking.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [...(_cache[8] || (_cache[8] = [\n                                    _createElementVNode(\"span\", { class: \"success-icon\" }, \"✅\", -1 /* CACHED */),\n                                    _createElementVNode(\"span\", null, \"环境检查通过，正在跳转...\", -1 /* CACHED */)\n                                ]))]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _: 1 /* STABLE */\n                })\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./EnvCheckPage.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./EnvCheckPage.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./EnvCheckPage.vue?vue&type=style&index=0&id=1dbb7d39&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_950b954033f7ef31b6c40554a1f5a482/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-1dbb7d39\"]])\n\nexport default __exports__","import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, createStaticVNode as _createStaticVNode } from \"vue\"\n\nconst _hoisted_1 = { class: \"showcase-section\" }\nconst _hoisted_2 = { class: \"credits-container\" }\nconst _hoisted_3 = { class: \"author-badges\" }\nconst _hoisted_4 = { class: \"author-badges\" }\nconst _hoisted_5 = { class: \"credits-special\" }\n\n\nexport default {\n  __name: 'ShowcaseSection',\n  setup(__props) {\n\nconst teamMembers = [\n  '@𝕽𝖍𝖞𝖘_𝖟_瑞',\n  '@Yoyo514',\n  '@十七',\n  '@Hilo(404/403)',\n  '@快乐柠萌茶',\n  '@三饺初华',\n  '@银时萝',\n  '@镜梦幻',\n  '@风见幽泠',\n  '@lili',\n  '@北游',\n  '@仰望星空',\n  '@K1nn',\n  '@随风渐变',\n];\n\nconst hallOfFame = ['@Kitaikuyo', '@秋天的咸鱼'];\n\nconst specialThanks = ['@FL已放弃治疗', '@tongtny123', '@willing', '@肆祀一一', '@大乐'];\n\nreturn (_ctx, _cache) => {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createCommentVNode(\" 主标题 \"),\n    _cache[3] || (_cache[3] = _createElementVNode(\"h1\", { class: \"page-super-title\" }, \"命定之诗与黄昏之歌\", -1 /* CACHED */)),\n    _cache[4] || (_cache[4] = _createElementVNode(\"p\", { class: \"page-subtitle-english\" }, \"Destined Poetry & Twilight Song\", -1 /* CACHED */)),\n    _cache[5] || (_cache[5] = _createElementVNode(\"hr\", { class: \"ornamental-divider\" }, null, -1 /* CACHED */)),\n    _createCommentVNode(\" 制作人员展示区 \"),\n    _createElementVNode(\"div\", _hoisted_2, [\n      _cache[1] || (_cache[1] = _createElementVNode(\"div\", { class: \"credits-title\" }, \"❖ 制作团队 ❖\", -1 /* CACHED */)),\n      _createElementVNode(\"div\", _hoisted_3, [\n        (_openBlock(), _createElementBlock(_Fragment, null, _renderList(teamMembers, (author) => {\n          return _createElementVNode(\"span\", {\n            key: author,\n            class: \"author-badge\"\n          }, _toDisplayString(author), 1 /* TEXT */)\n        }), 64 /* STABLE_FRAGMENT */))\n      ]),\n      _cache[2] || (_cache[2] = _createElementVNode(\"div\", { class: \"credits-title\" }, \"❖ 英灵殿 ❖\", -1 /* CACHED */)),\n      _createElementVNode(\"div\", _hoisted_4, [\n        (_openBlock(), _createElementBlock(_Fragment, null, _renderList(hallOfFame, (author) => {\n          return _createElementVNode(\"span\", {\n            key: author,\n            class: \"author-badge\"\n          }, _toDisplayString(author), 1 /* TEXT */)\n        }), 64 /* STABLE_FRAGMENT */))\n      ]),\n      _createElementVNode(\"div\", _hoisted_5, [\n        _cache[0] || (_cache[0] = _createElementVNode(\"strong\", null, \"特别鸣谢：\", -1 /* CACHED */)),\n        _createTextVNode(_toDisplayString(specialThanks.join(' ')), 1 /* TEXT */)\n      ])\n    ]),\n    _createCommentVNode(\" 合并后的信息面板 \"),\n    _cache[6] || (_cache[6] = _createStaticVNode(\"<details class=\\\"info-panel\\\" data-v-a6772344><summary data-v-a6772344><span data-v-a6772344>世界背景与相关信息</span><span class=\\\"arrow-toggle\\\" data-v-a6772344>❖</span></summary><div class=\\\"info-content\\\" data-v-a6772344><h3 data-v-a6772344>阿斯塔利亚世界</h3><p data-v-a6772344> 小时候的你读过那样的故事吗？在剑与魔法的异世界中，幻想中的故事。一句澄澈而坚定的誓言，一段英雄的骑行，一页由凡人书写的史诗。 </p><div class=\\\"world-quote\\\" data-v-a6772344>&quot;家园已在身后，世界尽在眼前。&quot;</div><div class=\\\"world-quote\\\" data-v-a6772344> &quot;长夜将至，我从今开始守望，至死方休。我将不娶妻、不封地、不生子。我将不戴宝冠，不争荣宠。我将尽忠职守，生死于斯。我是黑暗中的利剑，长城上的守卫，抵御寒冷的烈焰，破晓时分的光线，唤醒眠者的号角，守护王国的坚盾。我将生命与荣耀献给守夜人，今夜如此，夜夜皆然。&quot; </div><div class=\\\"world-quote\\\" data-v-a6772344> &quot;荣耀即吾命！&quot;<br data-v-a6772344> &quot;愿黑松长青，愿号角长鸣，愿理想闪耀如初，愿长剑锋利如故。&quot; </div><p data-v-a6772344> 这里是阿斯塔利亚。&quot;剑与魔法&quot;、&quot;诗与远方&quot;、&quot;历史与传说&quot;、&quot;生者与死者&quot;、&quot;英雄与史诗&quot;、&quot;神灵与命运&quot;的世界。 </p><p data-v-a6772344>请拿起你梦中与儿时最浪漫的笔，亲自书写属于你自己的冒险故事吧。</p><div class=\\\"update-section\\\" data-v-a6772344><h3 data-v-a6772344>获取最新更新</h3><ul data-v-a6772344><li data-v-a6772344><a href=\\\"https://discord.com/channels/1134557553011998840/1422790367631380490\\\" target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\" data-v-a6772344>更新频道 *脑</a></li><li data-v-a6772344><a href=\\\"https://discord.com/channels/1291925535324110879/1422794259056033832\\\" target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\" data-v-a6772344>更新频道 *程</a></li></ul></div></div></details>\", 1))\n  ]))\n}\n}\n\n}","/* unplugin-vue-components disabled */import script from \"./ShowcaseSection.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ShowcaseSection.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ShowcaseSection.vue?vue&type=style&index=0&id=a6772344&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_950b954033f7ef31b6c40554a1f5a482/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-a6772344\"]])\n\nexport default __exports__","// ==================== 变量输出方式相关 ====================\n\nimport { getWorldBookName, updateWorldBook } from '@/home/services/worldbookload&update';\n\n// 固定的条目名称\nconst OUTPUT_ENTRY_MAIN_API = 'output_format (随AI输出开，主API)';\nconst OUTPUT_ENTRY_EXTRA_API = '[mvu_update]output_format (使用额外模型更新变量开)';\n\n// 变量输出方式选项\nexport const OUTPUT_OPTIONS = [\n  {\n    value: '主API',\n    label: '主API',\n    desc: '使用主API解析变量更新',\n    entryName: OUTPUT_ENTRY_MAIN_API,\n  },\n  {\n    value: '额外API',\n    label: '额外API',\n    desc: '使用额外API解析变量更新',\n    entryName: OUTPUT_ENTRY_EXTRA_API,\n  },\n];\n\n/**\n * 保存输出方式选择到世界书\n * @param selectedValue 选中的输出方式值（'主API' 或 '额外API'）\n */\nexport async function saveOutputSelection(selectedValue: string): Promise<void> {\n  const bookName = getWorldBookName();\n  if (!bookName) {\n    console.error('未找到世界书');\n    return;\n  }\n\n  // 根据选择构建更新条目\n  const updatedEntries = OUTPUT_OPTIONS.map(opt => ({\n    name: opt.entryName,\n    enabled: opt.value === selectedValue,\n  }));\n\n  await updateWorldBook(updatedEntries, bookName);\n}\n","/**\n * 场景列表配置\n */\nexport const scenarios = [\n  { index: 1, label: '我的故事将由我亲手书写(自定义)' },\n  { index: 2, label: '《来自异世界的\"勇者\"》' },\n  { index: 3, label: '《红月之誓（画饼占坑）》' },\n  { index: 4, label: '《线与天堂与彼岸花》' },\n  { index: 5, label: '《慈悲的\"魔王\"（画饼占坑）》' },\n];\n\n/**\n * 切换场景（Swipe）\n */\nexport async function switchSwipe(swipeId: number): Promise<boolean> {\n  if (typeof SillyTavern === 'undefined' || !SillyTavern.chat || SillyTavern.chat.length === 0) {\n    console.warn('SillyTavern environment not detected. Action will not be executed.');\n    return false;\n  }\n\n  const swipeIndex = swipeId;\n\n  if (\n    typeof SillyTavern.chat[0].swipe_id !== 'undefined' &&\n    SillyTavern.chat[0].swipe_id !== swipeIndex\n  ) {\n    if (SillyTavern.chat[0].swipes && SillyTavern.chat[0].swipes.length > swipeIndex) {\n      SillyTavern.chat[0].swipe_id = swipeIndex;\n      SillyTavern.chat[0].mes = SillyTavern.chat[0].swipes[swipeIndex];\n      await SillyTavern.saveChat();\n      await SillyTavern.reloadCurrentChat();\n      console.log(`Successfully switched to scenario (swipe_id: ${swipeIndex}).`);\n      return true;\n    } else {\n      console.error(`Swipe index ${swipeIndex} is out of bounds or swipes array is missing.`);\n      return false;\n    }\n  } else {\n    console.log(`Scenario ${swipeIndex} is already selected or swipe data is unavailable.`);\n    return true;\n  }\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, unref as _unref, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = { class: \"start-page\" };\nconst _hoisted_2 = { class: \"control-panel-container\" };\nconst _hoisted_3 = { class: \"scenario-list\" };\nconst _hoisted_4 = [\"onClick\"];\nconst _hoisted_5 = { class: \"output-settings-container\" };\nconst _hoisted_6 = { class: \"control-group\" };\nconst _hoisted_7 = { class: \"control-buttons\" };\nconst _hoisted_8 = [\"onClick\"];\nconst _hoisted_9 = { class: \"button-desc\" };\nconst _hoisted_10 = { class: \"step-footer\" };\nconst _hoisted_11 = [\"disabled\"];\nimport { computed, ref } from 'vue';\nimport { OUTPUT_OPTIONS, saveOutputSelection } from '../services/outputMethod';\nimport { scenarios, switchSwipe } from '../services/StartPage';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'StartPage',\n    emits: ['prev'],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        const selectedIndex = ref(null);\n        const selectedOutput = ref('');\n        const isLoading = ref(false);\n        // 变量输出方式选项\n        const outputOptions = OUTPUT_OPTIONS;\n        // 判断是否可以进入下一步（需要同时选择场景和输出方式）\n        const canProceed = computed(() => {\n            return selectedIndex.value !== null && selectedOutput.value !== '';\n        });\n        function handleScenarioSelect(index) {\n            selectedIndex.value = index;\n        }\n        function selectOutput(value) {\n            selectedOutput.value = value;\n        }\n        /**\n         * 点击下一步：保存输出方式选择并切换场景\n         */\n        async function handleNext() {\n            if (!canProceed.value)\n                return;\n            isLoading.value = true;\n            try {\n                // 保存输出方式选择到世界书\n                await saveOutputSelection(selectedOutput.value);\n                // 切换到选中的场景\n                await switchSwipe(selectedIndex.value);\n            }\n            catch (error) {\n                console.error('保存设置失败:', error);\n            }\n            finally {\n                isLoading.value = false;\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _cache[2] || (_cache[2] = _createElementVNode(\"h2\", { class: \"main-title\" }, \"你的故事将从何开始\", -1 /* CACHED */)),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"ul\", _hoisted_3, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(scenarios), (scenario) => {\n                            return (_openBlock(), _createElementBlock(\"li\", {\n                                key: scenario.index\n                            }, [\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"scenario-option\", { selected: selectedIndex.value === scenario.index }]),\n                                    onClick: ($event) => (handleScenarioSelect(scenario.index))\n                                }, _toDisplayString(scenario.label), 11 /* TEXT, CLASS, PROPS */, _hoisted_4)\n                            ]));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_5, [\n                    _createElementVNode(\"div\", _hoisted_6, [\n                        _createElementVNode(\"div\", _hoisted_7, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(outputOptions), (option) => {\n                                return (_openBlock(), _createElementBlock(\"div\", {\n                                    key: option.value,\n                                    class: \"control-item-wrapper\"\n                                }, [\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"control-button\", { selected: selectedOutput.value === option.value }]),\n                                        onClick: ($event) => (selectOutput(option.value))\n                                    }, _toDisplayString(option.label), 11 /* TEXT, CLASS, PROPS */, _hoisted_8),\n                                    _createElementVNode(\"span\", _hoisted_9, _toDisplayString(option.desc), 1 /* TEXT */)\n                                ]));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ])\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_10, [\n                    _createElementVNode(\"button\", {\n                        class: \"nav-button\",\n                        onClick: _cache[0] || (_cache[0] = ($event) => (_ctx.$emit('prev')))\n                    }, [...(_cache[1] || (_cache[1] = [\n                            _createElementVNode(\"span\", null, \"上一步\", -1 /* CACHED */)\n                        ]))]),\n                    _createElementVNode(\"button\", {\n                        class: \"nav-button\",\n                        disabled: !canProceed.value || isLoading.value,\n                        onClick: handleNext\n                    }, [\n                        _createElementVNode(\"span\", null, _toDisplayString(isLoading.value ? '保存中...' : '开始旅程'), 1 /* TEXT */)\n                    ], 8 /* PROPS */, _hoisted_11)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./StartPage.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./StartPage.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./StartPage.vue?vue&type=style&index=0&id=72407620&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_950b954033f7ef31b6c40554a1f5a482/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-72407620\"]])\n\nexport default __exports__","import { createVNode as _createVNode, resolveDynamicComponent as _resolveDynamicComponent, openBlock as _openBlock, createBlock as _createBlock, Transition as _Transition, withCtx as _withCtx, createElementVNode as _createElementVNode, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = { class: \"selector-scroll\" }\nconst _hoisted_2 = { class: \"step-content\" }\n\nimport { provide, readonly, ref } from 'vue';\nimport CorePage from './components/CorePage.vue';\nimport DLCManagementPage from './components/DLCManagementPage.vue';\nimport EnvCheckPage from './components/EnvCheckPage.vue';\nimport ShowcaseSection from './components/ShowcaseSection.vue';\nimport StartPage from './components/StartPage.vue';\n\n\nexport default {\n  __name: 'App',\n  setup(__props) {\n\nconst currentStep = ref(0);\n\nconst steps = [EnvCheckPage, DLCManagementPage, CorePage, StartPage];\n\n// 环境检查结果\nconst envCheckResult = ref(null);\n\n// 提供给子组件使用\nprovide('envCheckResult', readonly(envCheckResult));\n\nfunction nextStep() {\n  if (currentStep.value < steps.length - 1) {\n    currentStep.value++;\n  }\n}\n\nfunction prevStep() {\n  if (currentStep.value > 0) {\n    currentStep.value--;\n  }\n}\n\nfunction handleEnvCheckComplete(result) {\n  envCheckResult.value = result;\n}\n\nreturn (_ctx, _cache) => {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createVNode(ShowcaseSection),\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createVNode(_Transition, {\n        name: \"fade\",\n        mode: \"out-in\"\n      }, {\n        default: _withCtx(() => [\n          (_openBlock(), _createBlock(_resolveDynamicComponent(steps[currentStep.value]), {\n            onNext: nextStep,\n            onPrev: prevStep,\n            onEnvCheckComplete: handleEnvCheckComplete\n          }, null, 32 /* NEED_HYDRATION */))\n        ]),\n        _: 1 /* STABLE */\n      })\n    ])\n  ]))\n}\n}\n\n}","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&id=0af98a94&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_950b954033f7ef31b6c40554a1f5a482/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0af98a94\"]])\n\nexport default __exports__","import { createApp } from 'vue';\nimport App from './App.vue';\nimport './assets/styles/global.css';\n\ncreateApp(App).mount('#app');\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","Vue","getWorldBookName","bookInfo","window","top","TavernHelper","getCharWorldbookNames","primary","async","getFilteredEntries","pattern","bookName","worldbook","getWorldbook","map","entry","name","enabled","getWorldbookEntries","length","filter","test","updateWorldBook","entries","Error","enabledMap","Map","e","updateWorldbookWith","newEnabled","get","undefined","UNCATEGORIZED_TAB","SPECIAL_RECOMMEND_TAB","CORE_PATTERN","AUTHOR_PATTERN","initialCoreState","coreOptions","localCoreSelections","tabs","activeTab","cachedRankings","getTabsFromRankings","Rankings","response","fetch","ok","console","log","text","data","error","loadCoreClassification","dynamicTabs","Object","keys","getCoreRanking","label","coreValue","allTabs","specialRecommendCores","matchedTabs","note","specialNote","push","tabName","tabData","getSelectedCore","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","__name","emits","setup","__props","emit","__emit","SPECIAL_RECOMMEND_CORES","isLoading","ref","tabStartIndex","selectedCore","computed","value","isSpecialRecommendTab","showArrows","visibleTabs","slice","handlePrevTabs","Math","max","handleNextTabs","min","getCoresForTab","tab","core","includes","loadCoreOptions","result","nameWithoutPrefix","replace","authorMatch","match","author","ranking","handleRefresh","handleSelectCore","newSelections","set","selectCore","handleNext","hasChanges","updatedEntries","Array","from","saveChanges","watch","newTab","tabIndex","indexOf","onMounted","_ctx","_cache","disabled","title","onClick","active","$event","selected","$emit","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","pinyinCompare","a","b","localeCompare","sensitivity","CHARACTER_PATTERN","CHARACTER_NAME_PATTERN","initialCharacterState","characterOptions","localCharacterSelections","EVENT_PATTERN","EVENT_KEY_PATTERN","EVENT_LABEL_PATTERN","initialEventState","eventOptions","localEventSelections","EXTENSION_PATTERN","EXTENSION_KEY_PATTERN","EXTENSION_LABEL_PATTERN","EXTENSION_EXCLUSION_PATTERN","EXTENSION_REPLACEMENT_PATTERN","EXTENSION_PREREQUISITE_PATTERN","initialExtensionState","extensionOptions","localExtensionSelections","loadCharacterOptions","info","entryName","nameWithAuthor","authorInfo","trim","dashIndex","substring","parseCharacterName","sortedCharacterOptions","options","sort","char","saveCharacterChanges","hasCharacterChanges","extractEventKey","extractEventLabel","eventKey","extractEventAuthorInfo","loadEventOptions","eventGroups","has","groupEntries","allEnabled","every","sortedEventOptions","event","saveEventChanges","hasEventChanges","extractExtensionKey","extractExtensionLabel","extensionKey","extractExclusionTargetsFromEntry","targets","regex","RegExp","source","exec","extractReplacementTargetsFromEntry","extractPrerequisiteTargetsFromEntry","extractExtensionExclusionTargets","allTargets","Set","forEach","t","add","extractExtensionReplacementTargets","extractExtensionPrerequisiteTargets","extractExtensionAuthorInfo","loadExtensionOptions","extensionGroups","exclusionTargets","replacementTargets","prerequisiteTargets","sortedExtensionOptions","ext","saveExtensionChanges","hasExtensionChanges","originalExtensionStates","exclusionTargetsToDisable","collectExclusionTargetsToDisable","replacementTargetsToDisable","collectReplacementTargetsToDisable","replacementTargetsToEnable","isEnabled","wasEnabled","collectReplacementTargetsToEnable","filteredReplacementTargetsToEnable","escapeRegExp","matchingEntries","existingIndex","findIndex","string","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","selectedCharacter","selectedEvent","selectedExtension","getSelectedCharacterInfo","find","c","getSelectedEventInfo","getSelectedExtensionInfo","loadAllOptions","charResult","eventResult","extResult","Promise","all","handleToggleCharacter","characterValue","currentEnabled","toggleCharacter","handleToggleEvent","toggleEvent","handleToggleExtension","targetExtension","satisfied","missingPrerequisites","prerequisiteExtension","checkPrerequisites","selections","success","join","exclusionTarget","toggleExtension","alert","updatedCharacters","updatedEvents","updatedExtensions","initialEnvStatus","tavernHelper","version","status","statusText","ejsTemplate","enabledStatus","enabledText","mvu","allOk","checkTavernHelper","getTavernHelperVersion","isVersionOk","v1","v2","s1","String","s2","arr1","split","Number","arr2","len","i","num1","num2","compareVersion","performFullEnvCheck","context","SillyTavern","getContext","ejsTemplateSettings","extensionSettings","EjsTemplate","checkEjsTemplate","timeoutId","timeoutPromise","_","reject","setTimeout","race","waitGlobalInitialized","clearTimeout","checkMvu","isChecking","envStatus","performCheck","default","teamMembers","hallOfFame","specialThanks","OUTPUT_OPTIONS","desc","scenarios","index","selectedIndex","selectedOutput","outputOptions","canProceed","selectedValue","opt","saveOutputSelection","swipeId","chat","warn","swipeIndex","swipe_id","swipes","mes","saveChat","reloadCurrentChat","switchSwipe","scenario","option","currentStep","steps","EnvCheckPage","DLCManagementPage","CorePage","StartPage","envCheckResult","nextStep","prevStep","handleEnvCheckComplete","provide","readonly","ShowcaseSection","mode","onNext","onPrev","onEnvCheckComplete","createApp","App","mount"],"ignoreList":[],"sourceRoot":""}